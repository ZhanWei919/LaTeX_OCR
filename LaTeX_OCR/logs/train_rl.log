2025-05-01 20:41:48,092 - INFO - [train_rl.py:78] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-01 20:41:48,092 - INFO - [train_rl.py:79] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-01 20:41:48,092 - INFO - [train_rl.py:80] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-01 20:41:48,092 - INFO - [train_rl.py:81] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-01 20:41:48,144 - INFO - [train_rl.py:92] - 全局随机种子设置为: 42
2025-05-01 20:41:48,185 - INFO - [train_rl.py:98] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-01 20:41:48,185 - INFO - [train_rl.py:102] - 使用设备: cuda
2025-05-01 20:41:48,186 - INFO - [train_rl.py:121] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-01 20:41:48,186 - INFO - [train_rl.py:130] - 创建数据加载器...
2025-05-01 20:41:48,186 - INFO - [train_rl.py:154] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-01 20:41:48,186 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-01 20:41:48,474 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 20:41:53,737 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 20:41:53,741 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-01 20:41:53,773 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 20:41:54,324 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 20:41:54,325 - INFO - [train_rl.py:183] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-01 20:41:54,326 - INFO - [train_rl.py:193] - 初始化模型...
2025-05-01 20:41:58,750 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-01 20:42:18,817 - ERROR - [train_rl.py:216] - OCR 模型初始化或加载权重失败: An error happened while trying to locate the file on the Hub and we cannot find the requested files in the local cache. Please check your connection and try again or make sure your Internet connection is on.
2025-05-01 20:45:31,162 - INFO - [train_rl.py:78] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-01 20:45:31,162 - INFO - [train_rl.py:79] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-01 20:45:31,162 - INFO - [train_rl.py:80] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-01 20:45:31,163 - INFO - [train_rl.py:81] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-01 20:45:31,213 - INFO - [train_rl.py:92] - 全局随机种子设置为: 42
2025-05-01 20:45:31,252 - INFO - [train_rl.py:98] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-01 20:45:31,252 - INFO - [train_rl.py:102] - 使用设备: cuda
2025-05-01 20:45:31,253 - INFO - [train_rl.py:121] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-01 20:45:31,253 - INFO - [train_rl.py:130] - 创建数据加载器...
2025-05-01 20:45:31,253 - INFO - [train_rl.py:154] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-01 20:45:31,253 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-01 20:45:31,564 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 20:45:36,739 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 20:45:36,749 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-01 20:45:36,784 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 20:45:37,319 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 20:45:37,321 - INFO - [train_rl.py:183] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-01 20:45:37,321 - INFO - [train_rl.py:193] - 初始化模型...
2025-05-01 20:45:41,229 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-01 20:46:52,727 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-01 20:46:53,890 - INFO - [train_rl.py:207] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-01 20:46:55,114 - INFO - [train_rl.py:234] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-01 20:46:56,094 - INFO - [train_rl.py:242] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-01 20:46:56,096 - INFO - [train_rl.py:256] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-01 20:46:56,096 - INFO - [train_rl.py:286] - 调度器: CosineAnnealingLR (T_max=33932, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-01 20:46:56,096 - INFO - [train_rl.py:297] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-01 20:46:56,096 - INFO - [train_rl.py:316] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-01 20:46:56,096 - INFO - [train_rl.py:320] - ========================================
2025-05-01 20:46:56,097 - INFO - [train_rl.py:321] - 开始 RL 训练循环...
2025-05-01 20:46:56,097 - INFO - [train_rl.py:322] - 总轮数: 64, 每轮更新次数: 538, 总步数: 34432
2025-05-01 20:46:56,097 - INFO - [train_rl.py:323] - ========================================
2025-05-01 22:38:03,556 - INFO - [train_rl.py:523] - Epoch 1 训练结束. Avg Loss: 2.4627, Avg CE Loss: 2.9235, Avg RL Loss: -0.5120, Avg Reward: 0.8398, Time: 6665.82s
2025-05-01 22:38:03,556 - INFO - [train_rl.py:532] - --- 开始验证 Epoch 1 ---
2025-05-01 22:59:31,831 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-01 22:59:31,831 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-01 22:59:31,831 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-01 22:59:31,831 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-01 22:59:31,877 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-01 22:59:31,895 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-01 22:59:31,895 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-01 22:59:31,896 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-01 22:59:31,896 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-01 22:59:31,896 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-01 22:59:31,896 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-01 22:59:32,184 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 22:59:37,273 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 22:59:37,277 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-01 22:59:37,309 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 22:59:37,853 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 22:59:37,854 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-01 22:59:37,854 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-01 22:59:41,964 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-01 22:59:42,459 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-01 22:59:43,872 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-01 22:59:44,859 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-01 22:59:45,642 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-01 22:59:45,645 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-01 22:59:45,645 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=33932, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-01 22:59:45,645 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-01 22:59:45,646 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-01 22:59:45,646 - INFO - [train_rl.py:326] - ========================================
2025-05-01 22:59:45,646 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-01 22:59:45,646 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 538, 总步数: 34432
2025-05-01 22:59:45,646 - INFO - [train_rl.py:329] - ========================================
2025-05-01 23:00:13,922 - INFO - [train_rl.py:529] - Epoch 1 训练结束. Avg Loss: -3.4694, Avg CE Loss: 6.3448, Avg RL Loss: -10.9046, Avg Reward: 0.3318, Time: 26.89s
2025-05-01 23:00:13,922 - INFO - [train_rl.py:538] - --- 开始验证 Epoch 1 ---
2025-05-01 23:07:56,147 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-01 23:07:56,147 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-01 23:07:56,148 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-01 23:07:56,148 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-01 23:07:56,211 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-01 23:07:56,251 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-01 23:07:56,251 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-01 23:07:56,252 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-01 23:07:56,252 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-01 23:07:56,252 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-01 23:07:56,252 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-01 23:07:56,541 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 23:08:01,696 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 23:08:01,699 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-01 23:08:01,732 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 23:08:02,274 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 23:08:02,275 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-01 23:08:02,275 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-01 23:08:07,241 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-01 23:08:07,866 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-01 23:08:09,171 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-01 23:08:10,226 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-01 23:08:11,105 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-01 23:08:11,107 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-01 23:08:11,108 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=33932, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-01 23:08:11,108 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-01 23:08:11,108 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-01 23:08:11,108 - INFO - [train_rl.py:326] - ========================================
2025-05-01 23:08:11,108 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-01 23:08:11,108 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 538, 总步数: 34432
2025-05-01 23:08:11,108 - INFO - [train_rl.py:329] - ========================================
2025-05-01 23:08:39,914 - INFO - [train_rl.py:529] - Epoch 1 训练结束. Avg Loss: -3.4694, Avg CE Loss: 6.3448, Avg RL Loss: -10.9046, Avg Reward: 0.3318, Time: 26.97s
2025-05-01 23:08:39,914 - INFO - [train_rl.py:538] - --- 开始验证 Epoch 1 ---
2025-05-01 23:16:00,927 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-01 23:16:00,927 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-01 23:16:00,928 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-01 23:16:00,928 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-01 23:16:00,981 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-01 23:16:01,021 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-01 23:16:01,021 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-01 23:16:01,022 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-01 23:16:01,022 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-01 23:16:01,022 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-01 23:16:01,022 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-01 23:16:01,317 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 23:16:06,468 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 23:16:06,472 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-01 23:16:06,503 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 23:16:07,035 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 23:16:07,036 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-01 23:16:07,036 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-01 23:16:11,534 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-01 23:16:12,020 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-01 23:16:13,769 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-01 23:16:14,853 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-01 23:16:15,788 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-01 23:16:15,790 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-01 23:16:15,790 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=33932, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-01 23:16:15,790 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-01 23:16:15,790 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-01 23:16:15,790 - INFO - [train_rl.py:326] - ========================================
2025-05-01 23:16:15,790 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-01 23:16:15,790 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 538, 总步数: 34432
2025-05-01 23:16:15,790 - INFO - [train_rl.py:329] - ========================================
2025-05-01 23:16:43,874 - INFO - [train_rl.py:529] - Epoch 1 训练结束. Avg Loss: -3.4694, Avg CE Loss: 6.3448, Avg RL Loss: -10.9046, Avg Reward: 0.3318, Time: 26.55s
2025-05-01 23:16:43,874 - INFO - [train_rl.py:538] - --- 开始验证 Epoch 1 ---
2025-05-01 23:25:56,106 - INFO - [train_rl.py:587] - 验证结果 Epoch 1:
2025-05-01 23:25:56,106 - INFO - [train_rl.py:589] -   BLEU: 0.0000
2025-05-01 23:25:56,106 - INFO - [train_rl.py:589] -   EditDistance: -1.0000
2025-05-01 23:25:56,106 - INFO - [train_rl.py:589] -   ExactMatch: 0.0000
2025-05-01 23:25:56,106 - INFO - [train_rl.py:603] - *** 新的最佳验证指标 (ExactMatch): 0.0000 ***
2025-05-01 23:25:56,111 - INFO - [train_rl.py:621] - Epoch 1 满足保存间隔 (1)，将保存检查点。
2025-05-01 23:25:59,124 - INFO - [train_rl.py:643] - 检查点操作: 最佳模型已更新 (ExactMatch: 0.0000), Epoch 1 检查点已保存 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-01 23:26:22,898 - INFO - [train_rl.py:529] - Epoch 2 训练结束. Avg Loss: -10.0637, Avg CE Loss: 5.6340, Avg RL Loss: -17.4419, Avg Reward: 0.3800, Time: 23.74s
2025-05-01 23:26:22,898 - INFO - [train_rl.py:538] - --- 开始验证 Epoch 2 ---
2025-05-01 23:29:30,171 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-01 23:29:30,171 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-01 23:29:30,171 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-01 23:29:30,171 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-01 23:29:30,211 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-01 23:29:30,230 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-01 23:29:30,230 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-01 23:29:30,230 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-01 23:29:30,230 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-01 23:29:30,231 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-01 23:29:30,231 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-01 23:29:30,529 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 23:29:35,676 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 23:29:35,680 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-01 23:29:35,712 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 23:29:36,250 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 23:29:36,251 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-01 23:29:36,252 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-01 23:29:41,547 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-01 23:29:42,041 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-01 23:29:43,838 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-01 23:29:44,769 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-01 23:29:45,598 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-01 23:29:45,600 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-01 23:29:45,600 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=33932, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-01 23:29:45,600 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-01 23:29:45,601 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-01 23:29:45,601 - INFO - [train_rl.py:326] - ========================================
2025-05-01 23:29:45,601 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-01 23:29:45,601 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 538, 总步数: 34432
2025-05-01 23:29:45,601 - INFO - [train_rl.py:329] - ========================================
2025-05-01 23:59:04,707 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-01 23:59:04,707 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-01 23:59:04,707 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-01 23:59:04,707 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-01 23:59:04,760 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-01 23:59:04,779 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-01 23:59:04,779 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-01 23:59:04,780 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-01 23:59:04,780 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-01 23:59:04,780 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-01 23:59:04,780 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-01 23:59:05,124 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 23:59:10,139 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 23:59:10,143 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-01 23:59:10,176 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-01 23:59:10,703 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-01 23:59:10,704 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-01 23:59:10,705 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-01 23:59:14,720 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-01 23:59:15,175 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-01 23:59:16,261 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-01 23:59:17,388 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-01 23:59:18,289 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-01 23:59:18,291 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-01 23:59:18,291 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=33932, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-01 23:59:18,291 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-01 23:59:18,291 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-01 23:59:18,292 - INFO - [train_rl.py:326] - ========================================
2025-05-01 23:59:18,292 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-01 23:59:18,292 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 538, 总步数: 34432
2025-05-01 23:59:18,292 - INFO - [train_rl.py:329] - ========================================
2025-05-02 00:18:55,985 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-02 00:18:55,985 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 00:18:55,985 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 00:18:55,985 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-02 00:18:56,036 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-02 00:18:56,077 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-02 00:18:56,077 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-02 00:18:56,077 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-02 00:18:56,078 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-02 00:18:56,078 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-02 00:18:56,078 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-02 00:18:56,370 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 00:19:01,432 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 00:19:01,436 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-02 00:19:01,472 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 00:19:02,012 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 00:19:02,014 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-02 00:19:02,014 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-02 00:19:06,502 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-02 00:19:06,969 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-02 00:19:08,364 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-02 00:19:09,748 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-02 00:19:10,675 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-02 00:19:10,678 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-02 00:19:10,678 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=18316, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-02 00:19:10,678 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-02 00:19:10,678 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-02 00:19:10,678 - INFO - [train_rl.py:326] - ========================================
2025-05-02 00:19:10,678 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-02 00:19:10,678 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 294, 总步数: 18816
2025-05-02 00:19:10,678 - INFO - [train_rl.py:329] - ========================================
2025-05-02 00:21:47,663 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-02 00:21:47,663 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 00:21:47,663 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 00:21:47,663 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-02 00:21:47,717 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-02 00:21:47,755 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-02 00:21:47,755 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-02 00:21:47,755 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-02 00:21:47,755 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-02 00:21:47,756 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-02 00:21:47,756 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-02 00:21:48,046 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 00:21:52,711 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 00:21:52,715 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-02 00:21:52,746 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 00:21:53,248 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 00:21:53,249 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-02 00:21:53,249 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-02 00:21:57,118 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-02 00:21:57,551 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-02 00:21:58,760 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-02 00:21:59,697 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-02 00:22:00,675 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-02 00:22:00,677 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-02 00:22:00,677 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-02 00:22:00,677 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-02 00:22:00,677 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-02 00:22:00,677 - INFO - [train_rl.py:326] - ========================================
2025-05-02 00:22:00,677 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-02 00:22:00,677 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-02 00:22:00,677 - INFO - [train_rl.py:329] - ========================================
2025-05-02 02:27:16,684 - INFO - [train_rl.py:527] - Epoch 1 训练结束. Avg Loss: 2.5152, Avg CE Loss: 3.0505, Avg RL Loss: -0.5948, Avg Reward: 0.8220, Time: 7514.35s
2025-05-02 02:27:16,684 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 1 ---
2025-05-02 02:36:20,838 - INFO - [train_rl.py:585] - 验证结果 Epoch 1:
2025-05-02 02:36:20,838 - INFO - [train_rl.py:587] -   BLEU: 6.2313
2025-05-02 02:36:20,838 - INFO - [train_rl.py:587] -   EditDistance: 102.1099
2025-05-02 02:36:20,838 - INFO - [train_rl.py:587] -   ExactMatch: 0.0000
2025-05-02 02:36:20,838 - INFO - [train_rl.py:601] - *** 新的最佳验证指标 (ExactMatch): 0.0000 ***
2025-05-02 03:03:37,496 - INFO - [utils.py:515] - Logger configured. Log file: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 03:08:09,397 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-02 03:08:09,397 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 03:08:09,397 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 03:08:09,397 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-02 03:08:09,433 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-02 03:08:09,450 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-02 03:08:09,450 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-02 03:08:09,451 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-02 03:08:09,451 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-02 03:08:09,451 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-02 03:08:09,451 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-02 03:08:09,739 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 03:08:14,442 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 03:08:14,446 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-02 03:08:14,479 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 03:08:14,996 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 03:08:14,997 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-02 03:08:14,997 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-02 03:08:19,959 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-02 03:08:20,459 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-02 03:08:21,585 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-02 03:08:22,894 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-02 03:08:23,814 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-02 03:08:23,816 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-02 03:08:23,817 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-02 03:08:23,817 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-02 03:08:23,817 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-02 03:08:23,817 - INFO - [train_rl.py:326] - ========================================
2025-05-02 03:08:23,817 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-02 03:08:23,817 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-02 03:08:23,817 - INFO - [train_rl.py:329] - ========================================
2025-05-02 03:10:16,886 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-02 03:10:16,887 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 03:10:16,887 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 03:10:16,887 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-02 03:10:16,952 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-02 03:10:16,992 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-02 03:10:16,992 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-02 03:10:16,992 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-02 03:10:16,993 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-02 03:10:16,993 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-02 03:10:16,993 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-02 03:10:17,280 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 03:10:22,120 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 03:10:22,123 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-02 03:10:22,158 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 03:10:22,670 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 03:10:22,671 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-02 03:10:22,671 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-02 03:10:26,968 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-02 03:10:27,468 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-02 03:10:28,663 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-02 03:10:29,595 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-02 03:10:30,564 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-02 03:10:30,566 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-02 03:10:30,566 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-02 03:10:30,567 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-02 03:10:30,567 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-02 03:10:30,567 - INFO - [train_rl.py:326] - ========================================
2025-05-02 03:10:30,567 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-02 03:10:30,567 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-02 03:10:30,567 - INFO - [train_rl.py:329] - ========================================
2025-05-02 03:11:09,284 - INFO - [train_rl.py:529] - Epoch 1 训练结束. Avg Loss: -7.7638, Avg CE Loss: 6.3395, Avg RL Loss: -15.6703, Avg Reward: 0.3282, Time: 36.67s
2025-05-02 03:11:09,285 - INFO - [train_rl.py:538] - --- 开始验证 Epoch 1 ---
2025-05-02 03:20:15,267 - INFO - [train_rl.py:587] - 验证结果 Epoch 1:
2025-05-02 03:20:15,267 - INFO - [train_rl.py:589] -   BLEU: 0.4387
2025-05-02 03:20:15,267 - INFO - [train_rl.py:589] -   EditDistance: 245.4277
2025-05-02 03:20:15,267 - INFO - [train_rl.py:589] -   ExactMatch: 0.0000
2025-05-02 03:20:15,268 - INFO - [train_rl.py:603] - *** 新的最佳验证指标 (ExactMatch): 0.0000 ***
2025-05-02 03:20:25,426 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-02 03:20:25,426 - INFO - [train_rl.py:643] - 检查点操作: 最佳模型已更新 (ExactMatch: 0.0000) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 03:20:59,470 - INFO - [train_rl.py:529] - Epoch 2 训练结束. Avg Loss: -2.2913, Avg CE Loss: 5.6259, Avg RL Loss: -8.7969, Avg Reward: 0.3734, Time: 34.01s
2025-05-02 03:20:59,470 - INFO - [train_rl.py:538] - --- 开始验证 Epoch 2 ---
2025-05-02 03:21:44,464 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-02 03:21:44,464 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 03:21:44,464 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 03:21:44,464 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-02 03:21:44,512 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-02 03:21:44,551 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-02 03:21:44,551 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-02 03:21:44,552 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-02 03:21:44,552 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-02 03:21:44,552 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-02 03:21:44,552 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-02 03:21:44,838 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 03:21:49,625 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 03:21:49,629 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-02 03:21:49,682 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 03:21:50,211 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 03:21:50,212 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-02 03:21:50,212 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-02 03:21:55,131 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-02 03:21:55,669 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-02 03:21:56,955 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-02 03:21:57,999 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-02 03:21:58,754 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-02 03:21:58,757 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-02 03:21:58,757 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-02 03:21:58,757 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-02 03:21:58,757 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-02 03:21:58,757 - INFO - [train_rl.py:326] - ========================================
2025-05-02 03:21:58,757 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-02 03:21:58,757 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-02 03:21:58,757 - INFO - [train_rl.py:329] - ========================================
2025-05-02 05:27:22,775 - INFO - [train_rl.py:527] - Epoch 1 训练结束. Avg Loss: 2.5152, Avg CE Loss: 3.0505, Avg RL Loss: -0.5948, Avg Reward: 0.8220, Time: 7521.67s
2025-05-02 05:27:22,775 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 1 ---
2025-05-02 05:36:26,992 - INFO - [train_rl.py:585] - 验证结果 Epoch 1:
2025-05-02 05:36:26,992 - INFO - [train_rl.py:587] -   BLEU: 6.2313
2025-05-02 05:36:26,992 - INFO - [train_rl.py:587] -   EditDistance: 102.1099
2025-05-02 05:36:26,992 - INFO - [train_rl.py:587] -   ExactMatch: 0.0000
2025-05-02 05:36:26,992 - INFO - [train_rl.py:601] - *** 新的最佳验证指标 (ExactMatch): 0.0000 ***
2025-05-02 05:36:37,148 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-02 05:36:37,148 - INFO - [train_rl.py:641] - 检查点操作: 最佳模型已更新 (ExactMatch: 0.0000) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 07:03:55,615 - INFO - [train_rl.py:527] - Epoch 2 训练结束. Avg Loss: 2.3823, Avg CE Loss: 2.4292, Avg RL Loss: -0.0522, Avg Reward: 0.9026, Time: 5238.34s
2025-05-02 07:03:55,615 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 2 ---
2025-05-02 07:12:59,077 - INFO - [train_rl.py:585] - 验证结果 Epoch 2:
2025-05-02 07:12:59,077 - INFO - [train_rl.py:587] -   BLEU: 12.9242
2025-05-02 07:12:59,077 - INFO - [train_rl.py:587] -   EditDistance: 64.7780
2025-05-02 07:12:59,077 - INFO - [train_rl.py:587] -   ExactMatch: 0.0000
2025-05-02 08:45:35,225 - INFO - [train_rl.py:527] - Epoch 3 训练结束. Avg Loss: 2.1538, Avg CE Loss: 2.1974, Avg RL Loss: -0.0484, Avg Reward: 0.9167, Time: 5556.02s
2025-05-02 08:45:35,225 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 3 ---
2025-05-02 08:54:29,074 - INFO - [train_rl.py:585] - 验证结果 Epoch 3:
2025-05-02 08:54:29,074 - INFO - [train_rl.py:587] -   BLEU: 16.9325
2025-05-02 08:54:29,074 - INFO - [train_rl.py:587] -   EditDistance: 51.8339
2025-05-02 08:54:29,074 - INFO - [train_rl.py:587] -   ExactMatch: 0.0000
2025-05-02 10:32:42,966 - INFO - [train_rl.py:527] - Epoch 4 训练结束. Avg Loss: 1.9469, Avg CE Loss: 2.0308, Avg RL Loss: -0.0931, Avg Reward: 0.9243, Time: 5893.76s
2025-05-02 10:32:42,966 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 4 ---
2025-05-02 10:41:26,559 - INFO - [train_rl.py:585] - 验证结果 Epoch 4:
2025-05-02 10:41:26,559 - INFO - [train_rl.py:587] -   BLEU: 19.7201
2025-05-02 10:41:26,559 - INFO - [train_rl.py:587] -   EditDistance: 48.5656
2025-05-02 10:41:26,559 - INFO - [train_rl.py:587] -   ExactMatch: 0.0000
2025-05-02 12:17:36,289 - INFO - [train_rl.py:527] - Epoch 5 训练结束. Avg Loss: 1.7830, Avg CE Loss: 1.8886, Avg RL Loss: -0.1174, Avg Reward: 0.9304, Time: 5769.60s
2025-05-02 12:17:36,289 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 5 ---
2025-05-02 12:25:36,235 - INFO - [train_rl.py:585] - 验证结果 Epoch 5:
2025-05-02 12:25:36,235 - INFO - [train_rl.py:587] -   BLEU: 22.8200
2025-05-02 12:25:36,236 - INFO - [train_rl.py:587] -   EditDistance: 43.8902
2025-05-02 12:25:36,236 - INFO - [train_rl.py:587] -   ExactMatch: 0.0000
2025-05-02 14:03:29,807 - INFO - [train_rl.py:527] - Epoch 6 训练结束. Avg Loss: 1.5884, Avg CE Loss: 1.7473, Avg RL Loss: -0.1766, Avg Reward: 0.9364, Time: 5873.45s
2025-05-02 14:03:29,807 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 6 ---
2025-05-02 14:12:23,463 - INFO - [train_rl.py:585] - 验证结果 Epoch 6:
2025-05-02 14:12:23,463 - INFO - [train_rl.py:587] -   BLEU: 26.1631
2025-05-02 14:12:23,464 - INFO - [train_rl.py:587] -   EditDistance: 44.3969
2025-05-02 14:12:23,464 - INFO - [train_rl.py:587] -   ExactMatch: 0.0000
2025-05-02 15:54:26,771 - INFO - [train_rl.py:527] - Epoch 7 训练结束. Avg Loss: 1.3674, Avg CE Loss: 1.5943, Avg RL Loss: -0.2522, Avg Reward: 0.9421, Time: 6123.17s
2025-05-02 15:54:26,771 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 7 ---
2025-05-02 16:03:14,800 - INFO - [train_rl.py:585] - 验证结果 Epoch 7:
2025-05-02 16:03:14,801 - INFO - [train_rl.py:587] -   BLEU: 30.6832
2025-05-02 16:03:14,801 - INFO - [train_rl.py:587] -   EditDistance: 43.4455
2025-05-02 16:03:14,801 - INFO - [train_rl.py:587] -   ExactMatch: 0.0358
2025-05-02 16:03:14,801 - INFO - [train_rl.py:601] - *** 新的最佳验证指标 (ExactMatch): 0.0358 ***
2025-05-02 16:03:17,673 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-02 16:03:17,673 - INFO - [train_rl.py:641] - 检查点操作: 最佳模型已更新 (ExactMatch: 0.0358) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 17:49:08,281 - INFO - [train_rl.py:527] - Epoch 8 训练结束. Avg Loss: 1.1137, Avg CE Loss: 1.4326, Avg RL Loss: -0.3543, Avg Reward: 0.9477, Time: 6350.47s
2025-05-02 17:49:08,281 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 8 ---
2025-05-02 17:58:00,787 - INFO - [train_rl.py:585] - 验证结果 Epoch 8:
2025-05-02 17:58:00,787 - INFO - [train_rl.py:587] -   BLEU: 37.0370
2025-05-02 17:58:00,787 - INFO - [train_rl.py:587] -   EditDistance: 41.0070
2025-05-02 17:58:00,787 - INFO - [train_rl.py:587] -   ExactMatch: 0.0956
2025-05-02 17:58:00,787 - INFO - [train_rl.py:601] - *** 新的最佳验证指标 (ExactMatch): 0.0956 ***
2025-05-02 17:58:00,790 - INFO - [train_rl.py:619] - Epoch 8 满足保存间隔 (8)，将保存检查点。
2025-05-02 17:58:02,760 - INFO - [utils.py:90] - Epoch checkpoint saved to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/checkpoint_epoch_8.pth.tar
2025-05-02 17:58:04,915 - INFO - [utils.py:104] - *** Best checkpoint saved (copied from epoch) to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-02 17:58:04,916 - INFO - [train_rl.py:641] - 检查点操作: 最佳模型已更新 (ExactMatch: 0.0956), Epoch 8 检查点已保存 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 19:48:05,346 - INFO - [train_rl.py:527] - Epoch 9 训练结束. Avg Loss: 0.9144, Avg CE Loss: 1.2799, Avg RL Loss: -0.4062, Avg Reward: 0.9527, Time: 6600.30s
2025-05-02 19:48:05,347 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 9 ---
2025-05-02 19:56:56,043 - INFO - [train_rl.py:585] - 验证结果 Epoch 9:
2025-05-02 19:56:56,043 - INFO - [train_rl.py:587] -   BLEU: 42.8059
2025-05-02 19:56:56,044 - INFO - [train_rl.py:587] -   EditDistance: 40.7540
2025-05-02 19:56:56,044 - INFO - [train_rl.py:587] -   ExactMatch: 0.5496
2025-05-02 19:56:56,044 - INFO - [train_rl.py:601] - *** 新的最佳验证指标 (ExactMatch): 0.5496 ***
2025-05-02 19:56:59,093 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-02 19:56:59,094 - INFO - [train_rl.py:641] - 检查点操作: 最佳模型已更新 (ExactMatch: 0.5496) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 20:02:22,189 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-02 20:02:22,190 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 20:02:22,190 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 20:02:22,190 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-02 20:02:22,239 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-02 20:02:22,256 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-02 20:02:22,256 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-02 20:02:22,256 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-02 20:02:22,256 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-02 20:02:22,257 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-02 20:02:22,257 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-02 20:02:22,552 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 20:02:27,273 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 20:02:27,277 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-02 20:02:27,309 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 20:02:27,835 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 20:02:27,836 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-02 20:02:27,836 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-02 20:02:32,436 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-02 20:02:32,916 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-02 20:02:34,055 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-02 20:02:35,117 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-02 20:02:36,064 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-02 20:02:36,066 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-02 20:02:36,066 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-02 20:02:36,066 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-02 20:02:36,066 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-02 20:02:36,066 - INFO - [train_rl.py:326] - ========================================
2025-05-02 20:02:36,066 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-02 20:02:36,067 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-02 20:02:36,067 - INFO - [train_rl.py:329] - ========================================
2025-05-02 20:02:36,067 - INFO - [train_rl.py:340] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-02 20:02:37,488 - INFO - [train_rl.py:348] - 从 Epoch 9 恢复训练, 当前最佳指标: 0.5496
2025-05-02 23:02:46,658 - INFO - [train_rl.py:527] - Epoch 10 训练结束. Avg Loss: 4.1329, Avg CE Loss: 3.5711, Avg RL Loss: 0.6243, Avg Reward: 0.7304, Time: 10807.12s
2025-05-02 23:02:46,658 - INFO - [train_rl.py:536] - --- 开始验证 Epoch 10 ---
2025-05-02 23:11:51,915 - INFO - [train_rl.py:585] - 验证结果 Epoch 10:
2025-05-02 23:11:51,915 - INFO - [train_rl.py:587] -   BLEU: 6.6266
2025-05-02 23:11:51,915 - INFO - [train_rl.py:587] -   EditDistance: 86.8516
2025-05-02 23:11:51,915 - INFO - [train_rl.py:587] -   ExactMatch: 0.0000
2025-05-02 23:16:17,236 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-02 23:16:17,236 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 23:16:17,236 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 23:16:17,236 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-02 23:16:17,302 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-02 23:16:17,348 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-02 23:16:17,348 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-02 23:16:17,349 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-02 23:16:17,349 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-02 23:16:17,349 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-02 23:16:17,349 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-02 23:16:17,649 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 23:16:22,223 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 23:16:22,227 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-02 23:16:22,260 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 23:16:22,754 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 23:16:22,756 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-02 23:16:22,756 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-02 23:16:26,904 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-02 23:16:27,384 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-02 23:16:28,674 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-02 23:16:29,607 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-02 23:16:30,537 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-02 23:16:30,539 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-02 23:16:30,540 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-02 23:16:30,540 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-02 23:16:30,540 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-02 23:16:30,540 - INFO - [train_rl.py:326] - ========================================
2025-05-02 23:16:30,540 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-02 23:16:30,540 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-02 23:16:30,540 - INFO - [train_rl.py:329] - ========================================
2025-05-02 23:16:30,540 - INFO - [train_rl.py:340] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/checkpoint_epoch_8.pth.tar
2025-05-02 23:16:32,051 - INFO - [train_rl.py:348] - 从 Epoch 8 恢复训练, 当前最佳指标: 0.0956
2025-05-02 23:30:47,717 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-02 23:30:47,717 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 23:30:47,717 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 23:30:47,717 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-02 23:30:47,766 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-02 23:30:47,808 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-02 23:30:47,808 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-02 23:30:47,809 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-02 23:30:47,809 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-02 23:30:47,810 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-02 23:30:47,810 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-02 23:30:48,095 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 23:30:52,908 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 23:30:52,912 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-02 23:30:52,946 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 23:30:53,472 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 23:30:53,474 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-02 23:30:53,474 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-02 23:30:59,004 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-02 23:30:59,885 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-02 23:31:01,708 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-02 23:31:03,080 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-02 23:31:03,571 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-02 23:31:03,574 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-02 23:31:03,574 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-02 23:31:03,574 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-02 23:31:03,574 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-02 23:31:03,574 - INFO - [train_rl.py:326] - ========================================
2025-05-02 23:31:03,575 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-02 23:31:03,575 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-02 23:31:03,575 - INFO - [train_rl.py:329] - ========================================
2025-05-02 23:31:03,575 - INFO - [train_rl.py:340] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/checkpoint_epoch_8.pth.tar
2025-05-02 23:31:03,575 - INFO - [train_rl.py:343] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-02 23:31:03,575 - INFO - [train_rl.py:345] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-02 23:31:04,520 - INFO - [train_rl.py:355] - 从 Epoch 8 恢复训练, 当前最佳指标: 0.0956
2025-05-02 23:35:01,965 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-02 23:35:01,966 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 23:35:01,966 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 23:35:01,966 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-02 23:35:01,993 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-02 23:35:02,010 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-02 23:35:02,010 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-02 23:35:02,011 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-02 23:35:02,011 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-02 23:35:02,011 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-02 23:35:02,011 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-02 23:35:02,298 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 23:35:07,111 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 23:35:07,116 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-02 23:35:07,149 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 23:35:07,681 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 23:35:07,682 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-02 23:35:07,682 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-02 23:35:11,942 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-02 23:35:12,510 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-02 23:35:14,097 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-02 23:35:15,657 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-02 23:35:16,257 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-02 23:35:16,259 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-02 23:35:16,259 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-02 23:35:16,259 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-02 23:35:16,259 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-02 23:35:16,260 - INFO - [train_rl.py:326] - ========================================
2025-05-02 23:35:16,260 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-02 23:35:16,260 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-02 23:35:16,260 - INFO - [train_rl.py:329] - ========================================
2025-05-02 23:35:16,260 - INFO - [train_rl.py:340] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/checkpoint_epoch_8.pth.tar
2025-05-02 23:35:16,260 - INFO - [train_rl.py:343] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-02 23:35:16,260 - INFO - [train_rl.py:345] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-02 23:35:17,387 - INFO - [train_rl.py:355] - 从 Epoch 8 恢复训练, 当前最佳指标: 0.0956
2025-05-02 23:40:51,650 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-02 23:40:51,650 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-02 23:40:51,650 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-02 23:40:51,650 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-02 23:40:51,699 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-02 23:40:51,743 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-02 23:40:51,744 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-02 23:40:51,745 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-02 23:40:51,745 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-02 23:40:51,746 - INFO - [train_rl.py:157] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-02 23:40:51,747 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-02 23:40:52,095 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 23:40:57,102 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 23:40:57,106 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-02 23:40:57,141 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-02 23:40:57,657 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-02 23:40:57,658 - INFO - [train_rl.py:186] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-02 23:40:57,658 - INFO - [train_rl.py:195] - 初始化模型...
2025-05-02 23:41:02,882 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-02 23:41:03,381 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-02 23:41:06,271 - INFO - [train_rl.py:209] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-02 23:41:07,710 - INFO - [train_rl.py:238] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-02 23:41:08,686 - INFO - [train_rl.py:246] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-02 23:41:08,688 - INFO - [train_rl.py:260] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-02 23:41:08,689 - INFO - [train_rl.py:292] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-02 23:41:08,689 - INFO - [train_rl.py:304] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.9
2025-05-02 23:41:08,689 - INFO - [train_rl.py:322] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-02 23:41:08,689 - INFO - [train_rl.py:326] - ========================================
2025-05-02 23:41:08,689 - INFO - [train_rl.py:327] - 开始 RL 训练循环...
2025-05-02 23:41:08,689 - INFO - [train_rl.py:328] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-02 23:41:08,689 - INFO - [train_rl.py:329] - ========================================
2025-05-02 23:41:08,689 - INFO - [train_rl.py:340] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-02 23:41:08,689 - INFO - [train_rl.py:343] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-02 23:41:08,689 - INFO - [train_rl.py:345] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-02 23:41:10,196 - INFO - [train_rl.py:355] - 从 Epoch 9 恢复训练, 当前最佳指标: 0.5496
2025-05-03 01:33:12,311 - INFO - [train_rl.py:534] - Epoch 10 训练结束. Avg Loss: 0.7406, Avg CE Loss: 1.1499, Avg RL Loss: -0.4548, Avg Reward: 0.9572, Time: 6719.69s
2025-05-03 01:33:12,311 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 10 ---
2025-05-03 01:41:34,216 - INFO - [train_rl.py:592] - 验证结果 Epoch 10:
2025-05-03 01:41:34,216 - INFO - [train_rl.py:594] -   BLEU: 48.1993
2025-05-03 01:41:34,216 - INFO - [train_rl.py:594] -   EditDistance: 32.7670
2025-05-03 01:41:34,217 - INFO - [train_rl.py:594] -   ExactMatch: 0.9677
2025-05-03 01:41:34,217 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 0.9677 ***
2025-05-03 01:41:37,273 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 01:41:37,274 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 0.9677) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 03:30:53,541 - INFO - [train_rl.py:534] - Epoch 11 训练结束. Avg Loss: 0.6336, Avg CE Loss: 1.0457, Avg RL Loss: -0.4579, Avg Reward: 0.9610, Time: 6556.13s
2025-05-03 03:30:53,541 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 11 ---
2025-05-03 03:39:42,710 - INFO - [train_rl.py:592] - 验证结果 Epoch 11:
2025-05-03 03:39:42,710 - INFO - [train_rl.py:594] -   BLEU: 51.8177
2025-05-03 03:39:42,710 - INFO - [train_rl.py:594] -   EditDistance: 31.1114
2025-05-03 03:39:42,711 - INFO - [train_rl.py:594] -   ExactMatch: 1.7324
2025-05-03 03:39:42,711 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 1.7324 ***
2025-05-03 03:39:46,060 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 03:39:46,062 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 1.7324) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 05:32:32,282 - INFO - [train_rl.py:534] - Epoch 12 训练结束. Avg Loss: 0.5389, Avg CE Loss: 0.9620, Avg RL Loss: -0.4701, Avg Reward: 0.9641, Time: 6766.10s
2025-05-03 05:32:32,283 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 12 ---
2025-05-03 05:41:30,013 - INFO - [train_rl.py:592] - 验证结果 Epoch 12:
2025-05-03 05:41:30,014 - INFO - [train_rl.py:594] -   BLEU: 54.7658
2025-05-03 05:41:30,014 - INFO - [train_rl.py:594] -   EditDistance: 29.4977
2025-05-03 05:41:30,014 - INFO - [train_rl.py:594] -   ExactMatch: 2.2939
2025-05-03 05:41:30,014 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 2.2939 ***
2025-05-03 05:41:33,169 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 05:41:33,169 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 2.2939) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 07:35:16,780 - INFO - [train_rl.py:534] - Epoch 13 训练结束. Avg Loss: 0.4586, Avg CE Loss: 0.8870, Avg RL Loss: -0.4759, Avg Reward: 0.9665, Time: 6823.47s
2025-05-03 07:35:16,780 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 13 ---
2025-05-03 07:43:41,330 - INFO - [train_rl.py:592] - 验证结果 Epoch 13:
2025-05-03 07:43:41,330 - INFO - [train_rl.py:594] -   BLEU: 57.6362
2025-05-03 07:43:41,330 - INFO - [train_rl.py:594] -   EditDistance: 27.7035
2025-05-03 07:43:41,330 - INFO - [train_rl.py:594] -   ExactMatch: 2.8554
2025-05-03 07:43:41,330 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 2.8554 ***
2025-05-03 07:43:44,432 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 07:43:44,435 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 2.8554) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 09:30:45,167 - INFO - [train_rl.py:534] - Epoch 14 训练结束. Avg Loss: 0.4137, Avg CE Loss: 0.8213, Avg RL Loss: -0.4528, Avg Reward: 0.9691, Time: 6420.61s
2025-05-03 09:30:45,167 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 14 ---
2025-05-03 09:39:36,915 - INFO - [train_rl.py:592] - 验证结果 Epoch 14:
2025-05-03 09:39:36,915 - INFO - [train_rl.py:594] -   BLEU: 59.1336
2025-05-03 09:39:36,915 - INFO - [train_rl.py:594] -   EditDistance: 30.5689
2025-05-03 09:39:36,915 - INFO - [train_rl.py:594] -   ExactMatch: 3.8351
2025-05-03 09:39:36,915 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 3.8351 ***
2025-05-03 09:39:40,014 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 09:39:40,015 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 3.8351) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 11:26:21,479 - INFO - [train_rl.py:534] - Epoch 15 训练结束. Avg Loss: 0.3739, Avg CE Loss: 0.7662, Avg RL Loss: -0.4360, Avg Reward: 0.9711, Time: 6401.34s
2025-05-03 11:26:21,480 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 15 ---
2025-05-03 11:33:49,218 - INFO - [train_rl.py:592] - 验证结果 Epoch 15:
2025-05-03 11:33:49,219 - INFO - [train_rl.py:594] -   BLEU: 62.3840
2025-05-03 11:33:49,219 - INFO - [train_rl.py:594] -   EditDistance: 21.8995
2025-05-03 11:33:49,219 - INFO - [train_rl.py:594] -   ExactMatch: 4.8984
2025-05-03 11:33:49,219 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 4.8984 ***
2025-05-03 11:33:52,302 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 11:33:52,302 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 4.8984) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 13:19:55,616 - INFO - [train_rl.py:534] - Epoch 16 训练结束. Avg Loss: 0.3422, Avg CE Loss: 0.7151, Avg RL Loss: -0.4144, Avg Reward: 0.9729, Time: 6363.19s
2025-05-03 13:19:55,616 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 16 ---
2025-05-03 13:28:38,264 - INFO - [train_rl.py:592] - 验证结果 Epoch 16:
2025-05-03 13:28:38,265 - INFO - [train_rl.py:594] -   BLEU: 63.0644
2025-05-03 13:28:38,265 - INFO - [train_rl.py:594] -   EditDistance: 26.5029
2025-05-03 13:28:38,265 - INFO - [train_rl.py:594] -   ExactMatch: 5.2927
2025-05-03 13:28:38,265 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 5.2927 ***
2025-05-03 13:28:38,268 - INFO - [train_rl.py:626] - Epoch 16 满足保存间隔 (8)，将保存检查点。
2025-05-03 13:28:40,201 - INFO - [utils.py:90] - Epoch checkpoint saved to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/checkpoint_epoch_16.pth.tar
2025-05-03 13:28:42,305 - INFO - [utils.py:104] - *** Best checkpoint saved (copied from epoch) to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 13:28:42,305 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 5.2927), Epoch 16 检查点已保存 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 15:13:11,039 - INFO - [train_rl.py:534] - Epoch 17 训练结束. Avg Loss: 0.3197, Avg CE Loss: 0.6732, Avg RL Loss: -0.3928, Avg Reward: 0.9747, Time: 6268.61s
2025-05-03 15:13:11,039 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 17 ---
2025-05-03 15:20:52,106 - INFO - [train_rl.py:592] - 验证结果 Epoch 17:
2025-05-03 15:20:52,106 - INFO - [train_rl.py:594] -   BLEU: 65.0674
2025-05-03 15:20:52,106 - INFO - [train_rl.py:594] -   EditDistance: 21.0919
2025-05-03 15:20:52,106 - INFO - [train_rl.py:594] -   ExactMatch: 6.5830
2025-05-03 15:20:52,106 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 6.5830 ***
2025-05-03 15:20:55,313 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 15:20:55,313 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 6.5830) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 17:05:16,379 - INFO - [train_rl.py:534] - Epoch 18 训练结束. Avg Loss: 0.2900, Avg CE Loss: 0.6366, Avg RL Loss: -0.3852, Avg Reward: 0.9759, Time: 6260.94s
2025-05-03 17:05:16,379 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 18 ---
2025-05-03 17:13:48,450 - INFO - [train_rl.py:592] - 验证结果 Epoch 18:
2025-05-03 17:13:48,450 - INFO - [train_rl.py:594] -   BLEU: 66.4960
2025-05-03 17:13:48,450 - INFO - [train_rl.py:594] -   EditDistance: 22.0951
2025-05-03 17:13:48,450 - INFO - [train_rl.py:594] -   ExactMatch: 7.2999
2025-05-03 17:13:48,450 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 7.2999 ***
2025-05-03 17:13:51,808 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 17:13:51,808 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 7.2999) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 18:51:17,021 - INFO - [train_rl.py:534] - Epoch 19 训练结束. Avg Loss: 0.2817, Avg CE Loss: 0.5981, Avg RL Loss: -0.3515, Avg Reward: 0.9773, Time: 5845.09s
2025-05-03 18:51:17,021 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 19 ---
2025-05-03 18:59:18,629 - INFO - [train_rl.py:592] - 验证结果 Epoch 19:
2025-05-03 18:59:18,630 - INFO - [train_rl.py:594] -   BLEU: 68.1557
2025-05-03 18:59:18,630 - INFO - [train_rl.py:594] -   EditDistance: 20.0634
2025-05-03 18:59:18,630 - INFO - [train_rl.py:594] -   ExactMatch: 8.6141
2025-05-03 18:59:18,630 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 8.6141 ***
2025-05-03 18:59:21,773 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 18:59:21,773 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 8.6141) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 20:38:51,579 - INFO - [train_rl.py:534] - Epoch 20 训练结束. Avg Loss: 0.2593, Avg CE Loss: 0.5571, Avg RL Loss: -0.3309, Avg Reward: 0.9785, Time: 5969.68s
2025-05-03 20:38:51,579 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 20 ---
2025-05-03 20:47:17,778 - INFO - [train_rl.py:592] - 验证结果 Epoch 20:
2025-05-03 20:47:17,778 - INFO - [train_rl.py:594] -   BLEU: 68.7597
2025-05-03 20:47:17,778 - INFO - [train_rl.py:594] -   EditDistance: 20.7891
2025-05-03 20:47:17,778 - INFO - [train_rl.py:594] -   ExactMatch: 9.0562
2025-05-03 20:47:17,778 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 9.0562 ***
2025-05-03 20:47:20,690 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 20:47:20,690 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 9.0562) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-03 22:25:09,397 - INFO - [train_rl.py:534] - Epoch 21 训练结束. Avg Loss: 0.2549, Avg CE Loss: 0.5268, Avg RL Loss: -0.3021, Avg Reward: 0.9797, Time: 5868.57s
2025-05-03 22:25:09,398 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 21 ---
2025-05-03 22:32:47,899 - INFO - [train_rl.py:592] - 验证结果 Epoch 21:
2025-05-03 22:32:47,899 - INFO - [train_rl.py:594] -   BLEU: 69.9583
2025-05-03 22:32:47,899 - INFO - [train_rl.py:594] -   EditDistance: 18.0042
2025-05-03 22:32:47,899 - INFO - [train_rl.py:594] -   ExactMatch: 9.7969
2025-05-03 22:32:47,899 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 9.7969 ***
2025-05-03 22:32:50,627 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-03 22:32:50,627 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 9.7969) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 00:11:05,273 - INFO - [train_rl.py:534] - Epoch 22 训练结束. Avg Loss: 0.2385, Avg CE Loss: 0.5032, Avg RL Loss: -0.2941, Avg Reward: 0.9808, Time: 5894.52s
2025-05-04 00:11:05,273 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 22 ---
2025-05-04 00:17:57,372 - INFO - [train_rl.py:592] - 验证结果 Epoch 22:
2025-05-04 00:17:57,372 - INFO - [train_rl.py:594] -   BLEU: 71.1831
2025-05-04 00:17:57,372 - INFO - [train_rl.py:594] -   EditDistance: 17.0904
2025-05-04 00:17:57,372 - INFO - [train_rl.py:594] -   ExactMatch: 10.0000
2025-05-04 00:17:57,372 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 10.0000 ***
2025-05-04 00:18:00,305 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-04 00:18:00,306 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 10.0000) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 01:53:48,714 - INFO - [train_rl.py:534] - Epoch 23 训练结束. Avg Loss: 0.2245, Avg CE Loss: 0.4785, Avg RL Loss: -0.2822, Avg Reward: 0.9813, Time: 5748.27s
2025-05-04 01:53:48,714 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 23 ---
2025-05-04 02:00:58,559 - INFO - [train_rl.py:592] - 验证结果 Epoch 23:
2025-05-04 02:00:58,560 - INFO - [train_rl.py:594] -   BLEU: 72.1834
2025-05-04 02:00:58,560 - INFO - [train_rl.py:594] -   EditDistance: 16.5738
2025-05-04 02:00:58,560 - INFO - [train_rl.py:594] -   ExactMatch: 10.9916
2025-05-04 02:00:58,560 - INFO - [train_rl.py:608] - *** 新的最佳验证指标 (ExactMatch): 10.9916 ***
2025-05-04 02:01:01,351 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-04 02:01:01,351 - INFO - [train_rl.py:648] - 检查点操作: 最佳模型已更新 (ExactMatch: 10.9916) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 02:08:03,941 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-04 02:08:03,941 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 02:08:03,941 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-04 02:08:03,941 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-04 02:08:03,991 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-04 02:08:04,076 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-04 02:08:04,076 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-04 02:08:04,077 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-04 02:08:04,077 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-04 02:08:04,078 - INFO - [train_rl.py:182] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-04 02:08:04,078 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-04 02:08:04,412 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 02:08:09,822 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 02:08:09,825 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-04 02:08:09,861 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 02:08:10,415 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 02:08:10,416 - INFO - [train_rl.py:211] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-04 02:08:10,417 - INFO - [train_rl.py:220] - 初始化模型...
2025-05-04 02:08:14,969 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-04 02:08:15,412 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-04 02:08:17,615 - INFO - [train_rl.py:234] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-04 02:08:19,049 - INFO - [train_rl.py:263] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-04 02:08:20,182 - INFO - [train_rl.py:271] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-04 02:08:20,184 - INFO - [train_rl.py:285] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-04 02:08:20,185 - INFO - [train_rl.py:317] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-04 02:08:20,185 - INFO - [train_rl.py:329] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.1
2025-05-04 02:08:20,185 - INFO - [train_rl.py:347] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-04 02:08:20,185 - INFO - [train_rl.py:351] - ========================================
2025-05-04 02:08:20,185 - INFO - [train_rl.py:352] - 开始 RL 训练循环...
2025-05-04 02:08:20,185 - INFO - [train_rl.py:353] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-04 02:08:20,185 - INFO - [train_rl.py:354] - ========================================
2025-05-04 02:08:20,185 - INFO - [train_rl.py:365] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-04 02:08:20,185 - INFO - [train_rl.py:368] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-04 02:08:20,185 - INFO - [train_rl.py:370] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-04 02:08:21,825 - INFO - [train_rl.py:380] - 从 Epoch 23 恢复训练, 当前最佳指标: 10.9916
2025-05-04 04:03:42,761 - INFO - [train_rl.py:559] - Epoch 24 训练结束. Avg Loss: 0.7518, Avg CE Loss: 0.8136, Avg RL Loss: -0.6179, Avg Reward: 0.9656, Time: 6918.22s
2025-05-04 04:03:42,761 - INFO - [train_rl.py:568] - --- 开始验证 Epoch 24 ---
2025-05-04 04:09:47,311 - INFO - [train_rl.py:617] - 验证结果 Epoch 24:
2025-05-04 04:09:47,311 - INFO - [train_rl.py:619] -   BLEU: 69.8583
2025-05-04 04:09:47,311 - INFO - [train_rl.py:619] -   EditDistance: 15.9763
2025-05-04 04:09:47,311 - INFO - [train_rl.py:619] -   ExactMatch: 9.6057
2025-05-04 04:09:47,316 - INFO - [train_rl.py:651] - Epoch 24 满足保存间隔 (8)，将保存检查点。
2025-05-04 04:09:49,323 - INFO - [utils.py:90] - Epoch checkpoint saved to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/checkpoint_epoch_24.pth.tar
2025-05-04 04:09:49,323 - INFO - [train_rl.py:673] - 检查点操作: Epoch 24 检查点已保存 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 05:58:14,776 - INFO - [train_rl.py:559] - Epoch 25 训练结束. Avg Loss: 0.6262, Avg CE Loss: 0.6725, Avg RL Loss: -0.4631, Avg Reward: 0.9722, Time: 6505.31s
2025-05-04 05:58:14,776 - INFO - [train_rl.py:568] - --- 开始验证 Epoch 25 ---
2025-05-04 06:04:12,797 - INFO - [train_rl.py:617] - 验证结果 Epoch 25:
2025-05-04 06:04:12,797 - INFO - [train_rl.py:619] -   BLEU: 70.6064
2025-05-04 06:04:12,797 - INFO - [train_rl.py:619] -   EditDistance: 15.7170
2025-05-04 06:04:12,797 - INFO - [train_rl.py:619] -   ExactMatch: 9.6774
2025-05-04 07:49:07,373 - INFO - [train_rl.py:559] - Epoch 26 训练结束. Avg Loss: 0.5838, Avg CE Loss: 0.6267, Avg RL Loss: -0.4293, Avg Reward: 0.9740, Time: 6294.44s
2025-05-04 07:49:07,373 - INFO - [train_rl.py:568] - --- 开始验证 Epoch 26 ---
2025-05-04 07:55:18,370 - INFO - [train_rl.py:617] - 验证结果 Epoch 26:
2025-05-04 07:55:18,371 - INFO - [train_rl.py:619] -   BLEU: 71.3639
2025-05-04 07:55:18,371 - INFO - [train_rl.py:619] -   EditDistance: 15.8749
2025-05-04 07:55:18,371 - INFO - [train_rl.py:619] -   ExactMatch: 10.6571
2025-05-04 09:39:04,908 - INFO - [train_rl.py:559] - Epoch 27 训练结束. Avg Loss: 0.5525, Avg CE Loss: 0.5920, Avg RL Loss: -0.3950, Avg Reward: 0.9755, Time: 6226.42s
2025-05-04 09:39:04,908 - INFO - [train_rl.py:568] - --- 开始验证 Epoch 27 ---
2025-05-04 09:44:19,551 - INFO - [train_rl.py:617] - 验证结果 Epoch 27:
2025-05-04 09:44:19,551 - INFO - [train_rl.py:619] -   BLEU: 72.7899
2025-05-04 09:44:19,551 - INFO - [train_rl.py:619] -   EditDistance: 14.1636
2025-05-04 09:44:19,551 - INFO - [train_rl.py:619] -   ExactMatch: 11.1828
2025-05-04 09:44:19,551 - INFO - [train_rl.py:633] - *** 新的最佳验证指标 (ExactMatch): 11.1828 ***
2025-05-04 09:44:22,357 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-04 09:44:22,358 - INFO - [train_rl.py:673] - 检查点操作: 最佳模型已更新 (ExactMatch: 11.1828) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 11:29:36,254 - INFO - [train_rl.py:559] - Epoch 28 训练结束. Avg Loss: 0.5232, Avg CE Loss: 0.5632, Avg RL Loss: -0.4000, Avg Reward: 0.9764, Time: 6313.76s
2025-05-04 11:29:36,254 - INFO - [train_rl.py:568] - --- 开始验证 Epoch 28 ---
2025-05-04 11:35:24,398 - INFO - [train_rl.py:617] - 验证结果 Epoch 28:
2025-05-04 11:35:24,398 - INFO - [train_rl.py:619] -   BLEU: 73.6261
2025-05-04 11:35:24,399 - INFO - [train_rl.py:619] -   EditDistance: 13.9823
2025-05-04 11:35:24,399 - INFO - [train_rl.py:619] -   ExactMatch: 11.9952
2025-05-04 11:35:24,399 - INFO - [train_rl.py:633] - *** 新的最佳验证指标 (ExactMatch): 11.9952 ***
2025-05-04 11:35:27,024 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-04 11:35:27,025 - INFO - [train_rl.py:673] - 检查点操作: 最佳模型已更新 (ExactMatch: 11.9952) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 13:16:20,625 - INFO - [train_rl.py:559] - Epoch 29 训练结束. Avg Loss: 0.5025, Avg CE Loss: 0.5392, Avg RL Loss: -0.3676, Avg Reward: 0.9775, Time: 6053.47s
2025-05-04 13:16:20,626 - INFO - [train_rl.py:568] - --- 开始验证 Epoch 29 ---
2025-05-04 13:22:57,626 - INFO - [train_rl.py:617] - 验证结果 Epoch 29:
2025-05-04 13:22:57,626 - INFO - [train_rl.py:619] -   BLEU: 74.1332
2025-05-04 13:22:57,626 - INFO - [train_rl.py:619] -   EditDistance: 14.2585
2025-05-04 13:22:57,626 - INFO - [train_rl.py:619] -   ExactMatch: 12.7838
2025-05-04 13:22:57,626 - INFO - [train_rl.py:633] - *** 新的最佳验证指标 (ExactMatch): 12.7838 ***
2025-05-04 13:23:00,453 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-04 13:23:00,454 - INFO - [train_rl.py:673] - 检查点操作: 最佳模型已更新 (ExactMatch: 12.7838) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 15:01:37,214 - INFO - [train_rl.py:559] - Epoch 30 训练结束. Avg Loss: 0.4813, Avg CE Loss: 0.5164, Avg RL Loss: -0.3509, Avg Reward: 0.9782, Time: 5916.63s
2025-05-04 15:01:37,214 - INFO - [train_rl.py:568] - --- 开始验证 Epoch 30 ---
2025-05-04 15:08:31,651 - INFO - [train_rl.py:617] - 验证结果 Epoch 30:
2025-05-04 15:08:31,651 - INFO - [train_rl.py:619] -   BLEU: 74.3638
2025-05-04 15:08:31,651 - INFO - [train_rl.py:619] -   EditDistance: 14.4086
2025-05-04 15:08:31,651 - INFO - [train_rl.py:619] -   ExactMatch: 13.3811
2025-05-04 15:08:31,652 - INFO - [train_rl.py:633] - *** 新的最佳验证指标 (ExactMatch): 13.3811 ***
2025-05-04 15:08:34,589 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-04 15:08:34,590 - INFO - [train_rl.py:673] - 检查点操作: 最佳模型已更新 (ExactMatch: 13.3811) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 16:00:12,361 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-04 16:00:12,362 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 16:00:12,362 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-04 16:00:12,362 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-04 16:00:12,412 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-04 16:00:12,453 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-04 16:00:12,453 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-04 16:00:12,454 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-04 16:00:12,454 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-04 16:00:12,454 - INFO - [train_rl.py:182] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-04 16:00:12,455 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-04 16:00:12,767 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 16:00:18,061 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 16:00:18,065 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-04 16:00:18,102 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 16:00:18,753 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 16:00:18,755 - INFO - [train_rl.py:211] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-04 16:00:18,755 - INFO - [train_rl.py:220] - 初始化模型...
2025-05-04 16:00:22,249 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-04 16:00:22,752 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-04 16:00:24,202 - INFO - [train_rl.py:234] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-04 16:00:25,523 - INFO - [train_rl.py:263] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-04 16:00:26,547 - INFO - [train_rl.py:271] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-04 16:00:26,552 - INFO - [train_rl.py:285] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-04 16:00:26,553 - INFO - [train_rl.py:317] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-04 16:00:26,553 - INFO - [train_rl.py:329] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.1
2025-05-04 16:00:26,553 - INFO - [train_rl.py:347] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-04 16:00:26,553 - INFO - [train_rl.py:351] - ========================================
2025-05-04 16:00:26,553 - INFO - [train_rl.py:352] - 开始 RL 训练循环...
2025-05-04 16:00:26,554 - INFO - [train_rl.py:353] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-04 16:00:26,554 - INFO - [train_rl.py:354] - ========================================
2025-05-04 16:00:26,554 - INFO - [train_rl.py:365] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-04 16:00:26,554 - INFO - [train_rl.py:368] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-04 16:00:26,554 - INFO - [train_rl.py:370] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-04 16:00:28,098 - INFO - [train_rl.py:380] - 从 Epoch 30 恢复训练, 当前最佳指标: 13.3811
2025-05-04 16:05:33,713 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-04 16:05:33,713 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 16:05:33,713 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-04 16:05:33,713 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-04 16:05:33,762 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-04 16:05:33,798 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-04 16:05:33,798 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-04 16:05:33,799 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-04 16:05:33,799 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-04 16:05:33,799 - INFO - [train_rl.py:182] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-04 16:05:33,800 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-04 16:05:34,102 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 16:05:39,618 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 16:05:39,622 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-04 16:05:39,658 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 16:05:40,234 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 16:05:40,235 - INFO - [train_rl.py:211] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-04 16:05:40,235 - INFO - [train_rl.py:220] - 初始化模型...
2025-05-04 16:05:43,957 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-04 16:05:44,403 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-04 16:05:45,762 - INFO - [train_rl.py:234] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-04 16:05:46,939 - INFO - [train_rl.py:263] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-04 16:05:48,025 - INFO - [train_rl.py:271] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-04 16:05:48,028 - INFO - [train_rl.py:285] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-04 16:05:48,028 - INFO - [train_rl.py:317] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-04 16:05:48,029 - INFO - [train_rl.py:329] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.05
2025-05-04 16:05:48,029 - INFO - [train_rl.py:347] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-04 16:05:48,029 - INFO - [train_rl.py:351] - ========================================
2025-05-04 16:05:48,029 - INFO - [train_rl.py:352] - 开始 RL 训练循环...
2025-05-04 16:05:48,029 - INFO - [train_rl.py:353] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-04 16:05:48,029 - INFO - [train_rl.py:354] - ========================================
2025-05-04 16:05:48,029 - INFO - [train_rl.py:365] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-04 16:05:48,029 - INFO - [train_rl.py:368] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-04 16:05:48,029 - INFO - [train_rl.py:370] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-04 16:05:49,708 - INFO - [train_rl.py:380] - 从 Epoch 30 恢复训练, 当前最佳指标: 13.3811
2025-05-04 17:45:10,999 - INFO - [train_rl.py:587] - Epoch 31 训练结束. Avg Loss: 0.2602, Avg CE Loss: 0.4913, Avg RL Loss: -4.6228, Avg Reward: 1.1595, Time: 5958.41s
2025-05-04 17:45:11,000 - INFO - [train_rl.py:596] - --- 开始验证 Epoch 31 ---
2025-05-04 17:51:21,683 - INFO - [train_rl.py:645] - 验证结果 Epoch 31:
2025-05-04 17:51:21,683 - INFO - [train_rl.py:647] -   BLEU: 75.8716
2025-05-04 17:51:21,683 - INFO - [train_rl.py:647] -   EditDistance: 12.9612
2025-05-04 17:51:21,683 - INFO - [train_rl.py:647] -   ExactMatch: 14.4683
2025-05-04 17:51:21,683 - INFO - [train_rl.py:661] - *** 新的最佳验证指标 (ExactMatch): 14.4683 ***
2025-05-04 17:51:24,696 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-04 17:51:24,696 - INFO - [train_rl.py:701] - 检查点操作: 最佳模型已更新 (ExactMatch: 14.4683) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 17:58:48,356 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-04 17:58:48,356 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 17:58:48,356 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-04 17:58:48,356 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-04 17:58:48,417 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-04 17:58:48,458 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-04 17:58:48,458 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-04 17:58:48,459 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-04 17:58:48,459 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-04 17:58:48,460 - INFO - [train_rl.py:182] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-04 17:58:48,460 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-04 17:58:48,791 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 17:58:54,564 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 17:58:54,571 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-04 17:58:54,607 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 17:58:55,194 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 17:58:55,196 - INFO - [train_rl.py:211] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-04 17:58:55,196 - INFO - [train_rl.py:220] - 初始化模型...
2025-05-04 17:58:59,471 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-04 17:59:00,322 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-04 17:59:02,218 - INFO - [train_rl.py:234] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-04 17:59:03,799 - INFO - [train_rl.py:263] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-04 17:59:04,939 - INFO - [train_rl.py:271] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-04 17:59:04,942 - INFO - [train_rl.py:285] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-04 17:59:04,943 - INFO - [train_rl.py:317] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-04 17:59:04,943 - INFO - [train_rl.py:329] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.05
2025-05-04 17:59:04,943 - INFO - [train_rl.py:347] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-04 17:59:04,943 - INFO - [train_rl.py:351] - ========================================
2025-05-04 17:59:04,943 - INFO - [train_rl.py:352] - 开始 RL 训练循环...
2025-05-04 17:59:04,943 - INFO - [train_rl.py:353] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-04 17:59:04,943 - INFO - [train_rl.py:354] - ========================================
2025-05-04 17:59:04,944 - INFO - [train_rl.py:365] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-04 17:59:04,944 - INFO - [train_rl.py:368] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-04 17:59:04,944 - INFO - [train_rl.py:370] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-04 17:59:06,572 - INFO - [train_rl.py:380] - 从 Epoch 31 恢复训练, 当前最佳指标: 14.4683
2025-05-04 19:39:04,439 - INFO - [train_rl.py:587] - Epoch 32 训练结束. Avg Loss: 0.1524, Avg CE Loss: 0.4621, Avg RL Loss: -6.1945, Avg Reward: 1.2436, Time: 5995.61s
2025-05-04 19:39:04,440 - INFO - [train_rl.py:596] - --- 开始验证 Epoch 32 ---
2025-05-04 19:45:40,416 - INFO - [train_rl.py:645] - 验证结果 Epoch 32:
2025-05-04 19:45:40,416 - INFO - [train_rl.py:647] -   BLEU: 76.4597
2025-05-04 19:45:40,417 - INFO - [train_rl.py:647] -   EditDistance: 12.6379
2025-05-04 19:45:40,417 - INFO - [train_rl.py:647] -   ExactMatch: 14.7909
2025-05-04 19:45:40,417 - INFO - [train_rl.py:661] - *** 新的最佳验证指标 (ExactMatch): 14.7909 ***
2025-05-04 19:45:40,422 - INFO - [train_rl.py:679] - Epoch 32 满足保存间隔 (8)，将保存检查点。
2025-05-04 19:45:42,364 - INFO - [utils.py:90] - Epoch checkpoint saved to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/checkpoint_epoch_32.pth.tar
2025-05-04 19:45:44,216 - INFO - [utils.py:104] - *** Best checkpoint saved (copied from epoch) to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-04 19:45:44,217 - INFO - [train_rl.py:701] - 检查点操作: 最佳模型已更新 (ExactMatch: 14.7909), Epoch 32 检查点已保存 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 19:55:36,634 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-04 19:55:36,634 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 19:55:36,634 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-04 19:55:36,634 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-04 19:55:36,690 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-04 19:55:36,708 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-04 19:55:36,708 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-04 19:55:36,709 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-04 19:55:36,709 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-04 19:55:36,709 - INFO - [train_rl.py:182] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-04 19:55:36,709 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-04 19:55:37,029 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 19:55:42,533 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 19:55:42,537 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-04 19:55:42,574 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 19:55:43,175 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 19:55:43,176 - INFO - [train_rl.py:211] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-04 19:55:43,177 - INFO - [train_rl.py:220] - 初始化模型...
2025-05-04 19:55:47,077 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-04 19:55:47,944 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-04 19:55:49,524 - INFO - [train_rl.py:234] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-04 19:55:50,797 - INFO - [train_rl.py:263] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-04 19:55:51,939 - INFO - [train_rl.py:271] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-04 19:55:51,943 - INFO - [train_rl.py:285] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-04 19:55:51,943 - INFO - [train_rl.py:317] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-04 19:55:51,943 - INFO - [train_rl.py:329] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.025
2025-05-04 19:55:51,943 - INFO - [train_rl.py:347] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-04 19:55:51,943 - INFO - [train_rl.py:351] - ========================================
2025-05-04 19:55:51,944 - INFO - [train_rl.py:352] - 开始 RL 训练循环...
2025-05-04 19:55:51,944 - INFO - [train_rl.py:353] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-04 19:55:51,944 - INFO - [train_rl.py:354] - ========================================
2025-05-04 19:55:51,944 - INFO - [train_rl.py:365] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-04 19:55:51,944 - INFO - [train_rl.py:368] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-04 19:55:51,944 - INFO - [train_rl.py:370] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-04 19:55:53,425 - INFO - [train_rl.py:380] - 从 Epoch 32 恢复训练, 当前最佳指标: 14.7909
2025-05-04 21:30:55,234 - INFO - [train_rl.py:587] - Epoch 33 训练结束. Avg Loss: 0.1317, Avg CE Loss: 0.4387, Avg RL Loss: -12.2813, Avg Reward: 1.5463, Time: 5699.51s
2025-05-04 21:30:55,235 - INFO - [train_rl.py:596] - --- 开始验证 Epoch 33 ---
2025-05-04 21:45:21,714 - INFO - [train_rl.py:645] - 验证结果 Epoch 33:
2025-05-04 21:45:21,714 - INFO - [train_rl.py:647] -   BLEU: 77.7983
2025-05-04 21:45:21,714 - INFO - [train_rl.py:647] -   EditDistance: 10.0473
2025-05-04 21:45:21,714 - INFO - [train_rl.py:647] -   ExactMatch: 15.3405
2025-05-04 21:45:21,714 - INFO - [train_rl.py:661] - *** 新的最佳验证指标 (ExactMatch): 15.3405 ***
2025-05-04 21:45:24,643 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-04 21:45:24,643 - INFO - [train_rl.py:701] - 检查点操作: 最佳模型已更新 (ExactMatch: 15.3405) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 22:08:11,510 - INFO - [train_rl.py:82] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-04 22:08:11,510 - INFO - [train_rl.py:83] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 22:08:11,510 - INFO - [train_rl.py:84] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-04 22:08:11,510 - INFO - [train_rl.py:85] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-04 22:08:11,564 - INFO - [train_rl.py:95] - 全局随机种子设置为: 42
2025-05-04 22:08:11,604 - INFO - [train_rl.py:101] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-04 22:08:11,604 - INFO - [train_rl.py:105] - 使用设备: cuda
2025-05-04 22:08:11,605 - INFO - [train_rl.py:124] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2, CLS=4, SEP=5
2025-05-04 22:08:11,605 - INFO - [train_rl.py:133] - 创建数据加载器...
2025-05-04 22:08:11,606 - INFO - [train_rl.py:182] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-04 22:08:11,606 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-04 22:08:11,927 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 22:08:17,266 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 22:08:17,269 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-04 22:08:17,304 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 22:08:17,886 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 22:08:17,887 - INFO - [train_rl.py:211] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-04 22:08:17,888 - INFO - [train_rl.py:220] - 初始化模型...
2025-05-04 22:08:22,957 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-04 22:08:23,651 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-04 22:08:26,259 - INFO - [train_rl.py:234] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-04 22:08:27,763 - INFO - [train_rl.py:263] - 加载预训练 Feature Extractor 权重从: /root/lanyun-tmp/LaTeX_OCR/checkpoints/feature_extractor/epoch_64.pt
2025-05-04 22:08:28,900 - INFO - [train_rl.py:271] - Feature Extractor 设置为评估模式，参数已冻结。
2025-05-04 22:08:28,903 - INFO - [train_rl.py:285] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-04 22:08:28,903 - INFO - [train_rl.py:317] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-04 22:08:28,903 - INFO - [train_rl.py:329] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.03
2025-05-04 22:08:28,903 - INFO - [train_rl.py:347] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-04 22:08:28,903 - INFO - [train_rl.py:351] - ========================================
2025-05-04 22:08:28,903 - INFO - [train_rl.py:352] - 开始 RL 训练循环...
2025-05-04 22:08:28,904 - INFO - [train_rl.py:353] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-04 22:08:28,904 - INFO - [train_rl.py:354] - ========================================
2025-05-04 22:08:28,904 - INFO - [train_rl.py:365] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-04 22:08:28,904 - INFO - [train_rl.py:368] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-04 22:08:28,904 - INFO - [train_rl.py:370] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-04 22:08:30,286 - INFO - [train_rl.py:380] - 从 Epoch 33 恢复训练, 当前最佳指标: 15.3405
2025-05-04 23:42:12,040 - INFO - [train_rl.py:587] - Epoch 34 训练结束. Avg Loss: 0.1776, Avg CE Loss: 0.4162, Avg RL Loss: -7.9525, Avg Reward: 1.3641, Time: 5619.32s
2025-05-04 23:42:12,040 - INFO - [train_rl.py:596] - --- 开始验证 Epoch 34 ---
2025-05-04 23:47:41,496 - INFO - [train_rl.py:645] - 验证结果 Epoch 34:
2025-05-04 23:47:41,496 - INFO - [train_rl.py:647] -   BLEU: 77.3553
2025-05-04 23:47:41,496 - INFO - [train_rl.py:647] -   EditDistance: 11.5906
2025-05-04 23:47:41,496 - INFO - [train_rl.py:647] -   ExactMatch: 15.7467
2025-05-04 23:47:41,496 - INFO - [train_rl.py:661] - *** 新的最佳验证指标 (ExactMatch): 15.7467 ***
2025-05-04 23:47:44,239 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-04 23:47:44,240 - INFO - [train_rl.py:701] - 检查点操作: 最佳模型已更新 (ExactMatch: 15.7467) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 23:56:21,452 - INFO - [train_rl.py:78] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-04 23:56:21,452 - INFO - [train_rl.py:79] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-04 23:56:21,452 - INFO - [train_rl.py:80] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-04 23:56:21,452 - INFO - [train_rl.py:81] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-04 23:56:21,508 - INFO - [train_rl.py:90] - 全局随机种子设置为: 42
2025-05-04 23:56:21,544 - INFO - [train_rl.py:95] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-04 23:56:21,544 - INFO - [train_rl.py:99] - 使用设备: cuda
2025-05-04 23:56:21,545 - INFO - [train_rl.py:119] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-04 23:56:21,545 - INFO - [train_rl.py:128] - 创建数据加载器...
2025-05-04 23:56:21,545 - INFO - [train_rl.py:156] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-04 23:56:21,545 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-04 23:56:21,874 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 23:56:27,309 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 23:56:27,319 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-04 23:56:27,362 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-04 23:56:27,959 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-04 23:56:27,961 - INFO - [train_rl.py:162] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-04 23:56:27,961 - INFO - [train_rl.py:169] - 初始化模型...
2025-05-04 23:56:33,495 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-04 23:56:34,242 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-04 23:56:36,875 - INFO - [train_rl.py:184] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-04 23:56:36,875 - INFO - [train_rl.py:224] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-04 23:56:36,878 - INFO - [train_rl.py:233] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-04 23:56:36,878 - INFO - [train_rl.py:253] - 调度器: CosineAnnealingLR (T_max=23564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-04 23:56:36,878 - INFO - [train_rl.py:262] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-04 23:56:36,878 - INFO - [train_rl.py:274] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-04 23:56:36,879 - INFO - [train_rl.py:277] - ========================================
2025-05-04 23:56:36,879 - INFO - [train_rl.py:278] - 开始训练循环...
2025-05-04 23:56:36,879 - INFO - [train_rl.py:279] - 总轮数: 64, 每轮更新次数: 376, 总步数: 24064
2025-05-04 23:56:36,879 - INFO - [train_rl.py:280] - ========================================
2025-05-04 23:56:36,879 - INFO - [train_rl.py:291] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-04 23:56:36,879 - INFO - [train_rl.py:293] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-04 23:56:36,879 - INFO - [train_rl.py:294] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-04 23:56:38,387 - INFO - [train_rl.py:300] - 从 Epoch 34 恢复训练, 当前最佳指标: 15.7467
2025-05-05 00:00:34,406 - INFO - [train_rl.py:473] - Epoch 35 训练结束. Avg Loss: 0.4360, Avg CE Loss: 0.4360, Time: 233.70s
2025-05-05 00:00:34,407 - INFO - [train_rl.py:479] - --- 开始验证 Epoch 35 ---
2025-05-05 00:06:18,768 - INFO - [train_rl.py:500] - 验证结果 Epoch 35:
2025-05-05 00:06:18,768 - INFO - [train_rl.py:501] -   BLEU: 77.4796
2025-05-05 00:06:18,768 - INFO - [train_rl.py:501] -   EditDistance: 11.7250
2025-05-05 00:06:18,768 - INFO - [train_rl.py:501] -   ExactMatch: 15.9976
2025-05-05 00:06:18,768 - INFO - [train_rl.py:508] - *** 新的最佳验证指标 (ExactMatch): 15.9976 ***
2025-05-05 00:06:21,752 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 00:06:21,752 - INFO - [train_rl.py:517] - 检查点操作: 最佳模型已更新 (ExactMatch: 15.9976) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 00:16:26,877 - INFO - [train_rl.py:77] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 00:16:26,877 - INFO - [train_rl.py:78] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 00:16:26,877 - INFO - [train_rl.py:79] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 00:16:26,877 - INFO - [train_rl.py:80] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 00:16:26,943 - INFO - [train_rl.py:89] - 全局随机种子设置为: 42
2025-05-05 00:16:26,986 - INFO - [train_rl.py:94] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 00:16:26,986 - INFO - [train_rl.py:98] - 使用设备: cuda
2025-05-05 00:16:26,986 - INFO - [train_rl.py:120] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 00:16:26,986 - INFO - [train_rl.py:129] - 创建数据加载器...
2025-05-05 00:16:26,987 - INFO - [train_rl.py:153] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 00:16:26,987 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 00:16:27,312 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 00:16:32,937 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 00:16:32,946 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 00:16:32,990 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 00:16:33,684 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 00:16:33,685 - INFO - [train_rl.py:159] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 00:16:33,685 - INFO - [train_rl.py:166] - 初始化模型...
2025-05-05 00:16:39,151 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 00:16:39,684 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 00:16:43,435 - INFO - [train_rl.py:181] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 00:16:43,435 - INFO - [train_rl.py:227] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 00:16:43,437 - INFO - [train_rl.py:235] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-05 00:16:43,438 - INFO - [train_rl.py:254] - 调度器: CosineAnnealingLR (T_max=15564, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 00:16:43,438 - INFO - [train_rl.py:262] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 00:16:43,438 - INFO - [train_rl.py:274] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 00:16:43,438 - INFO - [train_rl.py:277] - ========================================
2025-05-05 00:16:43,438 - INFO - [train_rl.py:278] - 开始训练循环...
2025-05-05 00:16:43,438 - INFO - [train_rl.py:279] - 总轮数: 64, 每轮更新次数: 251, 总步数: 16064
2025-05-05 00:16:43,438 - INFO - [train_rl.py:280] - ========================================
2025-05-05 00:16:43,438 - INFO - [train_rl.py:291] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 00:16:43,438 - INFO - [train_rl.py:293] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 00:16:43,439 - INFO - [train_rl.py:294] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 00:16:44,998 - INFO - [train_rl.py:309] - 从 Epoch 35 恢复训练, 当前最佳指标: 15.9976
2025-05-05 00:17:39,662 - INFO - [train_rl.py:77] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 00:17:39,662 - INFO - [train_rl.py:78] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 00:17:39,662 - INFO - [train_rl.py:79] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 00:17:39,662 - INFO - [train_rl.py:80] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 00:17:39,691 - INFO - [train_rl.py:89] - 全局随机种子设置为: 42
2025-05-05 00:17:39,711 - INFO - [train_rl.py:94] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 00:17:39,711 - INFO - [train_rl.py:98] - 使用设备: cuda
2025-05-05 00:17:39,711 - INFO - [train_rl.py:120] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 00:17:39,712 - INFO - [train_rl.py:129] - 创建数据加载器...
2025-05-05 00:17:39,712 - INFO - [train_rl.py:153] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 00:17:39,713 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 00:17:40,027 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 00:17:45,386 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 00:17:45,394 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 00:17:45,439 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 00:17:45,990 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 00:17:45,991 - INFO - [train_rl.py:159] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 00:17:45,991 - INFO - [train_rl.py:166] - 初始化模型...
2025-05-05 00:17:51,351 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 00:17:52,230 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 00:17:55,695 - INFO - [train_rl.py:181] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 00:17:55,695 - INFO - [train_rl.py:227] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 00:17:55,697 - INFO - [train_rl.py:235] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-05 00:17:55,698 - INFO - [train_rl.py:254] - 调度器: CosineAnnealingLR (T_max=19596, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 00:17:55,698 - INFO - [train_rl.py:262] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 00:17:55,698 - INFO - [train_rl.py:274] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 00:17:55,698 - INFO - [train_rl.py:277] - ========================================
2025-05-05 00:17:55,698 - INFO - [train_rl.py:278] - 开始训练循环...
2025-05-05 00:17:55,698 - INFO - [train_rl.py:279] - 总轮数: 64, 每轮更新次数: 314, 总步数: 20096
2025-05-05 00:17:55,698 - INFO - [train_rl.py:280] - ========================================
2025-05-05 00:17:55,698 - INFO - [train_rl.py:291] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 00:17:55,698 - INFO - [train_rl.py:293] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 00:17:55,698 - INFO - [train_rl.py:294] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 00:17:57,531 - INFO - [train_rl.py:309] - 从 Epoch 35 恢复训练, 当前最佳指标: 15.9976
2025-05-05 00:21:52,916 - INFO - [train_rl.py:511] - Epoch 36 训练结束. Avg Loss: 0.4200, Avg CE Loss: 0.4200, Time: 233.07s
2025-05-05 00:21:52,917 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 36 ---
2025-05-05 00:28:13,162 - INFO - [train_rl.py:561] - 验证结果 Epoch 36:
2025-05-05 00:28:13,162 - INFO - [train_rl.py:562] -   BLEU: 78.1379
2025-05-05 00:28:13,162 - INFO - [train_rl.py:562] -   EditDistance: 10.9682
2025-05-05 00:28:13,162 - INFO - [train_rl.py:562] -   ExactMatch: 17.0609
2025-05-05 00:28:13,162 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 17.0609 ***
2025-05-05 00:28:16,055 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 00:28:16,055 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 17.0609) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 00:41:42,562 - INFO - [train_rl.py:74] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 00:41:42,563 - INFO - [train_rl.py:75] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 00:41:42,563 - INFO - [train_rl.py:76] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 00:41:42,563 - INFO - [train_rl.py:77] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 00:41:42,674 - INFO - [train_rl.py:86] - 全局随机种子设置为: 42
2025-05-05 00:41:42,714 - INFO - [train_rl.py:91] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 00:41:42,715 - INFO - [train_rl.py:95] - 使用设备: cuda
2025-05-05 00:41:42,715 - INFO - [train_rl.py:125] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 00:41:42,715 - INFO - [train_rl.py:128] - RL 配置: lambda_rl=0.1, reward_components=['exact_match'], exact_match_bonus=3.0
2025-05-05 00:41:42,716 - INFO - [train_rl.py:136] - 创建数据加载器...
2025-05-05 00:41:42,716 - INFO - [train_rl.py:160] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 00:41:42,716 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 00:41:43,034 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 00:41:48,392 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 00:41:48,395 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 00:41:48,432 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 00:41:48,985 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 00:41:48,986 - INFO - [train_rl.py:166] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 00:41:48,986 - INFO - [train_rl.py:173] - 初始化模型...
2025-05-05 00:41:54,594 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 00:41:55,926 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 00:41:58,360 - INFO - [train_rl.py:189] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 00:41:58,360 - INFO - [train_rl.py:231] - RL 训练启用但不需要 Cosine 奖励，跳过加载 Feature Extractor。
2025-05-05 00:41:58,362 - INFO - [train_rl.py:241] - 优化器: AdamW (lr=1e-05, weight_decay=0.01) for OCR Model
2025-05-05 00:41:58,362 - INFO - [train_rl.py:260] - 调度器: CosineAnnealingLR (T_max=160268, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 00:41:58,362 - INFO - [train_rl.py:268] - 损失函数: CrossEntropy (ignore_index=0), RL Weight (lambda_rl)=0.1, Components=['exact_match']
2025-05-05 00:41:58,363 - INFO - [train_rl.py:280] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 00:41:58,363 - INFO - [train_rl.py:283] - ========================================
2025-05-05 00:41:58,363 - INFO - [train_rl.py:284] - 开始训练循环...
2025-05-05 00:41:58,363 - INFO - [train_rl.py:285] - 总轮数: 512, 每轮更新次数: 314, 总步数: 160768
2025-05-05 00:41:58,363 - INFO - [train_rl.py:286] - ========================================
2025-05-05 00:41:58,363 - INFO - [train_rl.py:297] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 00:41:58,363 - INFO - [train_rl.py:299] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 00:41:58,363 - INFO - [train_rl.py:300] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 00:41:59,876 - INFO - [train_rl.py:310] - AMP Scaler state restored.
2025-05-05 00:41:59,876 - INFO - [train_rl.py:316] - 从 Epoch 36 恢复训练, 当前最佳指标: 17.0609, global_step 重置为: 11304
2025-05-05 00:46:57,623 - INFO - [train_rl.py:74] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 00:46:57,623 - INFO - [train_rl.py:75] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 00:46:57,623 - INFO - [train_rl.py:76] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 00:46:57,623 - INFO - [train_rl.py:77] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 00:46:57,676 - INFO - [train_rl.py:86] - 全局随机种子设置为: 42
2025-05-05 00:46:57,722 - INFO - [train_rl.py:91] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 00:46:57,722 - INFO - [train_rl.py:95] - 使用设备: cuda
2025-05-05 00:46:57,724 - INFO - [train_rl.py:125] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 00:46:57,724 - INFO - [train_rl.py:128] - RL 配置: lambda_rl=0.0, reward_components=['exact_match'], exact_match_bonus=3.0
2025-05-05 00:46:57,724 - INFO - [train_rl.py:136] - 创建数据加载器...
2025-05-05 00:46:57,726 - INFO - [train_rl.py:160] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 00:46:57,726 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 00:46:58,058 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 00:47:03,161 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 00:47:03,165 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 00:47:03,197 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 00:47:03,745 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 00:47:03,746 - INFO - [train_rl.py:166] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 00:47:03,747 - INFO - [train_rl.py:173] - 初始化模型...
2025-05-05 00:47:08,847 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 00:47:09,334 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 00:47:13,221 - INFO - [train_rl.py:189] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 00:47:13,222 - INFO - [train_rl.py:233] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 00:47:13,224 - INFO - [train_rl.py:241] - 优化器: AdamW (lr=1e-05, weight_decay=0.01) for OCR Model
2025-05-05 00:47:13,224 - INFO - [train_rl.py:260] - 调度器: CosineAnnealingLR (T_max=160268, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 00:47:13,224 - INFO - [train_rl.py:268] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 00:47:13,225 - INFO - [train_rl.py:280] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 00:47:13,225 - INFO - [train_rl.py:283] - ========================================
2025-05-05 00:47:13,225 - INFO - [train_rl.py:284] - 开始训练循环...
2025-05-05 00:47:13,225 - INFO - [train_rl.py:285] - 总轮数: 512, 每轮更新次数: 314, 总步数: 160768
2025-05-05 00:47:13,225 - INFO - [train_rl.py:286] - ========================================
2025-05-05 00:47:13,225 - INFO - [train_rl.py:297] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 00:47:13,225 - INFO - [train_rl.py:299] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 00:47:13,225 - INFO - [train_rl.py:300] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 00:47:14,900 - INFO - [train_rl.py:310] - AMP Scaler state restored.
2025-05-05 00:47:14,900 - INFO - [train_rl.py:316] - 从 Epoch 36 恢复训练, 当前最佳指标: 17.0609, global_step 重置为: 11304
2025-05-05 00:51:09,824 - INFO - [train_rl.py:539] - Epoch 37 训练结束. Avg Loss: 0.3866, Avg CE Loss: 0.3866, Time: 232.67s
2025-05-05 00:51:09,824 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 37 ---
2025-05-05 00:57:51,374 - INFO - [train_rl.py:594] - 验证结果 Epoch 37:
2025-05-05 00:57:51,374 - INFO - [train_rl.py:595] -   BLEU: 78.6144
2025-05-05 00:57:51,374 - INFO - [train_rl.py:595] -   EditDistance: 10.7799
2025-05-05 00:57:51,374 - INFO - [train_rl.py:595] -   ExactMatch: 17.4074
2025-05-05 00:57:51,374 - INFO - [train_rl.py:607] - *** 新的最佳验证指标 (ExactMatch): 17.4074 ***
2025-05-05 00:57:54,223 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 00:57:54,223 - INFO - [train_rl.py:630] - 检查点操作: 最佳模型已更新 (ExactMatch: 17.4074) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 01:01:41,889 - INFO - [train_rl.py:539] - Epoch 38 训练结束. Avg Loss: 0.3989, Avg CE Loss: 0.3989, Time: 227.62s
2025-05-05 01:01:41,890 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 38 ---
2025-05-05 01:10:49,289 - INFO - [train_rl.py:539] - Epoch 39 训练结束. Avg Loss: 0.3872, Avg CE Loss: 0.3872, Time: 227.12s
2025-05-05 01:10:49,289 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 39 ---
2025-05-05 01:18:24,042 - INFO - [train_rl.py:74] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 01:18:24,042 - INFO - [train_rl.py:75] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 01:18:24,042 - INFO - [train_rl.py:76] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 01:18:24,042 - INFO - [train_rl.py:77] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 01:18:24,090 - INFO - [train_rl.py:86] - 全局随机种子设置为: 42
2025-05-05 01:18:24,107 - INFO - [train_rl.py:91] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 01:18:24,107 - INFO - [train_rl.py:95] - 使用设备: cuda
2025-05-05 01:18:24,107 - INFO - [train_rl.py:125] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 01:18:24,108 - INFO - [train_rl.py:128] - RL 配置: lambda_rl=0.0, reward_components=['exact_match'], exact_match_bonus=3.0
2025-05-05 01:18:24,108 - INFO - [train_rl.py:136] - 创建数据加载器...
2025-05-05 01:18:24,108 - INFO - [train_rl.py:160] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 01:18:24,108 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 01:18:24,408 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 01:18:29,683 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 01:18:29,687 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 01:18:29,722 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 01:18:30,259 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 01:18:30,260 - INFO - [train_rl.py:166] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 01:18:30,260 - INFO - [train_rl.py:173] - 初始化模型...
2025-05-05 01:18:35,852 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 01:18:37,335 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 01:18:41,028 - INFO - [train_rl.py:189] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 01:18:41,029 - INFO - [train_rl.py:233] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 01:18:41,031 - INFO - [train_rl.py:241] - 优化器: AdamW (lr=1e-05, weight_decay=0.01) for OCR Model
2025-05-05 01:18:41,031 - INFO - [train_rl.py:260] - 调度器: CosineAnnealingLR (T_max=160268, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 01:18:41,031 - INFO - [train_rl.py:268] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 01:18:41,032 - INFO - [train_rl.py:280] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 01:18:41,032 - INFO - [train_rl.py:283] - ========================================
2025-05-05 01:18:41,032 - INFO - [train_rl.py:284] - 开始训练循环...
2025-05-05 01:18:41,032 - INFO - [train_rl.py:285] - 总轮数: 512, 每轮更新次数: 314, 总步数: 160768
2025-05-05 01:18:41,032 - INFO - [train_rl.py:286] - ========================================
2025-05-05 01:18:41,032 - INFO - [train_rl.py:297] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 01:18:41,032 - INFO - [train_rl.py:299] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 01:18:41,032 - INFO - [train_rl.py:300] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 01:18:42,412 - INFO - [train_rl.py:310] - AMP Scaler state restored.
2025-05-05 01:18:42,413 - INFO - [train_rl.py:316] - 从 Epoch 37 恢复训练, 当前最佳指标: 17.4074, global_step 重置为: 11618
2025-05-05 01:22:37,946 - INFO - [train_rl.py:539] - Epoch 38 训练结束. Avg Loss: 0.3606, Avg CE Loss: 0.3606, Time: 233.00s
2025-05-05 01:22:37,947 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 38 ---
2025-05-05 01:28:50,833 - INFO - [train_rl.py:594] - 验证结果 Epoch 38:
2025-05-05 01:28:50,834 - INFO - [train_rl.py:595] -   BLEU: 78.8717
2025-05-05 01:28:50,834 - INFO - [train_rl.py:595] -   EditDistance: 10.5806
2025-05-05 01:28:50,834 - INFO - [train_rl.py:595] -   ExactMatch: 17.7778
2025-05-05 01:28:50,834 - INFO - [train_rl.py:607] - *** 新的最佳验证指标 (ExactMatch): 17.7778 ***
2025-05-05 01:28:53,419 - INFO - [utils.py:108] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 01:28:53,420 - INFO - [train_rl.py:630] - 检查点操作: 最佳模型已更新 (ExactMatch: 17.7778) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 01:32:40,618 - INFO - [train_rl.py:539] - Epoch 39 训练结束. Avg Loss: 0.3913, Avg CE Loss: 0.3913, Time: 227.16s
2025-05-05 01:32:40,618 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 39 ---
2025-05-05 01:41:57,300 - INFO - [train_rl.py:539] - Epoch 40 训练结束. Avg Loss: 0.3790, Avg CE Loss: 0.3790, Time: 226.81s
2025-05-05 01:41:57,300 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 40 ---
2025-05-05 01:45:06,349 - INFO - [train_rl.py:74] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 01:45:06,349 - INFO - [train_rl.py:75] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 01:45:06,349 - INFO - [train_rl.py:76] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 01:45:06,349 - INFO - [train_rl.py:77] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 01:45:06,398 - INFO - [train_rl.py:86] - 全局随机种子设置为: 42
2025-05-05 01:45:06,435 - INFO - [train_rl.py:91] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 01:45:06,435 - INFO - [train_rl.py:95] - 使用设备: cuda
2025-05-05 01:45:06,436 - INFO - [train_rl.py:125] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 01:45:06,436 - INFO - [train_rl.py:128] - RL 配置: lambda_rl=0.0, reward_components=['exact_match'], exact_match_bonus=3.0
2025-05-05 01:45:06,436 - INFO - [train_rl.py:136] - 创建数据加载器...
2025-05-05 01:45:06,437 - INFO - [train_rl.py:160] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 01:45:06,437 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 01:45:06,761 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 01:45:12,158 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 01:45:12,162 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 01:45:12,193 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 01:45:12,774 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 01:45:12,775 - INFO - [train_rl.py:166] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 01:45:12,775 - INFO - [train_rl.py:173] - 初始化模型...
2025-05-05 01:45:17,449 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 01:45:18,175 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 01:45:21,363 - INFO - [train_rl.py:189] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 01:45:21,364 - INFO - [train_rl.py:233] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 01:45:21,366 - INFO - [train_rl.py:241] - 优化器: AdamW (lr=1e-05, weight_decay=0.01) for OCR Model
2025-05-05 01:45:21,366 - INFO - [train_rl.py:260] - 调度器: CosineAnnealingLR (T_max=160268, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 01:45:21,366 - INFO - [train_rl.py:268] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 01:45:21,366 - INFO - [train_rl.py:280] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 01:45:21,366 - INFO - [train_rl.py:283] - ========================================
2025-05-05 01:45:21,366 - INFO - [train_rl.py:284] - 开始训练循环...
2025-05-05 01:45:21,366 - INFO - [train_rl.py:285] - 总轮数: 512, 每轮更新次数: 314, 总步数: 160768
2025-05-05 01:45:21,366 - INFO - [train_rl.py:286] - ========================================
2025-05-05 01:45:21,367 - INFO - [train_rl.py:297] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 01:45:21,367 - INFO - [train_rl.py:299] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 01:45:21,367 - INFO - [train_rl.py:300] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 01:45:22,881 - INFO - [train_rl.py:310] - AMP Scaler state restored.
2025-05-05 01:45:22,881 - INFO - [train_rl.py:316] - 从 Epoch 38 恢复训练, 当前最佳指标: 17.7778, global_step 重置为: 11932
2025-05-05 01:49:17,338 - INFO - [train_rl.py:539] - Epoch 39 训练结束. Avg Loss: 0.3363, Avg CE Loss: 0.3363, Time: 232.03s
2025-05-05 01:49:17,338 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 39 ---
2025-05-05 01:54:42,224 - ERROR - [train_rl.py:597] - 计算指标时出错: name 'logger' is not defined
Traceback (most recent call last):
  File "/root/lanyun-tmp/LaTeX_OCR/scripts/train_rl.py", line 585, in train_rl
    metrics = compute_metrics(
  File "/root/lanyun-tmp/LaTeX_OCR/models/utils.py", line 285, in compute_metrics
    logger.info(">>> 进入 compute_metrics") # <-- 日志 A
NameError: name 'logger' is not defined
2025-05-05 01:58:43,396 - INFO - [train_rl.py:77] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 01:58:43,396 - INFO - [train_rl.py:78] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 01:58:43,396 - INFO - [train_rl.py:79] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 01:58:43,396 - INFO - [train_rl.py:80] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 01:58:43,461 - INFO - [train_rl.py:89] - 全局随机种子设置为: 42
2025-05-05 01:58:43,502 - INFO - [train_rl.py:94] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 01:58:43,502 - INFO - [train_rl.py:98] - 使用设备: cuda
2025-05-05 01:58:43,502 - INFO - [train_rl.py:120] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 01:58:43,503 - INFO - [train_rl.py:129] - 创建数据加载器...
2025-05-05 01:58:43,503 - INFO - [train_rl.py:153] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 01:58:43,504 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 01:58:43,808 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 01:58:48,897 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 01:58:48,901 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 01:58:48,939 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 01:58:49,505 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 01:58:49,507 - INFO - [train_rl.py:159] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 01:58:49,508 - INFO - [train_rl.py:166] - 初始化模型...
2025-05-05 01:58:54,071 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 01:58:54,666 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 01:58:57,306 - INFO - [train_rl.py:181] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 01:58:57,307 - INFO - [train_rl.py:227] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 01:58:57,310 - INFO - [train_rl.py:235] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-05 01:58:57,311 - INFO - [train_rl.py:254] - 调度器: CosineAnnealingLR (T_max=160268, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 01:58:57,311 - INFO - [train_rl.py:262] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 01:58:57,311 - INFO - [train_rl.py:274] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 01:58:57,311 - INFO - [train_rl.py:277] - ========================================
2025-05-05 01:58:57,311 - INFO - [train_rl.py:278] - 开始训练循环...
2025-05-05 01:58:57,311 - INFO - [train_rl.py:279] - 总轮数: 512, 每轮更新次数: 314, 总步数: 160768
2025-05-05 01:58:57,312 - INFO - [train_rl.py:280] - ========================================
2025-05-05 01:58:57,312 - INFO - [train_rl.py:291] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 01:58:57,312 - INFO - [train_rl.py:293] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 01:58:57,312 - INFO - [train_rl.py:294] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 01:58:59,112 - INFO - [train_rl.py:309] - 从 Epoch 38 恢复训练, 当前最佳指标: 17.7778
2025-05-05 02:02:54,804 - INFO - [train_rl.py:511] - Epoch 39 训练结束. Avg Loss: 0.3375, Avg CE Loss: 0.3375, Time: 233.26s
2025-05-05 02:02:54,804 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 39 ---
2025-05-05 02:08:21,461 - ERROR - [train_rl.py:564] - 计算指标时出错: name 'logger' is not defined
Traceback (most recent call last):
  File "/root/lanyun-tmp/LaTeX_OCR/scripts/train_rl.py", line 552, in train_rl
    metrics = compute_metrics(
  File "/root/lanyun-tmp/LaTeX_OCR/models/utils.py", line 285, in compute_metrics
    logger.info(">>> 进入 compute_metrics") # <-- 日志 A
NameError: name 'logger' is not defined
2025-05-05 02:09:40,943 - INFO - [train_rl.py:77] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 02:09:40,944 - INFO - [train_rl.py:78] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 02:09:40,944 - INFO - [train_rl.py:79] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 02:09:40,944 - INFO - [train_rl.py:80] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 02:09:41,013 - INFO - [train_rl.py:89] - 全局随机种子设置为: 42
2025-05-05 02:09:41,052 - INFO - [train_rl.py:94] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 02:09:41,052 - INFO - [train_rl.py:98] - 使用设备: cuda
2025-05-05 02:09:41,053 - INFO - [train_rl.py:120] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 02:09:41,053 - INFO - [train_rl.py:129] - 创建数据加载器...
2025-05-05 02:09:41,054 - INFO - [train_rl.py:153] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 02:09:41,054 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 02:09:41,401 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 02:09:46,669 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 02:09:46,673 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 02:09:46,713 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 02:09:47,278 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 02:09:47,279 - INFO - [train_rl.py:159] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 02:09:47,279 - INFO - [train_rl.py:166] - 初始化模型...
2025-05-05 02:09:52,034 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 02:09:52,606 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 02:09:55,519 - INFO - [train_rl.py:181] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 02:09:55,520 - INFO - [train_rl.py:227] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 02:09:55,522 - INFO - [train_rl.py:235] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-05 02:09:55,522 - INFO - [train_rl.py:254] - 调度器: CosineAnnealingLR (T_max=160268, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 02:09:55,522 - INFO - [train_rl.py:262] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 02:09:55,522 - INFO - [train_rl.py:274] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 02:09:55,522 - INFO - [train_rl.py:277] - ========================================
2025-05-05 02:09:55,522 - INFO - [train_rl.py:278] - 开始训练循环...
2025-05-05 02:09:55,522 - INFO - [train_rl.py:279] - 总轮数: 512, 每轮更新次数: 314, 总步数: 160768
2025-05-05 02:09:55,522 - INFO - [train_rl.py:280] - ========================================
2025-05-05 02:09:55,522 - INFO - [train_rl.py:291] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 02:09:55,522 - INFO - [train_rl.py:293] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 02:09:55,522 - INFO - [train_rl.py:294] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 02:09:56,952 - INFO - [train_rl.py:309] - 从 Epoch 38 恢复训练, 当前最佳指标: 17.7778
2025-05-05 02:13:50,751 - INFO - [train_rl.py:511] - Epoch 39 训练结束. Avg Loss: 0.3375, Avg CE Loss: 0.3375, Time: 231.80s
2025-05-05 02:13:50,752 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 39 ---
2025-05-05 02:19:17,227 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 02:19:17,227 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 02:19:17,228 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 02:19:17,621 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 02:19:17,993 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 02:19:18,371 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 02:19:18,761 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 02:19:19,146 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 02:19:19,534 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 02:19:19,917 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 02:19:20,304 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 02:19:20,454 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 02:19:20,454 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 78.54898711085313, 'EditDistance': 10.333333333333334, 'ExactMatch': 17.001194743130227}
2025-05-05 02:19:20,454 - INFO - [train_rl.py:561] - 验证结果 Epoch 39:
2025-05-05 02:19:20,455 - INFO - [train_rl.py:562] -   BLEU: 78.5490
2025-05-05 02:19:20,455 - INFO - [train_rl.py:562] -   EditDistance: 10.3333
2025-05-05 02:19:20,455 - INFO - [train_rl.py:562] -   ExactMatch: 17.0012
2025-05-05 02:23:06,931 - INFO - [train_rl.py:511] - Epoch 40 训练结束. Avg Loss: 0.3850, Avg CE Loss: 0.3850, Time: 226.43s
2025-05-05 02:23:06,932 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 40 ---
2025-05-05 02:28:19,420 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 02:28:19,420 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 02:28:19,420 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 02:28:19,815 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 02:28:20,194 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 02:28:20,602 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 02:28:20,968 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 02:28:21,349 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 02:28:21,718 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 02:28:22,114 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 02:28:22,493 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 02:28:22,637 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 02:28:22,637 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 79.51557152598812, 'EditDistance': 9.857467144563918, 'ExactMatch': 18.57825567502987}
2025-05-05 02:28:22,637 - INFO - [train_rl.py:561] - 验证结果 Epoch 40:
2025-05-05 02:28:22,637 - INFO - [train_rl.py:562] -   BLEU: 79.5156
2025-05-05 02:28:22,637 - INFO - [train_rl.py:562] -   EditDistance: 9.8575
2025-05-05 02:28:22,637 - INFO - [train_rl.py:562] -   ExactMatch: 18.5783
2025-05-05 02:28:22,638 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 18.5783 ***
2025-05-05 02:28:24,892 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 02:28:24,892 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 18.5783) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 02:30:26,030 - INFO - [train_rl.py:74] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 02:30:26,031 - INFO - [train_rl.py:75] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 02:30:26,031 - INFO - [train_rl.py:76] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 02:30:26,031 - INFO - [train_rl.py:77] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 02:30:26,081 - INFO - [train_rl.py:86] - 全局随机种子设置为: 42
2025-05-05 02:30:26,120 - INFO - [train_rl.py:91] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 02:30:26,120 - INFO - [train_rl.py:95] - 使用设备: cuda
2025-05-05 02:30:26,120 - INFO - [train_rl.py:125] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 02:30:26,120 - INFO - [train_rl.py:128] - RL 配置: lambda_rl=0.0, reward_components=['exact_match'], exact_match_bonus=3.0
2025-05-05 02:30:26,121 - INFO - [train_rl.py:136] - 创建数据加载器...
2025-05-05 02:30:26,121 - INFO - [train_rl.py:160] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 02:30:26,121 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 02:30:26,412 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 02:30:31,746 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 02:30:31,750 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 02:30:31,782 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 02:30:32,371 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 02:30:32,372 - INFO - [train_rl.py:166] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 02:30:32,372 - INFO - [train_rl.py:173] - 初始化模型...
2025-05-05 02:30:38,053 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 02:30:38,506 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 02:30:42,046 - INFO - [train_rl.py:189] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 02:30:42,046 - INFO - [train_rl.py:233] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 02:30:42,048 - INFO - [train_rl.py:241] - 优化器: AdamW (lr=1e-05, weight_decay=0.01) for OCR Model
2025-05-05 02:30:42,048 - INFO - [train_rl.py:260] - 调度器: CosineAnnealingLR (T_max=160268, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 02:30:42,049 - INFO - [train_rl.py:268] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 02:30:42,049 - INFO - [train_rl.py:280] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 02:30:42,049 - INFO - [train_rl.py:283] - ========================================
2025-05-05 02:30:42,049 - INFO - [train_rl.py:284] - 开始训练循环...
2025-05-05 02:30:42,049 - INFO - [train_rl.py:285] - 总轮数: 512, 每轮更新次数: 314, 总步数: 160768
2025-05-05 02:30:42,049 - INFO - [train_rl.py:286] - ========================================
2025-05-05 02:30:42,049 - INFO - [train_rl.py:297] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 02:30:42,049 - INFO - [train_rl.py:299] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 02:30:42,049 - INFO - [train_rl.py:300] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 02:30:43,501 - INFO - [train_rl.py:310] - AMP Scaler state restored.
2025-05-05 02:30:43,501 - INFO - [train_rl.py:316] - 从 Epoch 40 恢复训练, 当前最佳指标: 18.5783, global_step 重置为: 12560
2025-05-05 02:34:37,604 - INFO - [train_rl.py:539] - Epoch 41 训练结束. Avg Loss: 0.3120, Avg CE Loss: 0.3120, Time: 231.75s
2025-05-05 02:34:37,605 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 41 ---
2025-05-05 02:39:40,108 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 02:39:40,108 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 02:39:40,108 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 02:39:40,471 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 02:39:40,851 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 02:39:41,198 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 02:39:41,570 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 02:39:41,939 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 02:39:42,287 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 02:39:42,647 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 02:39:43,037 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 02:39:43,182 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 02:39:43,182 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 79.16980826885316, 'EditDistance': 9.751493428912784, 'ExactMatch': 17.69414575866189}
2025-05-05 02:39:43,183 - INFO - [train_rl.py:594] - 验证结果 Epoch 41:
2025-05-05 02:39:43,183 - INFO - [train_rl.py:595] -   BLEU: 79.1698
2025-05-05 02:39:43,183 - INFO - [train_rl.py:595] -   EditDistance: 9.7515
2025-05-05 02:39:43,183 - INFO - [train_rl.py:595] -   ExactMatch: 17.6941
2025-05-05 02:43:30,896 - INFO - [train_rl.py:539] - Epoch 42 训练结束. Avg Loss: 0.3472, Avg CE Loss: 0.3472, Time: 227.66s
2025-05-05 02:43:30,896 - INFO - [train_rl.py:543] - --- 开始验证 Epoch 42 ---
2025-05-05 02:49:05,750 - INFO - [train_rl.py:77] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 02:49:05,750 - INFO - [train_rl.py:78] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 02:49:05,750 - INFO - [train_rl.py:79] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 02:49:05,750 - INFO - [train_rl.py:80] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 02:49:05,800 - INFO - [train_rl.py:89] - 全局随机种子设置为: 42
2025-05-05 02:49:05,841 - INFO - [train_rl.py:94] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 02:49:05,841 - INFO - [train_rl.py:98] - 使用设备: cuda
2025-05-05 02:49:05,841 - INFO - [train_rl.py:120] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 02:49:05,841 - INFO - [train_rl.py:129] - 创建数据加载器...
2025-05-05 02:49:05,842 - INFO - [train_rl.py:153] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 02:49:05,842 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 02:49:06,183 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 02:49:11,585 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 02:49:11,589 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 02:49:11,624 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 02:49:12,196 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 02:49:12,197 - INFO - [train_rl.py:159] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 02:49:12,197 - INFO - [train_rl.py:166] - 初始化模型...
2025-05-05 02:49:16,873 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 02:49:17,378 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 02:49:20,903 - INFO - [train_rl.py:181] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 02:49:20,904 - INFO - [train_rl.py:227] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 02:49:20,906 - INFO - [train_rl.py:235] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-05 02:49:20,906 - INFO - [train_rl.py:254] - 调度器: CosineAnnealingLR (T_max=160268, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 02:49:20,906 - INFO - [train_rl.py:262] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 02:49:20,907 - INFO - [train_rl.py:274] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 02:49:20,907 - INFO - [train_rl.py:277] - ========================================
2025-05-05 02:49:20,907 - INFO - [train_rl.py:278] - 开始训练循环...
2025-05-05 02:49:20,907 - INFO - [train_rl.py:279] - 总轮数: 512, 每轮更新次数: 314, 总步数: 160768
2025-05-05 02:49:20,907 - INFO - [train_rl.py:280] - ========================================
2025-05-05 02:49:20,907 - INFO - [train_rl.py:291] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 02:49:20,907 - INFO - [train_rl.py:293] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 02:49:20,907 - INFO - [train_rl.py:294] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 02:49:22,447 - INFO - [train_rl.py:309] - 从 Epoch 40 恢复训练, 当前最佳指标: 18.5783
2025-05-05 02:53:16,410 - INFO - [train_rl.py:511] - Epoch 41 训练结束. Avg Loss: 0.3120, Avg CE Loss: 0.3120, Time: 231.76s
2025-05-05 02:53:16,411 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 41 ---
2025-05-05 02:58:16,460 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 02:58:16,461 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 02:58:16,461 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 02:58:16,828 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 02:58:17,214 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 02:58:17,590 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 02:58:17,951 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 02:58:18,315 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 02:58:18,676 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 02:58:19,033 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 02:58:19,398 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 02:58:19,543 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 02:58:19,543 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 79.21717094590804, 'EditDistance': 9.703942652329749, 'ExactMatch': 17.77777777777778}
2025-05-05 02:58:19,543 - INFO - [train_rl.py:561] - 验证结果 Epoch 41:
2025-05-05 02:58:19,543 - INFO - [train_rl.py:562] -   BLEU: 79.2172
2025-05-05 02:58:19,544 - INFO - [train_rl.py:562] -   EditDistance: 9.7039
2025-05-05 02:58:19,544 - INFO - [train_rl.py:562] -   ExactMatch: 17.7778
2025-05-05 03:02:07,694 - INFO - [train_rl.py:511] - Epoch 42 训练结束. Avg Loss: 0.3474, Avg CE Loss: 0.3474, Time: 228.08s
2025-05-05 03:02:07,695 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 42 ---
2025-05-05 03:06:37,396 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 03:06:37,396 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 03:06:37,396 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 03:06:37,797 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 03:06:38,170 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 03:06:38,544 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 03:06:38,904 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 03:06:39,276 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 03:06:39,638 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 03:06:40,000 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 03:06:40,367 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 03:06:40,503 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 03:06:40,503 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 79.95507172222925, 'EditDistance': 9.195221027479093, 'ExactMatch': 18.554360812425326}
2025-05-05 03:06:40,503 - INFO - [train_rl.py:561] - 验证结果 Epoch 42:
2025-05-05 03:06:40,503 - INFO - [train_rl.py:562] -   BLEU: 79.9551
2025-05-05 03:06:40,504 - INFO - [train_rl.py:562] -   EditDistance: 9.1952
2025-05-05 03:06:40,504 - INFO - [train_rl.py:562] -   ExactMatch: 18.5544
2025-05-05 03:10:29,233 - INFO - [train_rl.py:511] - Epoch 43 训练结束. Avg Loss: 0.3588, Avg CE Loss: 0.3588, Time: 228.68s
2025-05-05 03:10:29,233 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 43 ---
2025-05-05 03:14:40,275 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 03:14:40,275 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 03:14:40,275 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 03:14:40,626 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 03:14:40,986 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 03:14:41,342 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 03:14:41,695 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 03:14:42,053 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 03:14:42,405 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 03:14:42,771 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 03:14:43,125 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 03:14:43,259 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 03:14:43,259 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 80.18165723663375, 'EditDistance': 9.007048984468339, 'ExactMatch': 19.34289127837515}
2025-05-05 03:14:43,259 - INFO - [train_rl.py:561] - 验证结果 Epoch 43:
2025-05-05 03:14:43,259 - INFO - [train_rl.py:562] -   BLEU: 80.1817
2025-05-05 03:14:43,259 - INFO - [train_rl.py:562] -   EditDistance: 9.0070
2025-05-05 03:14:43,260 - INFO - [train_rl.py:562] -   ExactMatch: 19.3429
2025-05-05 03:14:43,260 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 19.3429 ***
2025-05-05 03:14:45,628 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 03:14:45,629 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 19.3429) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 03:18:34,176 - INFO - [train_rl.py:511] - Epoch 44 训练结束. Avg Loss: 0.3480, Avg CE Loss: 0.3480, Time: 228.52s
2025-05-05 03:18:34,177 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 44 ---
2025-05-05 03:23:07,314 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 03:23:07,314 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 03:23:07,314 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 03:23:07,669 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 03:23:08,032 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 03:23:08,386 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 03:23:08,748 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 03:23:09,098 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 03:23:09,459 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 03:23:09,820 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 03:23:10,179 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 03:23:10,314 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 03:23:10,314 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 80.4637881704162, 'EditDistance': 8.964874551971326, 'ExactMatch': 19.988052568697732}
2025-05-05 03:23:10,314 - INFO - [train_rl.py:561] - 验证结果 Epoch 44:
2025-05-05 03:23:10,314 - INFO - [train_rl.py:562] -   BLEU: 80.4638
2025-05-05 03:23:10,314 - INFO - [train_rl.py:562] -   EditDistance: 8.9649
2025-05-05 03:23:10,315 - INFO - [train_rl.py:562] -   ExactMatch: 19.9881
2025-05-05 03:23:10,315 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 19.9881 ***
2025-05-05 03:23:12,632 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 03:23:12,632 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 19.9881) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 03:27:00,832 - INFO - [train_rl.py:511] - Epoch 45 训练结束. Avg Loss: 0.3399, Avg CE Loss: 0.3399, Time: 228.17s
2025-05-05 03:27:00,832 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 45 ---
2025-05-05 03:32:28,827 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 03:32:28,827 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 03:32:28,827 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 03:32:29,176 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 03:32:29,538 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 03:32:29,884 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 03:32:30,244 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 03:32:30,598 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 03:32:30,952 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 03:32:31,307 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 03:32:31,665 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 03:32:31,796 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 03:32:31,797 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 80.8536702216795, 'EditDistance': 8.977299880525687, 'ExactMatch': 20.023894862604543}
2025-05-05 03:32:31,797 - INFO - [train_rl.py:561] - 验证结果 Epoch 45:
2025-05-05 03:32:31,797 - INFO - [train_rl.py:562] -   BLEU: 80.8537
2025-05-05 03:32:31,797 - INFO - [train_rl.py:562] -   EditDistance: 8.9773
2025-05-05 03:32:31,797 - INFO - [train_rl.py:562] -   ExactMatch: 20.0239
2025-05-05 03:32:31,797 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 20.0239 ***
2025-05-05 03:32:34,070 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 03:32:34,070 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 20.0239) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 03:36:22,038 - INFO - [train_rl.py:511] - Epoch 46 训练结束. Avg Loss: 0.3319, Avg CE Loss: 0.3319, Time: 227.93s
2025-05-05 03:36:22,038 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 46 ---
2025-05-05 03:41:48,760 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 03:41:48,761 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 03:41:48,761 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 03:41:49,125 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 03:41:49,494 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 03:41:49,851 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 03:41:50,290 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 03:41:50,685 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 03:41:51,054 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 03:41:51,435 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 03:41:51,789 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 03:41:51,929 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 03:41:51,929 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 81.11556165469707, 'EditDistance': 8.976463560334528, 'ExactMatch': 20.43010752688172}
2025-05-05 03:41:51,929 - INFO - [train_rl.py:561] - 验证结果 Epoch 46:
2025-05-05 03:41:51,929 - INFO - [train_rl.py:562] -   BLEU: 81.1156
2025-05-05 03:41:51,929 - INFO - [train_rl.py:562] -   EditDistance: 8.9765
2025-05-05 03:41:51,929 - INFO - [train_rl.py:562] -   ExactMatch: 20.4301
2025-05-05 03:41:51,930 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 20.4301 ***
2025-05-05 03:41:54,198 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 03:41:54,198 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 20.4301) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 03:45:42,346 - INFO - [train_rl.py:511] - Epoch 47 训练结束. Avg Loss: 0.3242, Avg CE Loss: 0.3242, Time: 228.10s
2025-05-05 03:45:42,347 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 47 ---
2025-05-05 03:50:01,446 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 03:50:01,446 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 03:50:01,446 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 03:50:01,840 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 03:50:02,245 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 03:50:02,639 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 03:50:03,031 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 03:50:03,399 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 03:50:03,774 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 03:50:04,175 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 03:50:04,574 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 03:50:04,727 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 03:50:04,728 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 81.43902454845377, 'EditDistance': 8.41553166069295, 'ExactMatch': 21.182795698924732}
2025-05-05 03:50:04,728 - INFO - [train_rl.py:561] - 验证结果 Epoch 47:
2025-05-05 03:50:04,728 - INFO - [train_rl.py:562] -   BLEU: 81.4390
2025-05-05 03:50:04,728 - INFO - [train_rl.py:562] -   EditDistance: 8.4155
2025-05-05 03:50:04,728 - INFO - [train_rl.py:562] -   ExactMatch: 21.1828
2025-05-05 03:50:04,728 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 21.1828 ***
2025-05-05 03:50:07,083 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 03:50:07,084 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 21.1828) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 03:53:53,395 - INFO - [train_rl.py:511] - Epoch 48 训练结束. Avg Loss: 0.3169, Avg CE Loss: 0.3169, Time: 226.25s
2025-05-05 03:53:53,395 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 48 ---
2025-05-05 03:58:31,650 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 03:58:31,650 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 03:58:31,650 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 03:58:32,013 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 03:58:32,388 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 03:58:32,755 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 03:58:33,129 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 03:58:33,538 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 03:58:33,942 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 03:58:34,346 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 03:58:34,713 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 03:58:34,855 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 03:58:34,855 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 81.68434048022546, 'EditDistance': 8.298805256869773, 'ExactMatch': 21.14695340501792}
2025-05-05 03:58:34,855 - INFO - [train_rl.py:561] - 验证结果 Epoch 48:
2025-05-05 03:58:34,855 - INFO - [train_rl.py:562] -   BLEU: 81.6843
2025-05-05 03:58:34,855 - INFO - [train_rl.py:562] -   EditDistance: 8.2988
2025-05-05 03:58:34,855 - INFO - [train_rl.py:562] -   ExactMatch: 21.1470
2025-05-05 04:02:21,949 - INFO - [train_rl.py:511] - Epoch 49 训练结束. Avg Loss: 0.3102, Avg CE Loss: 0.3102, Time: 227.06s
2025-05-05 04:02:21,949 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 49 ---
2025-05-05 04:07:27,481 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 04:07:27,481 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 04:07:27,481 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 04:07:27,865 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 04:07:28,271 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 04:07:28,648 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 04:07:29,007 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 04:07:29,376 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 04:07:29,752 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 04:07:30,127 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 04:07:30,495 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 04:07:30,637 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 04:07:30,637 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 81.88105803772132, 'EditDistance': 8.406929510155317, 'ExactMatch': 21.804062126642773}
2025-05-05 04:07:30,637 - INFO - [train_rl.py:561] - 验证结果 Epoch 49:
2025-05-05 04:07:30,637 - INFO - [train_rl.py:562] -   BLEU: 81.8811
2025-05-05 04:07:30,637 - INFO - [train_rl.py:562] -   EditDistance: 8.4069
2025-05-05 04:07:30,637 - INFO - [train_rl.py:562] -   ExactMatch: 21.8041
2025-05-05 04:07:30,637 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 21.8041 ***
2025-05-05 04:07:32,770 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 04:07:32,770 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 21.8041) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 04:11:19,498 - INFO - [train_rl.py:511] - Epoch 50 训练结束. Avg Loss: 0.3032, Avg CE Loss: 0.3032, Time: 226.69s
2025-05-05 04:11:19,499 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 50 ---
2025-05-05 04:15:38,733 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 04:15:38,733 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 04:15:38,733 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 04:15:39,121 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 04:15:39,517 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 04:15:39,885 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 04:15:40,274 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 04:15:40,665 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 04:15:41,031 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 04:15:41,417 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 04:15:41,789 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 04:15:41,951 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 04:15:41,951 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 81.897921546856, 'EditDistance': 8.072759856630825, 'ExactMatch': 21.72043010752688}
2025-05-05 04:15:41,951 - INFO - [train_rl.py:561] - 验证结果 Epoch 50:
2025-05-05 04:15:41,951 - INFO - [train_rl.py:562] -   BLEU: 81.8979
2025-05-05 04:15:41,951 - INFO - [train_rl.py:562] -   EditDistance: 8.0728
2025-05-05 04:15:41,952 - INFO - [train_rl.py:562] -   ExactMatch: 21.7204
2025-05-05 04:19:28,981 - INFO - [train_rl.py:511] - Epoch 51 训练结束. Avg Loss: 0.2979, Avg CE Loss: 0.2979, Time: 226.99s
2025-05-05 04:19:28,982 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 51 ---
2025-05-05 04:24:21,171 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 04:24:21,171 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 04:24:21,171 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 04:24:21,546 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 04:24:21,924 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 04:24:22,289 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 04:24:22,657 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 04:24:23,029 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 04:24:23,389 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 04:24:23,759 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 04:24:24,132 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 04:24:24,270 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 04:24:24,271 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 82.30271327641564, 'EditDistance': 8.120191158900836, 'ExactMatch': 22.43727598566308}
2025-05-05 04:24:24,271 - INFO - [train_rl.py:561] - 验证结果 Epoch 51:
2025-05-05 04:24:24,271 - INFO - [train_rl.py:562] -   BLEU: 82.3027
2025-05-05 04:24:24,271 - INFO - [train_rl.py:562] -   EditDistance: 8.1202
2025-05-05 04:24:24,271 - INFO - [train_rl.py:562] -   ExactMatch: 22.4373
2025-05-05 04:24:24,271 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 22.4373 ***
2025-05-05 04:24:26,769 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 04:24:26,770 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 22.4373) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 04:28:13,492 - INFO - [train_rl.py:511] - Epoch 52 训练结束. Avg Loss: 0.2917, Avg CE Loss: 0.2917, Time: 226.68s
2025-05-05 04:28:13,493 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 52 ---
2025-05-05 04:33:28,991 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 04:33:28,991 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 04:33:28,991 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 04:33:29,356 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 04:33:29,739 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 04:33:30,127 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 04:33:30,494 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 04:33:30,872 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 04:33:31,269 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 04:33:31,659 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 04:33:32,052 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 04:33:32,191 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 04:33:32,191 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 82.26237819527917, 'EditDistance': 8.224970131421744, 'ExactMatch': 22.449223416965353}
2025-05-05 04:33:32,191 - INFO - [train_rl.py:561] - 验证结果 Epoch 52:
2025-05-05 04:33:32,191 - INFO - [train_rl.py:562] -   BLEU: 82.2624
2025-05-05 04:33:32,191 - INFO - [train_rl.py:562] -   EditDistance: 8.2250
2025-05-05 04:33:32,191 - INFO - [train_rl.py:562] -   ExactMatch: 22.4492
2025-05-05 04:33:32,191 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 22.4492 ***
2025-05-05 04:33:34,323 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 04:33:34,323 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 22.4492) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 04:37:20,681 - INFO - [train_rl.py:511] - Epoch 53 训练结束. Avg Loss: 0.2861, Avg CE Loss: 0.2861, Time: 226.31s
2025-05-05 04:37:20,681 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 53 ---
2025-05-05 04:41:51,349 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 04:41:51,350 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 04:41:51,350 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 04:41:51,739 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 04:41:52,138 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 04:41:52,548 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 04:41:52,925 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 04:41:53,302 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 04:41:53,673 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 04:41:54,085 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 04:41:54,492 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 04:41:54,656 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 04:41:54,656 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 82.75400619316645, 'EditDistance': 7.657825567502987, 'ExactMatch': 22.903225806451612}
2025-05-05 04:41:54,656 - INFO - [train_rl.py:561] - 验证结果 Epoch 53:
2025-05-05 04:41:54,656 - INFO - [train_rl.py:562] -   BLEU: 82.7540
2025-05-05 04:41:54,656 - INFO - [train_rl.py:562] -   EditDistance: 7.6578
2025-05-05 04:41:54,656 - INFO - [train_rl.py:562] -   ExactMatch: 22.9032
2025-05-05 04:41:54,656 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 22.9032 ***
2025-05-05 04:41:57,084 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 04:41:57,084 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 22.9032) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 04:45:43,341 - INFO - [train_rl.py:511] - Epoch 54 训练结束. Avg Loss: 0.2805, Avg CE Loss: 0.2805, Time: 226.22s
2025-05-05 04:45:43,341 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 54 ---
2025-05-05 04:50:23,314 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 04:50:23,314 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 04:50:23,314 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 04:50:23,689 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 04:50:24,073 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 04:50:24,444 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 04:50:24,818 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 04:50:25,196 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 04:50:25,573 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 04:50:25,957 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 04:50:26,337 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 04:50:26,478 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 04:50:26,478 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 82.94277808389478, 'EditDistance': 7.704181600955795, 'ExactMatch': 23.237753882915175}
2025-05-05 04:50:26,478 - INFO - [train_rl.py:561] - 验证结果 Epoch 54:
2025-05-05 04:50:26,478 - INFO - [train_rl.py:562] -   BLEU: 82.9428
2025-05-05 04:50:26,478 - INFO - [train_rl.py:562] -   EditDistance: 7.7042
2025-05-05 04:50:26,478 - INFO - [train_rl.py:562] -   ExactMatch: 23.2378
2025-05-05 04:50:26,478 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 23.2378 ***
2025-05-05 04:50:28,760 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 04:50:28,760 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 23.2378) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 04:54:15,568 - INFO - [train_rl.py:511] - Epoch 55 训练结束. Avg Loss: 0.2753, Avg CE Loss: 0.2753, Time: 226.78s
2025-05-05 04:54:15,569 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 55 ---
2025-05-05 04:59:03,446 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 04:59:03,446 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 04:59:03,446 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 04:59:03,845 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 04:59:04,244 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 04:59:04,648 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 04:59:05,058 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 04:59:05,463 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 04:59:05,861 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 04:59:06,264 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 04:59:06,668 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 04:59:06,826 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 04:59:06,826 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 83.28141421242093, 'EditDistance': 7.588649940262844, 'ExactMatch': 24.229390681003586}
2025-05-05 04:59:06,826 - INFO - [train_rl.py:561] - 验证结果 Epoch 55:
2025-05-05 04:59:06,826 - INFO - [train_rl.py:562] -   BLEU: 83.2814
2025-05-05 04:59:06,826 - INFO - [train_rl.py:562] -   EditDistance: 7.5886
2025-05-05 04:59:06,826 - INFO - [train_rl.py:562] -   ExactMatch: 24.2294
2025-05-05 04:59:06,826 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 24.2294 ***
2025-05-05 04:59:09,146 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 04:59:09,146 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 24.2294) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 05:02:56,097 - INFO - [train_rl.py:511] - Epoch 56 训练结束. Avg Loss: 0.2701, Avg CE Loss: 0.2701, Time: 226.92s
2025-05-05 05:02:56,097 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 56 ---
2025-05-05 05:08:11,195 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 05:08:11,195 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 05:08:11,195 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 05:08:11,565 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 05:08:11,951 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 05:08:12,326 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 05:08:12,689 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 05:08:13,065 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 05:08:13,435 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 05:08:13,806 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 05:08:14,179 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 05:08:14,315 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 05:08:14,316 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 83.45268222659227, 'EditDistance': 7.624850657108722, 'ExactMatch': 24.360812425328554}
2025-05-05 05:08:14,316 - INFO - [train_rl.py:561] - 验证结果 Epoch 56:
2025-05-05 05:08:14,316 - INFO - [train_rl.py:562] -   BLEU: 83.4527
2025-05-05 05:08:14,316 - INFO - [train_rl.py:562] -   EditDistance: 7.6249
2025-05-05 05:08:14,316 - INFO - [train_rl.py:562] -   ExactMatch: 24.3608
2025-05-05 05:08:14,316 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 24.3608 ***
2025-05-05 05:08:16,495 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 05:08:16,495 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 24.3608) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 05:12:03,222 - INFO - [train_rl.py:511] - Epoch 57 训练结束. Avg Loss: 0.2650, Avg CE Loss: 0.2650, Time: 226.68s
2025-05-05 05:12:03,222 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 57 ---
2025-05-05 05:16:41,969 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 05:16:41,970 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 05:16:41,970 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 05:16:42,343 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 05:16:42,719 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 05:16:43,092 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 05:16:43,469 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 05:16:43,851 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 05:16:44,220 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 05:16:44,594 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 05:16:44,973 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 05:16:45,114 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 05:16:45,114 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 83.70487291732024, 'EditDistance': 7.362007168458781, 'ExactMatch': 24.982078853046595}
2025-05-05 05:16:45,115 - INFO - [train_rl.py:561] - 验证结果 Epoch 57:
2025-05-05 05:16:45,115 - INFO - [train_rl.py:562] -   BLEU: 83.7049
2025-05-05 05:16:45,115 - INFO - [train_rl.py:562] -   EditDistance: 7.3620
2025-05-05 05:16:45,115 - INFO - [train_rl.py:562] -   ExactMatch: 24.9821
2025-05-05 05:16:45,115 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 24.9821 ***
2025-05-05 05:16:47,384 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 05:16:47,384 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 24.9821) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 05:20:34,460 - INFO - [train_rl.py:511] - Epoch 58 训练结束. Avg Loss: 0.2601, Avg CE Loss: 0.2601, Time: 227.02s
2025-05-05 05:20:34,460 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 58 ---
2025-05-05 05:24:30,577 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 05:24:30,578 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 05:24:30,578 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 05:24:30,938 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 05:24:31,303 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 05:24:31,670 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 05:24:32,027 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 05:24:32,385 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 05:24:32,749 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 05:24:33,111 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 05:24:33,494 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 05:24:33,658 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 05:24:33,658 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 83.6331137672502, 'EditDistance': 7.048864994026284, 'ExactMatch': 24.193548387096776}
2025-05-05 05:24:33,658 - INFO - [train_rl.py:561] - 验证结果 Epoch 58:
2025-05-05 05:24:33,659 - INFO - [train_rl.py:562] -   BLEU: 83.6331
2025-05-05 05:24:33,659 - INFO - [train_rl.py:562] -   EditDistance: 7.0489
2025-05-05 05:24:33,659 - INFO - [train_rl.py:562] -   ExactMatch: 24.1935
2025-05-05 05:28:20,965 - INFO - [train_rl.py:511] - Epoch 59 训练结束. Avg Loss: 0.2558, Avg CE Loss: 0.2558, Time: 227.26s
2025-05-05 05:28:20,965 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 59 ---
2025-05-05 05:32:41,472 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 05:32:41,472 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 05:32:41,473 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 05:32:41,838 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 05:32:42,204 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 05:32:42,570 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 05:32:42,928 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 05:32:43,293 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 05:32:43,658 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 05:32:44,025 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 05:32:44,394 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 05:32:44,539 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 05:32:44,539 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 83.73527010454922, 'EditDistance': 7.229749103942653, 'ExactMatch': 24.743130227001195}
2025-05-05 05:32:44,540 - INFO - [train_rl.py:561] - 验证结果 Epoch 59:
2025-05-05 05:32:44,540 - INFO - [train_rl.py:562] -   BLEU: 83.7353
2025-05-05 05:32:44,540 - INFO - [train_rl.py:562] -   EditDistance: 7.2297
2025-05-05 05:32:44,540 - INFO - [train_rl.py:562] -   ExactMatch: 24.7431
2025-05-05 05:36:31,479 - INFO - [train_rl.py:511] - Epoch 60 训练结束. Avg Loss: 0.2513, Avg CE Loss: 0.2513, Time: 226.90s
2025-05-05 05:36:31,479 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 60 ---
2025-05-05 05:41:06,132 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 05:41:06,132 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 05:41:06,132 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 05:41:06,498 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 05:41:06,872 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 05:41:07,235 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 05:41:07,595 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 05:41:07,963 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 05:41:08,328 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 05:41:08,696 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 05:41:09,071 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 05:41:09,205 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 05:41:09,205 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 84.07149821772826, 'EditDistance': 7.110872162485066, 'ExactMatch': 25.519713261648747}
2025-05-05 05:41:09,205 - INFO - [train_rl.py:561] - 验证结果 Epoch 60:
2025-05-05 05:41:09,205 - INFO - [train_rl.py:562] -   BLEU: 84.0715
2025-05-05 05:41:09,205 - INFO - [train_rl.py:562] -   EditDistance: 7.1109
2025-05-05 05:41:09,205 - INFO - [train_rl.py:562] -   ExactMatch: 25.5197
2025-05-05 05:41:09,205 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 25.5197 ***
2025-05-05 05:41:11,449 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 05:41:11,450 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 25.5197) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 05:44:58,383 - INFO - [train_rl.py:511] - Epoch 61 训练结束. Avg Loss: 0.2470, Avg CE Loss: 0.2470, Time: 226.90s
2025-05-05 05:44:58,384 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 61 ---
2025-05-05 05:48:48,847 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 05:48:48,848 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 05:48:48,848 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 05:48:49,204 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 05:48:49,579 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 05:48:49,978 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 05:48:50,384 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 05:48:50,806 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 05:48:51,220 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 05:48:51,643 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 05:48:52,058 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 05:48:52,209 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 05:48:52,209 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 83.6601511680668, 'EditDistance': 7.0902031063321385, 'ExactMatch': 24.635603345280764}
2025-05-05 05:48:52,210 - INFO - [train_rl.py:561] - 验证结果 Epoch 61:
2025-05-05 05:48:52,210 - INFO - [train_rl.py:562] -   BLEU: 83.6602
2025-05-05 05:48:52,210 - INFO - [train_rl.py:562] -   EditDistance: 7.0902
2025-05-05 05:48:52,210 - INFO - [train_rl.py:562] -   ExactMatch: 24.6356
2025-05-05 05:52:39,888 - INFO - [train_rl.py:511] - Epoch 62 训练结束. Avg Loss: 0.2425, Avg CE Loss: 0.2425, Time: 227.63s
2025-05-05 05:52:39,889 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 62 ---
2025-05-05 05:57:13,709 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 05:57:13,710 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 05:57:13,710 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 05:57:14,102 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 05:57:14,508 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 05:57:14,930 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 05:57:15,339 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 05:57:15,747 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 05:57:16,167 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 05:57:16,536 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 05:57:16,900 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 05:57:17,042 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 05:57:17,043 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 83.8361677033691, 'EditDistance': 7.238112305854242, 'ExactMatch': 25.173237753882916}
2025-05-05 05:57:17,043 - INFO - [train_rl.py:561] - 验证结果 Epoch 62:
2025-05-05 05:57:17,043 - INFO - [train_rl.py:562] -   BLEU: 83.8362
2025-05-05 05:57:17,043 - INFO - [train_rl.py:562] -   EditDistance: 7.2381
2025-05-05 05:57:17,043 - INFO - [train_rl.py:562] -   ExactMatch: 25.1732
2025-05-05 06:01:04,649 - INFO - [train_rl.py:511] - Epoch 63 训练结束. Avg Loss: 0.2388, Avg CE Loss: 0.2388, Time: 227.56s
2025-05-05 06:01:04,649 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 63 ---
2025-05-05 06:05:09,385 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 06:05:09,385 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 06:05:09,385 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 06:05:09,750 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 06:05:10,120 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 06:05:10,481 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 06:05:10,848 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 06:05:11,217 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 06:05:11,584 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 06:05:11,959 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 06:05:12,329 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 06:05:12,466 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 06:05:12,467 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 84.38081448508986, 'EditDistance': 6.747550776583035, 'ExactMatch': 25.9378733572282}
2025-05-05 06:05:12,467 - INFO - [train_rl.py:561] - 验证结果 Epoch 63:
2025-05-05 06:05:12,467 - INFO - [train_rl.py:562] -   BLEU: 84.3808
2025-05-05 06:05:12,467 - INFO - [train_rl.py:562] -   EditDistance: 6.7476
2025-05-05 06:05:12,467 - INFO - [train_rl.py:562] -   ExactMatch: 25.9379
2025-05-05 06:05:12,467 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 25.9379 ***
2025-05-05 06:05:14,656 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 06:05:14,657 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 25.9379) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 06:09:01,611 - INFO - [train_rl.py:511] - Epoch 64 训练结束. Avg Loss: 0.2351, Avg CE Loss: 0.2351, Time: 226.92s
2025-05-05 06:09:01,611 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 64 ---
2025-05-05 06:13:06,754 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 06:13:06,754 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 06:13:06,754 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 06:13:07,143 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 06:13:07,533 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 06:13:07,923 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 06:13:08,319 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 06:13:08,712 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 06:13:09,096 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 06:13:09,501 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 06:13:09,900 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 06:13:10,051 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 06:13:10,051 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 84.62784170099181, 'EditDistance': 6.618399044205495, 'ExactMatch': 26.296296296296294}
2025-05-05 06:13:10,052 - INFO - [train_rl.py:561] - 验证结果 Epoch 64:
2025-05-05 06:13:10,052 - INFO - [train_rl.py:562] -   BLEU: 84.6278
2025-05-05 06:13:10,052 - INFO - [train_rl.py:562] -   EditDistance: 6.6184
2025-05-05 06:13:10,052 - INFO - [train_rl.py:562] -   ExactMatch: 26.2963
2025-05-05 06:13:10,052 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 26.2963 ***
2025-05-05 06:13:12,031 - INFO - [utils.py:91] - Epoch checkpoint saved to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/checkpoint_epoch_64.pth.tar
2025-05-05 06:13:14,003 - INFO - [utils.py:105] - *** Best checkpoint saved (copied from epoch) to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 06:13:14,004 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 26.2963), Epoch 64 检查点已保存 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 06:17:00,889 - INFO - [train_rl.py:511] - Epoch 65 训练结束. Avg Loss: 0.2303, Avg CE Loss: 0.2303, Time: 226.85s
2025-05-05 06:17:00,889 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 65 ---
2025-05-05 06:21:37,387 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 06:21:37,388 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 06:21:37,388 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 06:21:37,796 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 06:21:38,216 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 06:21:38,635 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 06:21:39,041 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 06:21:39,446 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 06:21:39,854 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 06:21:40,257 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 06:21:40,672 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 06:21:40,821 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 06:21:40,822 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 84.76742601153481, 'EditDistance': 6.822819593787336, 'ExactMatch': 26.810035842293907}
2025-05-05 06:21:40,822 - INFO - [train_rl.py:561] - 验证结果 Epoch 65:
2025-05-05 06:21:40,822 - INFO - [train_rl.py:562] -   BLEU: 84.7674
2025-05-05 06:21:40,822 - INFO - [train_rl.py:562] -   EditDistance: 6.8228
2025-05-05 06:21:40,822 - INFO - [train_rl.py:562] -   ExactMatch: 26.8100
2025-05-05 06:21:40,822 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 26.8100 ***
2025-05-05 06:21:43,075 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 06:21:43,076 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 26.8100) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 06:25:30,252 - INFO - [train_rl.py:511] - Epoch 66 训练结束. Avg Loss: 0.2266, Avg CE Loss: 0.2266, Time: 227.14s
2025-05-05 06:25:30,252 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 66 ---
2025-05-05 06:29:47,142 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 06:29:47,142 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 06:29:47,142 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 06:29:47,527 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 06:29:47,903 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 06:29:48,266 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 06:29:48,635 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 06:29:48,998 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 06:29:49,356 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 06:29:49,733 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 06:29:50,097 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 06:29:50,238 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 06:29:50,238 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 84.86812711505299, 'EditDistance': 6.619115890083632, 'ExactMatch': 27.0131421744325}
2025-05-05 06:29:50,239 - INFO - [train_rl.py:561] - 验证结果 Epoch 66:
2025-05-05 06:29:50,239 - INFO - [train_rl.py:562] -   BLEU: 84.8681
2025-05-05 06:29:50,239 - INFO - [train_rl.py:562] -   EditDistance: 6.6191
2025-05-05 06:29:50,239 - INFO - [train_rl.py:562] -   ExactMatch: 27.0131
2025-05-05 06:29:50,239 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 27.0131 ***
2025-05-05 06:29:52,481 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 06:29:52,482 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 27.0131) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 06:33:39,163 - INFO - [train_rl.py:511] - Epoch 67 训练结束. Avg Loss: 0.2234, Avg CE Loss: 0.2234, Time: 226.64s
2025-05-05 06:33:39,163 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 67 ---
2025-05-05 06:38:25,295 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 06:38:25,296 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 06:38:25,296 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 06:38:25,663 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 06:38:26,046 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 06:38:26,421 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 06:38:26,787 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 06:38:27,164 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 06:38:27,540 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 06:38:27,956 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 06:38:28,380 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 06:38:28,546 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 06:38:28,546 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 84.70400148720125, 'EditDistance': 6.785065710872162, 'ExactMatch': 26.54719235364397}
2025-05-05 06:38:28,546 - INFO - [train_rl.py:561] - 验证结果 Epoch 67:
2025-05-05 06:38:28,546 - INFO - [train_rl.py:562] -   BLEU: 84.7040
2025-05-05 06:38:28,546 - INFO - [train_rl.py:562] -   EditDistance: 6.7851
2025-05-05 06:38:28,546 - INFO - [train_rl.py:562] -   ExactMatch: 26.5472
2025-05-05 06:42:15,701 - INFO - [train_rl.py:511] - Epoch 68 训练结束. Avg Loss: 0.2197, Avg CE Loss: 0.2197, Time: 227.12s
2025-05-05 06:42:15,701 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 68 ---
2025-05-05 06:46:36,631 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 06:46:36,631 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 06:46:36,631 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 06:46:36,997 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 06:46:37,380 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 06:46:37,750 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 06:46:38,148 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 06:46:38,565 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 06:46:38,979 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 06:46:39,393 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 06:46:39,819 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 06:46:39,975 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 06:46:39,975 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 84.92351954026277, 'EditDistance': 6.585782556750298, 'ExactMatch': 27.323775388291516}
2025-05-05 06:46:39,975 - INFO - [train_rl.py:561] - 验证结果 Epoch 68:
2025-05-05 06:46:39,976 - INFO - [train_rl.py:562] -   BLEU: 84.9235
2025-05-05 06:46:39,976 - INFO - [train_rl.py:562] -   EditDistance: 6.5858
2025-05-05 06:46:39,976 - INFO - [train_rl.py:562] -   ExactMatch: 27.3238
2025-05-05 06:46:39,976 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 27.3238 ***
2025-05-05 06:46:42,304 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 06:46:42,305 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 27.3238) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 06:50:29,788 - INFO - [train_rl.py:511] - Epoch 69 训练结束. Avg Loss: 0.2169, Avg CE Loss: 0.2169, Time: 227.44s
2025-05-05 06:50:29,788 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 69 ---
2025-05-05 06:54:31,945 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 06:54:31,945 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 06:54:31,945 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 06:54:32,354 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 06:54:32,769 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 06:54:33,154 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 06:54:33,525 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 06:54:33,894 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 06:54:34,264 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 06:54:34,640 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 06:54:35,013 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 06:54:35,155 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 06:54:35,155 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 85.11757413160785, 'EditDistance': 6.3647550776583035, 'ExactMatch': 27.574671445639186}
2025-05-05 06:54:35,155 - INFO - [train_rl.py:561] - 验证结果 Epoch 69:
2025-05-05 06:54:35,155 - INFO - [train_rl.py:562] -   BLEU: 85.1176
2025-05-05 06:54:35,155 - INFO - [train_rl.py:562] -   EditDistance: 6.3648
2025-05-05 06:54:35,155 - INFO - [train_rl.py:562] -   ExactMatch: 27.5747
2025-05-05 06:54:35,155 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 27.5747 ***
2025-05-05 06:54:37,470 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 06:54:37,470 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 27.5747) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 06:58:23,843 - INFO - [train_rl.py:511] - Epoch 70 训练结束. Avg Loss: 0.2130, Avg CE Loss: 0.2130, Time: 226.34s
2025-05-05 06:58:23,843 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 70 ---
2025-05-05 07:02:18,649 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 07:02:18,649 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 07:02:18,649 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 07:02:19,047 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 07:02:19,463 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 07:02:19,866 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 07:02:20,254 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 07:02:20,651 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 07:02:21,054 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 07:02:21,460 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 07:02:21,867 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 07:02:22,017 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 07:02:22,017 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 84.9209091465379, 'EditDistance': 6.410035842293907, 'ExactMatch': 27.514934289127837}
2025-05-05 07:02:22,018 - INFO - [train_rl.py:561] - 验证结果 Epoch 70:
2025-05-05 07:02:22,018 - INFO - [train_rl.py:562] -   BLEU: 84.9209
2025-05-05 07:02:22,018 - INFO - [train_rl.py:562] -   EditDistance: 6.4100
2025-05-05 07:02:22,018 - INFO - [train_rl.py:562] -   ExactMatch: 27.5149
2025-05-05 07:06:09,122 - INFO - [train_rl.py:511] - Epoch 71 训练结束. Avg Loss: 0.2097, Avg CE Loss: 0.2097, Time: 227.07s
2025-05-05 07:06:09,122 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 71 ---
2025-05-05 07:10:00,329 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 07:10:00,330 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 07:10:00,330 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 07:10:00,681 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 07:10:01,035 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 07:10:01,388 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 07:10:01,738 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 07:10:02,085 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 07:10:02,435 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 07:10:02,787 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 07:10:03,143 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 07:10:03,271 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 07:10:03,272 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 85.19725056376129, 'EditDistance': 6.306810035842294, 'ExactMatch': 27.945041816009557}
2025-05-05 07:10:03,272 - INFO - [train_rl.py:561] - 验证结果 Epoch 71:
2025-05-05 07:10:03,272 - INFO - [train_rl.py:562] -   BLEU: 85.1973
2025-05-05 07:10:03,272 - INFO - [train_rl.py:562] -   EditDistance: 6.3068
2025-05-05 07:10:03,272 - INFO - [train_rl.py:562] -   ExactMatch: 27.9450
2025-05-05 07:10:03,273 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 27.9450 ***
2025-05-05 07:10:05,592 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 07:10:05,593 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 27.9450) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 07:13:53,894 - INFO - [train_rl.py:511] - Epoch 72 训练结束. Avg Loss: 0.2070, Avg CE Loss: 0.2070, Time: 228.25s
2025-05-05 07:13:53,894 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 72 ---
2025-05-05 07:18:13,304 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 07:18:13,304 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 07:18:13,304 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 07:18:13,689 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 07:18:14,080 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 07:18:14,465 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 07:18:14,848 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 07:18:15,204 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 07:18:15,561 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 07:18:15,910 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 07:18:16,269 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 07:18:16,400 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 07:18:16,400 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 85.46347000136836, 'EditDistance': 6.293906810035843, 'ExactMatch': 28.45878136200717}
2025-05-05 07:18:16,400 - INFO - [train_rl.py:561] - 验证结果 Epoch 72:
2025-05-05 07:18:16,400 - INFO - [train_rl.py:562] -   BLEU: 85.4635
2025-05-05 07:18:16,400 - INFO - [train_rl.py:562] -   EditDistance: 6.2939
2025-05-05 07:18:16,400 - INFO - [train_rl.py:562] -   ExactMatch: 28.4588
2025-05-05 07:18:16,400 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 28.4588 ***
2025-05-05 07:18:18,640 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 07:18:18,640 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 28.4588) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 07:22:06,040 - INFO - [train_rl.py:511] - Epoch 73 训练结束. Avg Loss: 0.2034, Avg CE Loss: 0.2034, Time: 227.37s
2025-05-05 07:22:06,041 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 73 ---
2025-05-05 07:25:53,957 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 07:25:53,958 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 07:25:53,958 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 07:25:54,311 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 07:25:54,673 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 07:25:55,027 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 07:25:55,385 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 07:25:55,742 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 07:25:56,096 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 07:25:56,463 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 07:25:56,820 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 07:25:56,954 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 07:25:56,954 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 85.64072756764139, 'EditDistance': 6.070609318996416, 'ExactMatch': 28.93667861409797}
2025-05-05 07:25:56,954 - INFO - [train_rl.py:561] - 验证结果 Epoch 73:
2025-05-05 07:25:56,954 - INFO - [train_rl.py:562] -   BLEU: 85.6407
2025-05-05 07:25:56,954 - INFO - [train_rl.py:562] -   EditDistance: 6.0706
2025-05-05 07:25:56,954 - INFO - [train_rl.py:562] -   ExactMatch: 28.9367
2025-05-05 07:25:56,954 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 28.9367 ***
2025-05-05 07:25:59,610 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 07:25:59,614 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 28.9367) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 07:29:47,568 - INFO - [train_rl.py:511] - Epoch 74 训练结束. Avg Loss: 0.2011, Avg CE Loss: 0.2011, Time: 227.91s
2025-05-05 07:29:47,568 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 74 ---
2025-05-05 07:33:28,143 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 07:33:28,144 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 07:33:28,144 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 07:33:28,527 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 07:33:28,895 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 07:33:29,269 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 07:33:29,649 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 07:33:30,017 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 07:33:30,386 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 07:33:30,764 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 07:33:31,142 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 07:33:31,284 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 07:33:31,284 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 85.55641540724122, 'EditDistance': 6.0777777777777775, 'ExactMatch': 28.94862604540024}
2025-05-05 07:33:31,284 - INFO - [train_rl.py:561] - 验证结果 Epoch 74:
2025-05-05 07:33:31,284 - INFO - [train_rl.py:562] -   BLEU: 85.5564
2025-05-05 07:33:31,284 - INFO - [train_rl.py:562] -   EditDistance: 6.0778
2025-05-05 07:33:31,285 - INFO - [train_rl.py:562] -   ExactMatch: 28.9486
2025-05-05 07:33:31,285 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 28.9486 ***
2025-05-05 07:33:33,477 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 07:33:33,478 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 28.9486) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 07:37:21,385 - INFO - [train_rl.py:511] - Epoch 75 训练结束. Avg Loss: 0.1979, Avg CE Loss: 0.1979, Time: 227.85s
2025-05-05 07:37:21,385 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 75 ---
2025-05-05 07:40:51,857 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 07:40:51,857 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 07:40:51,857 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 07:40:52,246 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 07:40:52,642 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 07:40:53,038 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 07:40:53,431 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 07:40:53,830 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 07:40:54,191 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 07:40:54,563 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 07:40:54,968 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 07:40:55,114 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 07:40:55,114 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 85.62215741341205, 'EditDistance': 6.037634408602151, 'ExactMatch': 28.769414575866186}
2025-05-05 07:40:55,115 - INFO - [train_rl.py:561] - 验证结果 Epoch 75:
2025-05-05 07:40:55,115 - INFO - [train_rl.py:562] -   BLEU: 85.6222
2025-05-05 07:40:55,115 - INFO - [train_rl.py:562] -   EditDistance: 6.0376
2025-05-05 07:40:55,115 - INFO - [train_rl.py:562] -   ExactMatch: 28.7694
2025-05-05 07:44:42,136 - INFO - [train_rl.py:511] - Epoch 76 训练结束. Avg Loss: 0.1949, Avg CE Loss: 0.1949, Time: 226.99s
2025-05-05 07:44:42,136 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 76 ---
2025-05-05 07:48:12,220 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 07:48:12,220 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 07:48:12,220 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 07:48:12,618 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 07:48:13,035 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 07:48:13,453 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 07:48:13,859 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 07:48:14,242 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 07:48:14,602 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 07:48:14,980 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 07:48:15,353 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 07:48:15,489 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 07:48:15,489 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 85.8487084723482, 'EditDistance': 5.898088410991637, 'ExactMatch': 29.18757467144564}
2025-05-05 07:48:15,489 - INFO - [train_rl.py:561] - 验证结果 Epoch 76:
2025-05-05 07:48:15,489 - INFO - [train_rl.py:562] -   BLEU: 85.8487
2025-05-05 07:48:15,489 - INFO - [train_rl.py:562] -   EditDistance: 5.8981
2025-05-05 07:48:15,489 - INFO - [train_rl.py:562] -   ExactMatch: 29.1876
2025-05-05 07:48:15,489 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 29.1876 ***
2025-05-05 07:48:17,669 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 07:48:17,669 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 29.1876) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 07:52:04,622 - INFO - [train_rl.py:511] - Epoch 77 训练结束. Avg Loss: 0.1918, Avg CE Loss: 0.1918, Time: 226.92s
2025-05-05 07:52:04,624 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 77 ---
2025-05-05 07:55:39,224 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 07:55:39,224 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 07:55:39,224 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 07:55:39,576 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 07:55:39,959 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 07:55:40,350 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 07:55:40,741 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 07:55:41,141 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 07:55:41,532 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 07:55:41,914 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 07:55:42,305 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 07:55:42,452 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 07:55:42,453 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.04900271779547, 'EditDistance': 5.840382317801673, 'ExactMatch': 29.796893667861408}
2025-05-05 07:55:42,453 - INFO - [train_rl.py:561] - 验证结果 Epoch 77:
2025-05-05 07:55:42,453 - INFO - [train_rl.py:562] -   BLEU: 86.0490
2025-05-05 07:55:42,453 - INFO - [train_rl.py:562] -   EditDistance: 5.8404
2025-05-05 07:55:42,453 - INFO - [train_rl.py:562] -   ExactMatch: 29.7969
2025-05-05 07:55:42,453 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 29.7969 ***
2025-05-05 07:55:44,867 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 07:55:44,867 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 29.7969) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 07:59:32,519 - INFO - [train_rl.py:511] - Epoch 78 训练结束. Avg Loss: 0.1895, Avg CE Loss: 0.1895, Time: 227.62s
2025-05-05 07:59:32,520 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 78 ---
2025-05-05 08:03:15,619 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 08:03:15,620 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 08:03:15,620 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 08:03:15,977 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 08:03:16,350 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 08:03:16,706 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 08:03:17,061 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 08:03:17,419 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 08:03:17,779 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 08:03:18,153 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 08:03:18,516 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 08:03:18,655 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 08:03:18,656 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.32246442870142, 'EditDistance': 5.778853046594982, 'ExactMatch': 30.107526881720432}
2025-05-05 08:03:18,656 - INFO - [train_rl.py:561] - 验证结果 Epoch 78:
2025-05-05 08:03:18,656 - INFO - [train_rl.py:562] -   BLEU: 86.3225
2025-05-05 08:03:18,656 - INFO - [train_rl.py:562] -   EditDistance: 5.7789
2025-05-05 08:03:18,656 - INFO - [train_rl.py:562] -   ExactMatch: 30.1075
2025-05-05 08:03:18,656 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 30.1075 ***
2025-05-05 08:03:20,974 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 08:03:20,974 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 30.1075) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 08:07:08,856 - INFO - [train_rl.py:511] - Epoch 79 训练结束. Avg Loss: 0.1868, Avg CE Loss: 0.1868, Time: 227.83s
2025-05-05 08:07:08,857 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 79 ---
2025-05-05 08:10:52,464 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 08:10:52,465 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 08:10:52,465 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 08:10:52,816 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 08:10:53,173 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 08:10:53,519 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 08:10:53,871 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 08:10:54,232 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 08:10:54,584 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 08:10:54,944 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 08:10:55,300 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 08:10:55,436 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 08:10:55,436 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.13921296290977, 'EditDistance': 5.821983273596177, 'ExactMatch': 29.940262843488654}
2025-05-05 08:10:55,436 - INFO - [train_rl.py:561] - 验证结果 Epoch 79:
2025-05-05 08:10:55,436 - INFO - [train_rl.py:562] -   BLEU: 86.1392
2025-05-05 08:10:55,436 - INFO - [train_rl.py:562] -   EditDistance: 5.8220
2025-05-05 08:10:55,436 - INFO - [train_rl.py:562] -   ExactMatch: 29.9403
2025-05-05 08:14:44,074 - INFO - [train_rl.py:511] - Epoch 80 训练结束. Avg Loss: 0.1838, Avg CE Loss: 0.1838, Time: 228.60s
2025-05-05 08:14:44,074 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 80 ---
2025-05-05 08:18:34,779 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 08:18:34,779 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 08:18:34,779 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 08:18:35,166 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 08:18:35,554 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 08:18:35,934 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 08:18:36,312 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 08:18:36,673 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 08:18:37,054 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 08:18:37,438 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 08:18:37,841 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 08:18:37,974 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 08:18:37,974 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.29916713771452, 'EditDistance': 5.793667861409797, 'ExactMatch': 30.167264038231778}
2025-05-05 08:18:37,975 - INFO - [train_rl.py:561] - 验证结果 Epoch 80:
2025-05-05 08:18:37,975 - INFO - [train_rl.py:562] -   BLEU: 86.2992
2025-05-05 08:18:37,975 - INFO - [train_rl.py:562] -   EditDistance: 5.7937
2025-05-05 08:18:37,975 - INFO - [train_rl.py:562] -   ExactMatch: 30.1673
2025-05-05 08:18:37,975 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 30.1673 ***
2025-05-05 08:18:40,302 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 08:18:40,303 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 30.1673) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 08:22:28,501 - INFO - [train_rl.py:511] - Epoch 81 训练结束. Avg Loss: 0.1814, Avg CE Loss: 0.1814, Time: 228.15s
2025-05-05 08:22:28,501 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 81 ---
2025-05-05 08:26:00,600 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 08:26:00,601 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 08:26:00,601 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 08:26:00,962 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 08:26:01,333 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 08:26:01,718 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 08:26:02,088 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 08:26:02,444 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 08:26:02,795 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 08:26:03,159 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 08:26:03,539 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 08:26:03,670 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 08:26:03,670 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.41868308838397, 'EditDistance': 5.666427718040621, 'ExactMatch': 30.51373954599761}
2025-05-05 08:26:03,670 - INFO - [train_rl.py:561] - 验证结果 Epoch 81:
2025-05-05 08:26:03,671 - INFO - [train_rl.py:562] -   BLEU: 86.4187
2025-05-05 08:26:03,671 - INFO - [train_rl.py:562] -   EditDistance: 5.6664
2025-05-05 08:26:03,671 - INFO - [train_rl.py:562] -   ExactMatch: 30.5137
2025-05-05 08:26:03,671 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 30.5137 ***
2025-05-05 08:26:06,101 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 08:26:06,101 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 30.5137) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 08:29:54,141 - INFO - [train_rl.py:511] - Epoch 82 训练结束. Avg Loss: 0.1794, Avg CE Loss: 0.1794, Time: 228.00s
2025-05-05 08:29:54,142 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 82 ---
2025-05-05 08:33:24,434 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 08:33:24,434 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 08:33:24,434 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 08:33:24,781 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 08:33:25,143 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 08:33:25,497 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 08:33:25,852 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 08:33:26,213 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 08:33:26,567 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 08:33:26,930 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 08:33:27,329 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 08:33:27,461 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 08:33:27,461 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.33544385539854, 'EditDistance': 5.656391875746714, 'ExactMatch': 30.58542413381123}
2025-05-05 08:33:27,461 - INFO - [train_rl.py:561] - 验证结果 Epoch 82:
2025-05-05 08:33:27,462 - INFO - [train_rl.py:562] -   BLEU: 86.3354
2025-05-05 08:33:27,462 - INFO - [train_rl.py:562] -   EditDistance: 5.6564
2025-05-05 08:33:27,462 - INFO - [train_rl.py:562] -   ExactMatch: 30.5854
2025-05-05 08:33:27,462 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 30.5854 ***
2025-05-05 08:33:29,837 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 08:33:29,837 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 30.5854) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 08:37:17,584 - INFO - [train_rl.py:511] - Epoch 83 训练结束. Avg Loss: 0.1767, Avg CE Loss: 0.1767, Time: 227.72s
2025-05-05 08:37:17,584 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 83 ---
2025-05-05 08:40:45,627 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 08:40:45,628 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 08:40:45,628 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 08:40:45,994 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 08:40:46,432 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 08:40:46,841 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 08:40:47,245 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 08:40:47,621 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 08:40:47,985 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 08:40:48,353 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 08:40:48,730 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 08:40:48,867 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 08:40:48,867 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.39374239729761, 'EditDistance': 5.602508960573477, 'ExactMatch': 30.203106332138592}
2025-05-05 08:40:48,867 - INFO - [train_rl.py:561] - 验证结果 Epoch 83:
2025-05-05 08:40:48,867 - INFO - [train_rl.py:562] -   BLEU: 86.3937
2025-05-05 08:40:48,867 - INFO - [train_rl.py:562] -   EditDistance: 5.6025
2025-05-05 08:40:48,867 - INFO - [train_rl.py:562] -   ExactMatch: 30.2031
2025-05-05 08:44:37,317 - INFO - [train_rl.py:511] - Epoch 84 训练结束. Avg Loss: 0.1744, Avg CE Loss: 0.1744, Time: 228.39s
2025-05-05 08:44:37,319 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 84 ---
2025-05-05 08:48:13,265 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 08:48:13,266 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 08:48:13,266 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 08:48:13,618 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 08:48:13,975 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 08:48:14,330 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 08:48:14,679 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 08:48:15,037 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 08:48:15,396 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 08:48:15,755 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 08:48:16,110 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 08:48:16,246 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 08:48:16,246 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.41082152095885, 'EditDistance': 5.644086021505377, 'ExactMatch': 30.549581839904423}
2025-05-05 08:48:16,246 - INFO - [train_rl.py:561] - 验证结果 Epoch 84:
2025-05-05 08:48:16,246 - INFO - [train_rl.py:562] -   BLEU: 86.4108
2025-05-05 08:48:16,246 - INFO - [train_rl.py:562] -   EditDistance: 5.6441
2025-05-05 08:48:16,246 - INFO - [train_rl.py:562] -   ExactMatch: 30.5496
2025-05-05 08:52:03,921 - INFO - [train_rl.py:511] - Epoch 85 训练结束. Avg Loss: 0.1724, Avg CE Loss: 0.1724, Time: 227.63s
2025-05-05 08:52:03,921 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 85 ---
2025-05-05 08:55:27,428 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 08:55:27,428 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 08:55:27,428 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 08:55:27,776 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 08:55:28,136 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 08:55:28,489 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 08:55:28,885 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 08:55:29,309 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 08:55:29,663 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 08:55:30,027 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 08:55:30,388 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 08:55:30,524 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 08:55:30,524 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.7371077636695, 'EditDistance': 5.424014336917563, 'ExactMatch': 31.170848267622457}
2025-05-05 08:55:30,525 - INFO - [train_rl.py:561] - 验证结果 Epoch 85:
2025-05-05 08:55:30,525 - INFO - [train_rl.py:562] -   BLEU: 86.7371
2025-05-05 08:55:30,525 - INFO - [train_rl.py:562] -   EditDistance: 5.4240
2025-05-05 08:55:30,525 - INFO - [train_rl.py:562] -   ExactMatch: 31.1708
2025-05-05 08:55:30,525 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 31.1708 ***
2025-05-05 08:55:32,872 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 08:55:32,872 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 31.1708) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 08:59:20,583 - INFO - [train_rl.py:511] - Epoch 86 训练结束. Avg Loss: 0.1697, Avg CE Loss: 0.1697, Time: 227.67s
2025-05-05 08:59:20,583 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 86 ---
2025-05-05 09:02:46,163 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 09:02:46,163 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 09:02:46,163 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 09:02:46,511 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 09:02:46,876 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 09:02:47,230 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 09:02:47,584 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 09:02:47,949 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 09:02:48,295 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 09:02:48,664 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 09:02:49,025 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 09:02:49,158 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 09:02:49,158 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.78434612690714, 'EditDistance': 5.464038231780167, 'ExactMatch': 31.13500597371565}
2025-05-05 09:02:49,159 - INFO - [train_rl.py:561] - 验证结果 Epoch 86:
2025-05-05 09:02:49,159 - INFO - [train_rl.py:562] -   BLEU: 86.7843
2025-05-05 09:02:49,159 - INFO - [train_rl.py:562] -   EditDistance: 5.4640
2025-05-05 09:02:49,159 - INFO - [train_rl.py:562] -   ExactMatch: 31.1350
2025-05-05 09:06:36,227 - INFO - [train_rl.py:511] - Epoch 87 训练结束. Avg Loss: 0.1684, Avg CE Loss: 0.1684, Time: 227.04s
2025-05-05 09:06:36,228 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 87 ---
2025-05-05 09:10:22,101 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 09:10:22,101 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 09:10:22,101 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 09:10:22,456 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 09:10:22,819 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 09:10:23,184 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 09:10:23,543 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 09:10:23,903 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 09:10:24,266 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 09:10:24,633 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 09:10:24,994 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 09:10:25,130 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 09:10:25,130 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.82900290422188, 'EditDistance': 5.579928315412187, 'ExactMatch': 31.60095579450418}
2025-05-05 09:10:25,130 - INFO - [train_rl.py:561] - 验证结果 Epoch 87:
2025-05-05 09:10:25,130 - INFO - [train_rl.py:562] -   BLEU: 86.8290
2025-05-05 09:10:25,130 - INFO - [train_rl.py:562] -   EditDistance: 5.5799
2025-05-05 09:10:25,130 - INFO - [train_rl.py:562] -   ExactMatch: 31.6010
2025-05-05 09:10:25,131 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 31.6010 ***
2025-05-05 09:10:27,373 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 09:10:27,373 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 31.6010) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 09:14:14,655 - INFO - [train_rl.py:511] - Epoch 88 训练结束. Avg Loss: 0.1655, Avg CE Loss: 0.1655, Time: 227.24s
2025-05-05 09:14:14,655 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 88 ---
2025-05-05 09:17:52,704 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 09:17:52,704 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 09:17:52,705 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 09:17:53,063 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 09:17:53,419 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 09:17:53,773 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 09:17:54,119 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 09:17:54,471 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 09:17:54,824 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 09:17:55,177 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 09:17:55,534 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 09:17:55,668 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 09:17:55,668 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.75473199350814, 'EditDistance': 5.546117084826762, 'ExactMatch': 31.314217443249703}
2025-05-05 09:17:55,668 - INFO - [train_rl.py:561] - 验证结果 Epoch 88:
2025-05-05 09:17:55,668 - INFO - [train_rl.py:562] -   BLEU: 86.7547
2025-05-05 09:17:55,669 - INFO - [train_rl.py:562] -   EditDistance: 5.5461
2025-05-05 09:17:55,669 - INFO - [train_rl.py:562] -   ExactMatch: 31.3142
2025-05-05 09:21:43,312 - INFO - [train_rl.py:511] - Epoch 89 训练结束. Avg Loss: 0.1631, Avg CE Loss: 0.1631, Time: 227.60s
2025-05-05 09:21:43,313 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 89 ---
2025-05-05 09:25:13,823 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 09:25:13,824 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 09:25:13,824 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 09:25:14,188 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 09:25:14,555 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 09:25:14,908 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 09:25:15,275 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 09:25:15,639 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 09:25:16,001 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 09:25:16,371 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 09:25:16,739 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 09:25:16,874 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 09:25:16,874 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.83035289887484, 'EditDistance': 5.355436081242533, 'ExactMatch': 31.158900836320193}
2025-05-05 09:25:16,874 - INFO - [train_rl.py:561] - 验证结果 Epoch 89:
2025-05-05 09:25:16,874 - INFO - [train_rl.py:562] -   BLEU: 86.8304
2025-05-05 09:25:16,874 - INFO - [train_rl.py:562] -   EditDistance: 5.3554
2025-05-05 09:25:16,874 - INFO - [train_rl.py:562] -   ExactMatch: 31.1589
2025-05-05 09:29:04,022 - INFO - [train_rl.py:511] - Epoch 90 训练结束. Avg Loss: 0.1618, Avg CE Loss: 0.1618, Time: 227.10s
2025-05-05 09:29:04,023 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 90 ---
2025-05-05 09:32:35,706 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 09:32:35,706 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 09:32:35,706 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 09:32:36,101 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 09:32:36,497 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 09:32:36,890 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 09:32:37,297 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 09:32:37,669 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 09:32:38,060 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 09:32:38,426 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 09:32:38,786 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 09:32:38,930 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 09:32:38,930 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 86.89370513018171, 'EditDistance': 5.314575866188769, 'ExactMatch': 31.266427718040624}
2025-05-05 09:32:38,930 - INFO - [train_rl.py:561] - 验证结果 Epoch 90:
2025-05-05 09:32:38,930 - INFO - [train_rl.py:562] -   BLEU: 86.8937
2025-05-05 09:32:38,930 - INFO - [train_rl.py:562] -   EditDistance: 5.3146
2025-05-05 09:32:38,930 - INFO - [train_rl.py:562] -   ExactMatch: 31.2664
2025-05-05 09:36:26,322 - INFO - [train_rl.py:511] - Epoch 91 训练结束. Avg Loss: 0.1595, Avg CE Loss: 0.1595, Time: 227.36s
2025-05-05 09:36:26,322 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 91 ---
2025-05-05 09:39:45,916 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 09:39:45,917 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 09:39:45,917 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 09:39:46,276 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 09:39:46,641 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 09:39:46,998 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 09:39:47,360 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 09:39:47,726 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 09:39:48,084 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 09:39:48,447 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 09:39:48,807 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 09:39:48,941 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 09:39:48,941 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.22805746510211, 'EditDistance': 5.235244922341696, 'ExactMatch': 32.15053763440861}
2025-05-05 09:39:48,941 - INFO - [train_rl.py:561] - 验证结果 Epoch 91:
2025-05-05 09:39:48,941 - INFO - [train_rl.py:562] -   BLEU: 87.2281
2025-05-05 09:39:48,941 - INFO - [train_rl.py:562] -   EditDistance: 5.2352
2025-05-05 09:39:48,941 - INFO - [train_rl.py:562] -   ExactMatch: 32.1505
2025-05-05 09:39:48,941 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 32.1505 ***
2025-05-05 09:39:51,211 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 09:39:51,212 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 32.1505) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 09:43:37,973 - INFO - [train_rl.py:511] - Epoch 92 训练结束. Avg Loss: 0.1572, Avg CE Loss: 0.1572, Time: 226.72s
2025-05-05 09:43:37,973 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 92 ---
2025-05-05 09:46:51,181 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 09:46:51,181 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 09:46:51,181 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 09:46:51,568 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 09:46:51,938 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 09:46:52,333 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 09:46:52,690 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 09:46:53,078 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 09:46:53,448 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 09:46:53,814 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 09:46:54,183 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 09:46:54,335 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 09:46:54,336 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.11602260371487, 'EditDistance': 5.217323775388292, 'ExactMatch': 32.35364396654719}
2025-05-05 09:46:54,336 - INFO - [train_rl.py:561] - 验证结果 Epoch 92:
2025-05-05 09:46:54,336 - INFO - [train_rl.py:562] -   BLEU: 87.1160
2025-05-05 09:46:54,336 - INFO - [train_rl.py:562] -   EditDistance: 5.2173
2025-05-05 09:46:54,336 - INFO - [train_rl.py:562] -   ExactMatch: 32.3536
2025-05-05 09:46:54,336 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 32.3536 ***
2025-05-05 09:46:56,863 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 09:46:56,863 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 32.3536) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 09:50:43,992 - INFO - [train_rl.py:511] - Epoch 93 训练结束. Avg Loss: 0.1557, Avg CE Loss: 0.1557, Time: 227.10s
2025-05-05 09:50:43,993 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 93 ---
2025-05-05 09:54:24,230 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 09:54:24,230 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 09:54:24,230 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 09:54:24,638 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 09:54:25,052 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 09:54:25,417 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 09:54:25,780 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 09:54:26,153 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 09:54:26,516 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 09:54:26,888 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 09:54:27,260 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 09:54:27,397 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 09:54:27,397 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.04828409355748, 'EditDistance': 5.402508960573477, 'ExactMatch': 31.971326164874554}
2025-05-05 09:54:27,397 - INFO - [train_rl.py:561] - 验证结果 Epoch 93:
2025-05-05 09:54:27,397 - INFO - [train_rl.py:562] -   BLEU: 87.0483
2025-05-05 09:54:27,397 - INFO - [train_rl.py:562] -   EditDistance: 5.4025
2025-05-05 09:54:27,397 - INFO - [train_rl.py:562] -   ExactMatch: 31.9713
2025-05-05 09:58:14,437 - INFO - [train_rl.py:511] - Epoch 94 训练结束. Avg Loss: 0.1536, Avg CE Loss: 0.1536, Time: 226.99s
2025-05-05 09:58:14,438 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 94 ---
2025-05-05 10:01:38,502 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 10:01:38,503 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 10:01:38,503 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 10:01:38,878 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 10:01:39,264 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 10:01:39,641 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 10:01:40,008 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 10:01:40,384 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 10:01:40,757 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 10:01:41,147 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 10:01:41,570 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 10:01:41,737 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 10:01:41,738 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.27670515875234, 'EditDistance': 5.159020310633214, 'ExactMatch': 32.198327359617686}
2025-05-05 10:01:41,738 - INFO - [train_rl.py:561] - 验证结果 Epoch 94:
2025-05-05 10:01:41,738 - INFO - [train_rl.py:562] -   BLEU: 87.2767
2025-05-05 10:01:41,738 - INFO - [train_rl.py:562] -   EditDistance: 5.1590
2025-05-05 10:01:41,738 - INFO - [train_rl.py:562] -   ExactMatch: 32.1983
2025-05-05 10:05:28,536 - INFO - [train_rl.py:511] - Epoch 95 训练结束. Avg Loss: 0.1515, Avg CE Loss: 0.1515, Time: 226.76s
2025-05-05 10:05:28,536 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 95 ---
2025-05-05 10:08:46,284 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 10:08:46,284 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 10:08:46,284 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 10:08:46,642 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 10:08:47,009 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 10:08:47,363 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 10:08:47,723 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 10:08:48,082 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 10:08:48,456 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 10:08:48,846 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 10:08:49,237 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 10:08:49,381 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 10:08:49,382 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.12885595223551, 'EditDistance': 5.2168458781362, 'ExactMatch': 32.11469534050179}
2025-05-05 10:08:49,382 - INFO - [train_rl.py:561] - 验证结果 Epoch 95:
2025-05-05 10:08:49,382 - INFO - [train_rl.py:562] -   BLEU: 87.1289
2025-05-05 10:08:49,382 - INFO - [train_rl.py:562] -   EditDistance: 5.2168
2025-05-05 10:08:49,382 - INFO - [train_rl.py:562] -   ExactMatch: 32.1147
2025-05-05 10:12:35,596 - INFO - [train_rl.py:511] - Epoch 96 训练结束. Avg Loss: 0.1499, Avg CE Loss: 0.1499, Time: 226.17s
2025-05-05 10:12:35,596 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 96 ---
2025-05-05 10:15:46,928 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 10:15:46,928 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 10:15:46,928 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 10:15:47,293 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 10:15:47,668 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 10:15:48,032 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 10:15:48,399 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 10:15:48,773 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 10:15:49,134 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 10:15:49,503 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 10:15:49,876 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 10:15:50,012 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 10:15:50,012 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.10115284413284, 'EditDistance': 5.203703703703703, 'ExactMatch': 32.210274790919954}
2025-05-05 10:15:50,012 - INFO - [train_rl.py:561] - 验证结果 Epoch 96:
2025-05-05 10:15:50,012 - INFO - [train_rl.py:562] -   BLEU: 87.1012
2025-05-05 10:15:50,012 - INFO - [train_rl.py:562] -   EditDistance: 5.2037
2025-05-05 10:15:50,012 - INFO - [train_rl.py:562] -   ExactMatch: 32.2103
2025-05-05 10:15:51,990 - INFO - [utils.py:91] - Epoch checkpoint saved to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/checkpoint_epoch_96.pth.tar
2025-05-05 10:15:51,990 - INFO - [train_rl.py:599] - 检查点操作: Epoch 96 检查点已保存 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 10:19:38,711 - INFO - [train_rl.py:511] - Epoch 97 训练结束. Avg Loss: 0.1480, Avg CE Loss: 0.1480, Time: 226.68s
2025-05-05 10:19:38,712 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 97 ---
2025-05-05 10:23:06,848 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 10:23:06,849 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 10:23:06,849 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 10:23:07,209 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 10:23:07,574 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 10:23:07,933 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 10:23:08,294 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 10:23:08,658 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 10:23:09,017 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 10:23:09,389 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 10:23:09,787 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 10:23:09,942 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 10:23:09,943 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.38862366702436, 'EditDistance': 5.107287933094384, 'ExactMatch': 32.903225806451616}
2025-05-05 10:23:09,943 - INFO - [train_rl.py:561] - 验证结果 Epoch 97:
2025-05-05 10:23:09,943 - INFO - [train_rl.py:562] -   BLEU: 87.3886
2025-05-05 10:23:09,943 - INFO - [train_rl.py:562] -   EditDistance: 5.1073
2025-05-05 10:23:09,943 - INFO - [train_rl.py:562] -   ExactMatch: 32.9032
2025-05-05 10:23:09,944 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 32.9032 ***
2025-05-05 10:23:12,440 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 10:23:12,441 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 32.9032) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 10:26:59,890 - INFO - [train_rl.py:511] - Epoch 98 训练结束. Avg Loss: 0.1465, Avg CE Loss: 0.1465, Time: 227.41s
2025-05-05 10:26:59,891 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 98 ---
2025-05-05 10:30:12,307 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 10:30:12,308 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 10:30:12,308 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 10:30:12,667 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 10:30:13,036 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 10:30:13,394 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 10:30:13,758 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 10:30:14,121 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 10:30:14,477 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 10:30:14,841 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 10:30:15,206 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 10:30:15,348 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 10:30:15,349 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.65554633570864, 'EditDistance': 4.928912783751493, 'ExactMatch': 33.59617682198328}
2025-05-05 10:30:15,349 - INFO - [train_rl.py:561] - 验证结果 Epoch 98:
2025-05-05 10:30:15,349 - INFO - [train_rl.py:562] -   BLEU: 87.6555
2025-05-05 10:30:15,349 - INFO - [train_rl.py:562] -   EditDistance: 4.9289
2025-05-05 10:30:15,349 - INFO - [train_rl.py:562] -   ExactMatch: 33.5962
2025-05-05 10:30:15,349 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 33.5962 ***
2025-05-05 10:30:17,640 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 10:30:17,641 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 33.5962) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 10:34:05,618 - INFO - [train_rl.py:511] - Epoch 99 训练结束. Avg Loss: 0.1442, Avg CE Loss: 0.1442, Time: 227.94s
2025-05-05 10:34:05,619 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 99 ---
2025-05-05 10:37:27,569 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 10:37:27,569 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 10:37:27,569 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 10:37:27,939 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 10:37:28,304 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 10:37:28,672 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 10:37:29,039 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 10:37:29,406 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 10:37:29,768 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 10:37:30,142 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 10:37:30,501 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 10:37:30,640 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 10:37:30,640 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.67378996916186, 'EditDistance': 4.971206690561529, 'ExactMatch': 33.27359617682198}
2025-05-05 10:37:30,640 - INFO - [train_rl.py:561] - 验证结果 Epoch 99:
2025-05-05 10:37:30,641 - INFO - [train_rl.py:562] -   BLEU: 87.6738
2025-05-05 10:37:30,641 - INFO - [train_rl.py:562] -   EditDistance: 4.9712
2025-05-05 10:37:30,641 - INFO - [train_rl.py:562] -   ExactMatch: 33.2736
2025-05-05 10:41:17,237 - INFO - [train_rl.py:511] - Epoch 100 训练结束. Avg Loss: 0.1425, Avg CE Loss: 0.1425, Time: 226.56s
2025-05-05 10:41:17,238 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 100 ---
2025-05-05 10:44:26,218 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 10:44:26,218 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 10:44:26,218 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 10:44:26,580 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 10:44:26,954 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 10:44:27,318 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 10:44:27,683 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 10:44:28,059 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 10:44:28,423 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 10:44:28,796 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 10:44:29,172 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 10:44:29,308 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 10:44:29,308 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.74243272995227, 'EditDistance': 4.932497013142174, 'ExactMatch': 33.775388291517324}
2025-05-05 10:44:29,308 - INFO - [train_rl.py:561] - 验证结果 Epoch 100:
2025-05-05 10:44:29,308 - INFO - [train_rl.py:562] -   BLEU: 87.7424
2025-05-05 10:44:29,308 - INFO - [train_rl.py:562] -   EditDistance: 4.9325
2025-05-05 10:44:29,308 - INFO - [train_rl.py:562] -   ExactMatch: 33.7754
2025-05-05 10:44:29,308 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 33.7754 ***
2025-05-05 10:44:31,581 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 10:44:31,581 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 33.7754) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 10:48:18,291 - INFO - [train_rl.py:511] - Epoch 101 训练结束. Avg Loss: 0.1414, Avg CE Loss: 0.1414, Time: 226.66s
2025-05-05 10:48:18,291 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 101 ---
2025-05-05 10:51:38,238 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 10:51:38,238 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 10:51:38,238 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 10:51:38,608 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 10:51:38,992 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 10:51:39,366 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 10:51:39,755 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 10:51:40,162 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 10:51:40,540 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 10:51:40,959 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 10:51:41,352 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 10:51:41,497 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 10:51:41,497 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.5365066118606, 'EditDistance': 5.089008363201912, 'ExactMatch': 33.20191158900837}
2025-05-05 10:51:41,497 - INFO - [train_rl.py:561] - 验证结果 Epoch 101:
2025-05-05 10:51:41,497 - INFO - [train_rl.py:562] -   BLEU: 87.5365
2025-05-05 10:51:41,497 - INFO - [train_rl.py:562] -   EditDistance: 5.0890
2025-05-05 10:51:41,498 - INFO - [train_rl.py:562] -   ExactMatch: 33.2019
2025-05-05 10:55:28,495 - INFO - [train_rl.py:511] - Epoch 102 训练结束. Avg Loss: 0.1395, Avg CE Loss: 0.1395, Time: 226.95s
2025-05-05 10:55:28,495 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 102 ---
2025-05-05 10:58:42,462 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 10:58:42,462 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 10:58:42,462 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 10:58:42,824 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 10:58:43,191 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 10:58:43,559 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 10:58:43,936 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 10:58:44,298 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 10:58:44,661 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 10:58:45,034 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 10:58:45,403 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 10:58:45,544 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 10:58:45,545 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.72761478474291, 'EditDistance': 4.996774193548387, 'ExactMatch': 33.42891278375149}
2025-05-05 10:58:45,545 - INFO - [train_rl.py:561] - 验证结果 Epoch 102:
2025-05-05 10:58:45,545 - INFO - [train_rl.py:562] -   BLEU: 87.7276
2025-05-05 10:58:45,545 - INFO - [train_rl.py:562] -   EditDistance: 4.9968
2025-05-05 10:58:45,545 - INFO - [train_rl.py:562] -   ExactMatch: 33.4289
2025-05-05 11:02:32,033 - INFO - [train_rl.py:511] - Epoch 103 训练结束. Avg Loss: 0.1379, Avg CE Loss: 0.1379, Time: 226.45s
2025-05-05 11:02:32,033 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 103 ---
2025-05-05 11:05:41,133 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 11:05:41,133 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 11:05:41,133 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 11:05:41,496 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 11:05:41,873 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 11:05:42,241 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 11:05:42,596 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 11:05:42,964 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 11:05:43,335 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 11:05:43,702 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 11:05:44,074 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 11:05:44,212 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 11:05:44,213 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.72460481927024, 'EditDistance': 4.916965352449224, 'ExactMatch': 33.775388291517324}
2025-05-05 11:05:44,213 - INFO - [train_rl.py:561] - 验证结果 Epoch 103:
2025-05-05 11:05:44,213 - INFO - [train_rl.py:562] -   BLEU: 87.7246
2025-05-05 11:05:44,213 - INFO - [train_rl.py:562] -   EditDistance: 4.9170
2025-05-05 11:05:44,213 - INFO - [train_rl.py:562] -   ExactMatch: 33.7754
2025-05-05 11:09:30,015 - INFO - [train_rl.py:511] - Epoch 104 训练结束. Avg Loss: 0.1363, Avg CE Loss: 0.1363, Time: 225.77s
2025-05-05 11:09:30,015 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 104 ---
2025-05-05 11:12:41,586 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 11:12:41,586 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 11:12:41,586 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 11:12:41,957 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 11:12:42,361 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 11:12:42,725 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 11:12:43,083 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 11:12:43,450 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 11:12:43,834 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 11:12:44,233 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 11:12:44,617 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 11:12:44,768 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 11:12:44,769 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.8514142934317, 'EditDistance': 4.866547192353644, 'ExactMatch': 33.78733572281959}
2025-05-05 11:12:44,769 - INFO - [train_rl.py:561] - 验证结果 Epoch 104:
2025-05-05 11:12:44,769 - INFO - [train_rl.py:562] -   BLEU: 87.8514
2025-05-05 11:12:44,769 - INFO - [train_rl.py:562] -   EditDistance: 4.8665
2025-05-05 11:12:44,769 - INFO - [train_rl.py:562] -   ExactMatch: 33.7873
2025-05-05 11:12:44,769 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 33.7873 ***
2025-05-05 11:12:46,828 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 11:12:46,829 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 33.7873) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 11:16:32,606 - INFO - [train_rl.py:511] - Epoch 105 训练结束. Avg Loss: 0.1345, Avg CE Loss: 0.1345, Time: 225.75s
2025-05-05 11:16:32,606 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 105 ---
2025-05-05 11:19:39,789 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 11:19:39,790 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 11:19:39,790 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 11:19:40,192 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 11:19:40,616 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 11:19:41,034 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 11:19:41,446 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 11:19:41,831 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 11:19:42,193 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 11:19:42,563 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 11:19:42,925 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 11:19:43,062 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 11:19:43,062 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.84470134685209, 'EditDistance': 4.827240143369176, 'ExactMatch': 34.193548387096776}
2025-05-05 11:19:43,062 - INFO - [train_rl.py:561] - 验证结果 Epoch 105:
2025-05-05 11:19:43,062 - INFO - [train_rl.py:562] -   BLEU: 87.8447
2025-05-05 11:19:43,062 - INFO - [train_rl.py:562] -   EditDistance: 4.8272
2025-05-05 11:19:43,062 - INFO - [train_rl.py:562] -   ExactMatch: 34.1935
2025-05-05 11:19:43,062 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 34.1935 ***
2025-05-05 11:19:45,096 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 11:19:45,096 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 34.1935) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 11:23:31,478 - INFO - [train_rl.py:511] - Epoch 106 训练结束. Avg Loss: 0.1332, Avg CE Loss: 0.1332, Time: 226.33s
2025-05-05 11:23:31,478 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 106 ---
2025-05-05 11:26:48,150 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 11:26:48,150 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 11:26:48,150 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 11:26:48,508 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 11:26:48,884 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 11:26:49,261 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 11:26:49,632 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 11:26:49,998 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 11:26:50,361 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 11:26:50,731 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 11:26:51,105 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 11:26:51,246 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 11:26:51,247 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.80369111110747, 'EditDistance': 4.927837514934289, 'ExactMatch': 34.121863799283155}
2025-05-05 11:26:51,247 - INFO - [train_rl.py:561] - 验证结果 Epoch 106:
2025-05-05 11:26:51,247 - INFO - [train_rl.py:562] -   BLEU: 87.8037
2025-05-05 11:26:51,247 - INFO - [train_rl.py:562] -   EditDistance: 4.9278
2025-05-05 11:26:51,247 - INFO - [train_rl.py:562] -   ExactMatch: 34.1219
2025-05-05 11:28:00,049 - INFO - [train_rl.py:77] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 11:28:00,049 - INFO - [train_rl.py:78] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 11:28:00,049 - INFO - [train_rl.py:79] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 11:28:00,049 - INFO - [train_rl.py:80] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 11:28:00,079 - INFO - [train_rl.py:89] - 全局随机种子设置为: 42
2025-05-05 11:28:00,096 - INFO - [train_rl.py:94] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 11:28:00,096 - INFO - [train_rl.py:98] - 使用设备: cuda
2025-05-05 11:28:00,097 - INFO - [train_rl.py:120] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 11:28:00,097 - INFO - [train_rl.py:129] - 创建数据加载器...
2025-05-05 11:28:00,097 - INFO - [train_rl.py:153] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 11:28:00,097 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 11:28:00,388 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 11:28:05,903 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 11:28:05,917 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 11:28:05,962 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 11:28:06,577 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 11:28:06,578 - INFO - [train_rl.py:159] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 11:28:06,579 - INFO - [train_rl.py:166] - 初始化模型...
2025-05-05 11:28:12,072 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 11:28:12,834 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 11:28:14,864 - INFO - [train_rl.py:181] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 11:28:14,864 - INFO - [train_rl.py:227] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 11:28:14,866 - INFO - [train_rl.py:235] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-05 11:28:14,866 - INFO - [train_rl.py:254] - 调度器: CosineAnnealingLR (T_max=79884, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 11:28:14,867 - INFO - [train_rl.py:262] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 11:28:14,867 - INFO - [train_rl.py:274] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 11:28:14,867 - INFO - [train_rl.py:277] - ========================================
2025-05-05 11:28:14,867 - INFO - [train_rl.py:278] - 开始训练循环...
2025-05-05 11:28:14,867 - INFO - [train_rl.py:279] - 总轮数: 512, 每轮更新次数: 157, 总步数: 80384
2025-05-05 11:28:14,867 - INFO - [train_rl.py:280] - ========================================
2025-05-05 11:28:14,867 - INFO - [train_rl.py:291] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 11:28:14,867 - INFO - [train_rl.py:293] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 11:28:14,867 - INFO - [train_rl.py:294] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 11:28:16,375 - INFO - [train_rl.py:309] - 从 Epoch 105 恢复训练, 当前最佳指标: 34.1935
2025-05-05 11:32:07,626 - INFO - [train_rl.py:511] - Epoch 106 训练结束. Avg Loss: 0.1240, Avg CE Loss: 0.1240, Time: 228.58s
2025-05-05 11:32:07,627 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 106 ---
2025-05-05 11:35:31,395 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 11:35:31,395 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 11:35:31,396 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 11:35:31,773 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 11:35:32,149 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 11:35:32,516 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 11:35:32,885 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 11:35:33,262 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 11:35:33,632 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 11:35:34,007 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 11:35:34,372 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 11:35:34,505 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 11:35:34,505 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 87.98230788741047, 'EditDistance': 4.851254480286738, 'ExactMatch': 34.18160095579451}
2025-05-05 11:35:34,506 - INFO - [train_rl.py:561] - 验证结果 Epoch 106:
2025-05-05 11:35:34,506 - INFO - [train_rl.py:562] -   BLEU: 87.9823
2025-05-05 11:35:34,506 - INFO - [train_rl.py:562] -   EditDistance: 4.8513
2025-05-05 11:35:34,506 - INFO - [train_rl.py:562] -   ExactMatch: 34.1816
2025-05-05 11:39:18,554 - INFO - [train_rl.py:511] - Epoch 107 训练结束. Avg Loss: 0.1251, Avg CE Loss: 0.1251, Time: 223.98s
2025-05-05 11:39:18,554 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 107 ---
2025-05-05 11:42:35,329 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 11:42:35,329 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 11:42:35,329 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 11:42:35,689 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 11:42:36,055 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 11:42:36,409 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 11:42:36,769 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 11:42:37,161 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 11:42:37,532 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 11:42:37,893 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 11:42:38,251 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 11:42:38,385 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 11:42:38,385 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.12627020284897, 'EditDistance': 4.743608124253286, 'ExactMatch': 34.95818399044205}
2025-05-05 11:42:38,385 - INFO - [train_rl.py:561] - 验证结果 Epoch 107:
2025-05-05 11:42:38,385 - INFO - [train_rl.py:562] -   BLEU: 88.1263
2025-05-05 11:42:38,385 - INFO - [train_rl.py:562] -   EditDistance: 4.7436
2025-05-05 11:42:38,385 - INFO - [train_rl.py:562] -   ExactMatch: 34.9582
2025-05-05 11:42:38,385 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 34.9582 ***
2025-05-05 11:42:40,630 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 11:42:40,630 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 34.9582) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 11:43:23,817 - INFO - [train_rl.py:77] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 11:43:23,818 - INFO - [train_rl.py:78] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 11:43:23,818 - INFO - [train_rl.py:79] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 11:43:23,818 - INFO - [train_rl.py:80] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 11:43:23,868 - INFO - [train_rl.py:89] - 全局随机种子设置为: 42
2025-05-05 11:43:23,907 - INFO - [train_rl.py:94] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 11:43:23,908 - INFO - [train_rl.py:98] - 使用设备: cuda
2025-05-05 11:43:23,909 - INFO - [train_rl.py:120] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 11:43:23,909 - INFO - [train_rl.py:129] - 创建数据加载器...
2025-05-05 11:43:23,910 - INFO - [train_rl.py:153] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 11:43:23,910 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 11:43:24,228 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 11:43:29,540 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 11:43:29,547 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 11:43:29,588 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 11:43:30,116 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 11:43:30,117 - INFO - [train_rl.py:159] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 11:43:30,117 - INFO - [train_rl.py:166] - 初始化模型...
2025-05-05 11:43:35,142 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 11:43:35,701 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 11:43:39,725 - INFO - [train_rl.py:181] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 11:43:39,726 - INFO - [train_rl.py:227] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 11:43:39,731 - INFO - [train_rl.py:235] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-05 11:43:39,731 - INFO - [train_rl.py:254] - 调度器: CosineAnnealingLR (T_max=31244, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 11:43:39,731 - INFO - [train_rl.py:262] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 11:43:39,731 - INFO - [train_rl.py:274] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 11:43:39,731 - INFO - [train_rl.py:277] - ========================================
2025-05-05 11:43:39,731 - INFO - [train_rl.py:278] - 开始训练循环...
2025-05-05 11:43:39,731 - INFO - [train_rl.py:279] - 总轮数: 512, 每轮更新次数: 62, 总步数: 31744
2025-05-05 11:43:39,732 - INFO - [train_rl.py:280] - ========================================
2025-05-05 11:43:39,732 - INFO - [train_rl.py:291] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 11:43:39,732 - INFO - [train_rl.py:293] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 11:43:39,732 - INFO - [train_rl.py:294] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 11:43:40,977 - INFO - [train_rl.py:309] - 从 Epoch 107 恢复训练, 当前最佳指标: 34.9582
2025-05-05 11:47:29,650 - INFO - [train_rl.py:511] - Epoch 108 训练结束. Avg Loss: 0.1069, Avg CE Loss: 0.1069, Time: 226.22s
2025-05-05 11:47:29,651 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 108 ---
2025-05-05 11:50:46,257 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 11:50:46,257 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 11:50:46,257 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 11:50:46,665 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 11:50:47,065 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 11:50:47,456 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 11:50:47,852 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 11:50:48,247 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 11:50:48,644 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 11:50:49,043 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 11:50:49,444 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 11:50:49,587 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 11:50:49,587 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.14368392751133, 'EditDistance': 4.736439665471924, 'ExactMatch': 34.743130227001195}
2025-05-05 11:50:49,587 - INFO - [train_rl.py:561] - 验证结果 Epoch 108:
2025-05-05 11:50:49,587 - INFO - [train_rl.py:562] -   BLEU: 88.1437
2025-05-05 11:50:49,587 - INFO - [train_rl.py:562] -   EditDistance: 4.7364
2025-05-05 11:50:49,587 - INFO - [train_rl.py:562] -   ExactMatch: 34.7431
2025-05-05 11:54:30,706 - INFO - [train_rl.py:511] - Epoch 109 训练结束. Avg Loss: 0.1073, Avg CE Loss: 0.1073, Time: 221.05s
2025-05-05 11:54:30,707 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 109 ---
2025-05-05 11:57:41,711 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 11:57:41,711 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 11:57:41,711 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 11:57:42,078 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 11:57:42,448 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 11:57:42,804 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 11:57:43,175 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 11:57:43,541 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 11:57:43,900 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 11:57:44,265 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 11:57:44,652 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 11:57:44,795 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 11:57:44,796 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.34744381891912, 'EditDistance': 4.626881720430108, 'ExactMatch': 35.11350059737157}
2025-05-05 11:57:44,796 - INFO - [train_rl.py:561] - 验证结果 Epoch 109:
2025-05-05 11:57:44,796 - INFO - [train_rl.py:562] -   BLEU: 88.3474
2025-05-05 11:57:44,796 - INFO - [train_rl.py:562] -   EditDistance: 4.6269
2025-05-05 11:57:44,796 - INFO - [train_rl.py:562] -   ExactMatch: 35.1135
2025-05-05 11:57:44,796 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 35.1135 ***
2025-05-05 11:57:47,144 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 11:57:47,144 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 35.1135) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 12:01:28,704 - INFO - [train_rl.py:511] - Epoch 110 训练结束. Avg Loss: 0.1209, Avg CE Loss: 0.1209, Time: 221.52s
2025-05-05 12:01:28,704 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 110 ---
2025-05-05 12:04:52,096 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 12:04:52,096 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 12:04:52,096 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 12:04:52,467 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 12:04:52,837 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 12:04:53,199 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 12:04:53,568 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 12:04:53,936 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 12:04:54,297 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 12:04:54,666 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 12:04:55,062 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 12:04:55,209 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 12:04:55,209 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.2073319700722, 'EditDistance': 4.706332138590203, 'ExactMatch': 34.778972520908}
2025-05-05 12:04:55,209 - INFO - [train_rl.py:561] - 验证结果 Epoch 110:
2025-05-05 12:04:55,209 - INFO - [train_rl.py:562] -   BLEU: 88.2073
2025-05-05 12:04:55,209 - INFO - [train_rl.py:562] -   EditDistance: 4.7063
2025-05-05 12:04:55,209 - INFO - [train_rl.py:562] -   ExactMatch: 34.7790
2025-05-05 12:05:59,456 - INFO - [train_rl.py:77] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 12:05:59,457 - INFO - [train_rl.py:78] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 12:05:59,457 - INFO - [train_rl.py:79] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 12:05:59,457 - INFO - [train_rl.py:80] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 12:05:59,485 - INFO - [train_rl.py:89] - 全局随机种子设置为: 42
2025-05-05 12:05:59,504 - INFO - [train_rl.py:94] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 12:05:59,504 - INFO - [train_rl.py:98] - 使用设备: cuda
2025-05-05 12:05:59,506 - INFO - [train_rl.py:120] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 12:05:59,506 - INFO - [train_rl.py:129] - 创建数据加载器...
2025-05-05 12:05:59,508 - INFO - [train_rl.py:153] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 12:05:59,508 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 12:05:59,808 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 12:06:05,280 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 12:06:05,288 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 12:06:05,344 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 12:06:05,932 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 12:06:05,933 - INFO - [train_rl.py:159] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 12:06:05,933 - INFO - [train_rl.py:166] - 初始化模型...
2025-05-05 12:06:11,263 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 12:06:11,745 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 12:06:13,521 - INFO - [train_rl.py:181] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 12:06:13,522 - INFO - [train_rl.py:227] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 12:06:13,524 - INFO - [train_rl.py:235] - 优化器: AdamW (lr=1e-5, weight_decay=0.01) for OCR Model
2025-05-05 12:06:13,524 - INFO - [train_rl.py:254] - 调度器: CosineAnnealingLR (T_max=1548, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 12:06:13,524 - INFO - [train_rl.py:262] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 12:06:13,525 - INFO - [train_rl.py:274] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 12:06:13,525 - INFO - [train_rl.py:277] - ========================================
2025-05-05 12:06:13,525 - INFO - [train_rl.py:278] - 开始训练循环...
2025-05-05 12:06:13,525 - INFO - [train_rl.py:279] - 总轮数: 512, 每轮更新次数: 4, 总步数: 2048
2025-05-05 12:06:13,525 - INFO - [train_rl.py:280] - ========================================
2025-05-05 12:06:13,525 - INFO - [train_rl.py:291] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 12:06:13,525 - INFO - [train_rl.py:293] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 12:06:13,525 - INFO - [train_rl.py:294] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 12:06:14,975 - INFO - [train_rl.py:309] - 从 Epoch 109 恢复训练, 当前最佳指标: 35.1135
2025-05-05 12:09:59,759 - INFO - [train_rl.py:511] - Epoch 110 训练结束. Avg Loss: 0.1009, Avg CE Loss: 0.1009, Time: 222.51s
2025-05-05 12:09:59,760 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 110 ---
2025-05-05 12:13:12,938 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 12:13:12,939 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 12:13:12,939 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 12:13:13,307 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 12:13:13,677 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 12:13:14,044 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 12:13:14,396 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 12:13:14,785 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 12:13:15,180 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 12:13:15,575 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 12:13:15,993 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 12:13:16,156 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 12:13:16,156 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.15175754908603, 'EditDistance': 4.697968936678614, 'ExactMatch': 34.61170848267622}
2025-05-05 12:13:16,156 - INFO - [train_rl.py:561] - 验证结果 Epoch 110:
2025-05-05 12:13:16,156 - INFO - [train_rl.py:562] -   BLEU: 88.1518
2025-05-05 12:13:16,156 - INFO - [train_rl.py:562] -   EditDistance: 4.6980
2025-05-05 12:13:16,156 - INFO - [train_rl.py:562] -   ExactMatch: 34.6117
2025-05-05 12:16:56,366 - INFO - [train_rl.py:511] - Epoch 111 训练结束. Avg Loss: 0.1003, Avg CE Loss: 0.1003, Time: 220.15s
2025-05-05 12:16:56,367 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 111 ---
2025-05-05 12:20:10,315 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 12:20:10,316 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 12:20:10,316 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 12:20:10,681 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 12:20:11,060 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 12:20:11,421 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 12:20:11,795 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 12:20:12,185 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 12:20:12,583 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 12:20:12,949 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 12:20:13,306 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 12:20:13,444 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 12:20:13,444 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.09440867558543, 'EditDistance': 4.735483870967742, 'ExactMatch': 34.59976105137395}
2025-05-05 12:20:13,444 - INFO - [train_rl.py:561] - 验证结果 Epoch 111:
2025-05-05 12:20:13,444 - INFO - [train_rl.py:562] -   BLEU: 88.0944
2025-05-05 12:20:13,444 - INFO - [train_rl.py:562] -   EditDistance: 4.7355
2025-05-05 12:20:13,444 - INFO - [train_rl.py:562] -   ExactMatch: 34.5998
2025-05-05 12:23:52,337 - INFO - [train_rl.py:511] - Epoch 112 训练结束. Avg Loss: 0.1204, Avg CE Loss: 0.1204, Time: 218.84s
2025-05-05 12:23:52,338 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 112 ---
2025-05-05 12:27:12,100 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 12:27:12,101 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 12:27:12,101 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 12:27:12,465 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 12:27:12,843 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 12:27:13,211 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 12:27:13,577 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 12:27:13,949 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 12:27:14,310 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 12:27:14,676 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 12:27:15,043 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 12:27:15,180 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 12:27:15,181 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.18645978284908, 'EditDistance': 4.725686977299881, 'ExactMatch': 34.88649940262844}
2025-05-05 12:27:15,181 - INFO - [train_rl.py:561] - 验证结果 Epoch 112:
2025-05-05 12:27:15,181 - INFO - [train_rl.py:562] -   BLEU: 88.1865
2025-05-05 12:27:15,181 - INFO - [train_rl.py:562] -   EditDistance: 4.7257
2025-05-05 12:27:15,181 - INFO - [train_rl.py:562] -   ExactMatch: 34.8865
2025-05-05 12:30:55,429 - INFO - [train_rl.py:511] - Epoch 113 训练结束. Avg Loss: 0.1190, Avg CE Loss: 0.1190, Time: 220.20s
2025-05-05 12:30:55,429 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 113 ---
2025-05-05 12:34:13,511 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 12:34:13,512 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 12:34:13,512 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 12:34:13,881 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 12:34:14,283 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 12:34:14,670 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 12:34:15,094 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 12:34:15,492 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 12:34:15,932 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 12:34:16,317 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 12:34:16,753 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 12:34:16,908 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 12:34:16,908 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.34587572951447, 'EditDistance': 4.65041816009558, 'ExactMatch': 35.40023894862605}
2025-05-05 12:34:16,909 - INFO - [train_rl.py:561] - 验证结果 Epoch 113:
2025-05-05 12:34:16,909 - INFO - [train_rl.py:562] -   BLEU: 88.3459
2025-05-05 12:34:16,909 - INFO - [train_rl.py:562] -   EditDistance: 4.6504
2025-05-05 12:34:16,909 - INFO - [train_rl.py:562] -   ExactMatch: 35.4002
2025-05-05 12:34:16,909 - INFO - [train_rl.py:575] - *** 新的最佳验证指标 (ExactMatch): 35.4002 ***
2025-05-05 12:34:19,353 - INFO - [utils.py:109] - *** Best checkpoint saved directly to /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar ***
2025-05-05 12:34:19,354 - INFO - [train_rl.py:599] - 检查点操作: 最佳模型已更新 (ExactMatch: 35.4002) 到 /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 12:37:59,545 - INFO - [train_rl.py:511] - Epoch 114 训练结束. Avg Loss: 0.1185, Avg CE Loss: 0.1185, Time: 220.14s
2025-05-05 12:37:59,546 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 114 ---
2025-05-05 12:41:13,943 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 12:41:13,943 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 12:41:13,944 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 12:41:14,360 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 12:41:14,775 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 12:41:15,187 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 12:41:15,603 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 12:41:16,041 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 12:41:16,453 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 12:41:16,872 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 12:41:17,281 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 12:41:17,437 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 12:41:17,437 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.23705582792493, 'EditDistance': 4.667980884109916, 'ExactMatch': 34.99402628434887}
2025-05-05 12:41:17,437 - INFO - [train_rl.py:561] - 验证结果 Epoch 114:
2025-05-05 12:41:17,437 - INFO - [train_rl.py:562] -   BLEU: 88.2371
2025-05-05 12:41:17,437 - INFO - [train_rl.py:562] -   EditDistance: 4.6680
2025-05-05 12:41:17,437 - INFO - [train_rl.py:562] -   ExactMatch: 34.9940
2025-05-05 12:44:56,290 - INFO - [train_rl.py:511] - Epoch 115 训练结束. Avg Loss: 0.1182, Avg CE Loss: 0.1182, Time: 218.80s
2025-05-05 12:44:56,291 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 115 ---
2025-05-05 12:48:14,387 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 12:48:14,387 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 12:48:14,387 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 12:48:14,752 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 12:48:15,158 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 12:48:15,524 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 12:48:15,890 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 12:48:16,296 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 12:48:16,662 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 12:48:17,060 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 12:48:17,437 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 12:48:17,574 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 12:48:17,574 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.29090761516196, 'EditDistance': 4.666547192353644, 'ExactMatch': 35.26881720430107}
2025-05-05 12:48:17,574 - INFO - [train_rl.py:561] - 验证结果 Epoch 115:
2025-05-05 12:48:17,574 - INFO - [train_rl.py:562] -   BLEU: 88.2909
2025-05-05 12:48:17,575 - INFO - [train_rl.py:562] -   EditDistance: 4.6665
2025-05-05 12:48:17,575 - INFO - [train_rl.py:562] -   ExactMatch: 35.2688
2025-05-05 12:51:56,306 - INFO - [train_rl.py:511] - Epoch 116 训练结束. Avg Loss: 0.1174, Avg CE Loss: 0.1174, Time: 218.68s
2025-05-05 12:51:56,306 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 116 ---
2025-05-05 12:55:12,413 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 12:55:12,414 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 12:55:12,414 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 12:55:12,769 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 12:55:13,138 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 12:55:13,496 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 12:55:13,861 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 12:55:14,230 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 12:55:14,591 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 12:55:14,969 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 12:55:15,337 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 12:55:15,469 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 12:55:15,470 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.26778714587114, 'EditDistance': 4.690800477897252, 'ExactMatch': 35.209080047789726}
2025-05-05 12:55:15,470 - INFO - [train_rl.py:561] - 验证结果 Epoch 116:
2025-05-05 12:55:15,470 - INFO - [train_rl.py:562] -   BLEU: 88.2678
2025-05-05 12:55:15,470 - INFO - [train_rl.py:562] -   EditDistance: 4.6908
2025-05-05 12:55:15,470 - INFO - [train_rl.py:562] -   ExactMatch: 35.2091
2025-05-05 12:56:13,869 - INFO - [train_rl.py:77] - 配置从 /root/lanyun-tmp/LaTeX_OCR/configs/train_rl_config.yaml 加载。
2025-05-05 12:56:13,869 - INFO - [train_rl.py:78] - 输出将保存到: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl
2025-05-05 12:56:13,869 - INFO - [train_rl.py:79] - 日志将记录到: /root/lanyun-tmp/LaTeX_OCR/logs/train_rl.log
2025-05-05 12:56:13,870 - INFO - [train_rl.py:80] - 项目根目录: /root/lanyun-tmp/LaTeX_OCR
2025-05-05 12:56:13,937 - INFO - [train_rl.py:89] - 全局随机种子设置为: 42
2025-05-05 12:56:13,956 - INFO - [train_rl.py:94] - 检测到 CUDA 设备: NVIDIA GeForce RTX 4090
2025-05-05 12:56:13,956 - INFO - [train_rl.py:98] - 使用设备: cuda
2025-05-05 12:56:13,956 - INFO - [train_rl.py:120] - 词汇表加载: 466 tokens. PAD=0, SOS=1, EOS=2
2025-05-05 12:56:13,956 - INFO - [train_rl.py:129] - 创建数据加载器...
2025-05-05 12:56:13,957 - INFO - [train_rl.py:153] - 图像基目录: /root/lanyun-tmp/LaTeX_OCR/data/formula_images_processed/formula_images_processed
2025-05-05 12:56:13,957 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/train.json
2025-05-05 12:56:14,255 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 12:56:19,498 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 75262 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 12:56:19,506 - INFO - [dataloader_ocr.py:53] - 从 JSON 文件加载 OCR 数据: /root/lanyun-tmp/LaTeX_OCR/data/validate.json
2025-05-05 12:56:19,550 - INFO - [dataloader_ocr.py:65] - 开始过滤数据集，检查有效的图像路径和标题...
2025-05-05 12:56:20,079 - INFO - [dataloader_ocr.py:145] - 过滤完成。加载了 8370 个有效的图像-标题对。跳过了 0 个无效项。
2025-05-05 12:56:20,081 - INFO - [train_rl.py:159] - 数据加载器创建完成。训练集: 75262 样本, 验证集: 8370 样本。
2025-05-05 12:56:20,081 - INFO - [train_rl.py:166] - 初始化模型...
2025-05-05 12:56:25,133 - INFO - [_builder.py:204] - Loading pretrained weights from Hugging Face hub (timm/vit_base_patch16_224.augreg_in21k)
2025-05-05 12:56:25,725 - INFO - [_hub.py:217] - [timm/vit_base_patch16_224.augreg_in21k] Safe alternative available for 'pytorch_model.bin' (as 'model.safetensors'). Loading weights using safetensors.
2025-05-05 12:56:28,117 - INFO - [train_rl.py:181] - OCR 模型初始化完成，总参数量: 143,225,554
2025-05-05 12:56:28,117 - INFO - [train_rl.py:227] - RL 训练已禁用 (lambda_rl=0.0)，跳过加载 Feature Extractor。
2025-05-05 12:56:28,120 - INFO - [train_rl.py:235] - 优化器: AdamW (lr=1e-6, weight_decay=0.01) for OCR Model
2025-05-05 12:56:28,121 - INFO - [train_rl.py:254] - 调度器: CosineAnnealingLR (T_max=1548, eta_min=1e-07) with Linear Warmup (500 steps)
2025-05-05 12:56:28,121 - INFO - [train_rl.py:262] - 损失函数: CrossEntropy (ignore_index=0), RL 已禁用
2025-05-05 12:56:28,121 - INFO - [train_rl.py:274] - 混合精度 (AMP): 启用, dtype: torch.float16, GradScaler: 启用
2025-05-05 12:56:28,121 - INFO - [train_rl.py:277] - ========================================
2025-05-05 12:56:28,121 - INFO - [train_rl.py:278] - 开始训练循环...
2025-05-05 12:56:28,121 - INFO - [train_rl.py:279] - 总轮数: 512, 每轮更新次数: 4, 总步数: 2048
2025-05-05 12:56:28,121 - INFO - [train_rl.py:280] - ========================================
2025-05-05 12:56:28,121 - INFO - [train_rl.py:291] - 尝试从检查点恢复训练: /root/lanyun-tmp/LaTeX_OCR/checkpoints/ocr_rl/model_best.pth.tar
2025-05-05 12:56:28,122 - INFO - [train_rl.py:293] - 调用 load_checkpoint 前，optimizer is None: False
2025-05-05 12:56:28,122 - INFO - [train_rl.py:294] - 调用 load_checkpoint 前，optimizer 类型: <class 'torch.optim.adamw.AdamW'>
2025-05-05 12:56:29,837 - INFO - [train_rl.py:309] - 从 Epoch 113 恢复训练, 当前最佳指标: 35.4002
2025-05-05 13:00:16,788 - INFO - [train_rl.py:511] - Epoch 114 训练结束. Avg Loss: 0.0987, Avg CE Loss: 0.0987, Time: 224.65s
2025-05-05 13:00:16,789 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 114 ---
2025-05-05 13:03:34,935 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 13:03:34,936 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 13:03:34,936 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 13:03:35,312 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 13:03:35,683 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 13:03:36,070 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 13:03:36,460 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 13:03:36,849 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 13:03:37,207 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 13:03:37,575 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 13:03:37,948 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 13:03:38,082 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 13:03:38,082 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.13898367235595, 'EditDistance': 4.703703703703703, 'ExactMatch': 34.73118279569892}
2025-05-05 13:03:38,083 - INFO - [train_rl.py:561] - 验证结果 Epoch 114:
2025-05-05 13:03:38,083 - INFO - [train_rl.py:562] -   BLEU: 88.1390
2025-05-05 13:03:38,083 - INFO - [train_rl.py:562] -   EditDistance: 4.7037
2025-05-05 13:03:38,083 - INFO - [train_rl.py:562] -   ExactMatch: 34.7312
2025-05-05 13:07:18,255 - INFO - [train_rl.py:511] - Epoch 115 训练结束. Avg Loss: 0.0985, Avg CE Loss: 0.0985, Time: 219.46s
2025-05-05 13:07:18,255 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 115 ---
2025-05-05 13:10:34,919 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 13:10:34,920 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 13:10:34,920 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 13:10:35,290 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 13:10:35,669 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 13:10:36,047 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 13:10:36,414 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 13:10:36,785 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 13:10:37,154 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 13:10:37,550 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 13:10:37,922 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 13:10:38,064 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 13:10:38,065 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.23289274798664, 'EditDistance': 4.690203106332139, 'ExactMatch': 35.017921146953405}
2025-05-05 13:10:38,065 - INFO - [train_rl.py:561] - 验证结果 Epoch 115:
2025-05-05 13:10:38,065 - INFO - [train_rl.py:562] -   BLEU: 88.2329
2025-05-05 13:10:38,065 - INFO - [train_rl.py:562] -   EditDistance: 4.6902
2025-05-05 13:10:38,065 - INFO - [train_rl.py:562] -   ExactMatch: 35.0179
2025-05-05 13:14:17,449 - INFO - [train_rl.py:511] - Epoch 116 训练结束. Avg Loss: 0.1178, Avg CE Loss: 0.1178, Time: 219.34s
2025-05-05 13:14:17,450 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 116 ---
2025-05-05 13:17:38,935 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 13:17:38,936 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 13:17:38,936 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 13:17:39,321 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 13:17:39,710 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 13:17:40,082 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 13:17:40,459 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 13:17:40,842 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 13:17:41,221 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 13:17:41,586 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 13:17:41,940 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 13:17:42,069 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 13:17:42,070 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.29828423823729, 'EditDistance': 4.672401433691756, 'ExactMatch': 35.137395459976105}
2025-05-05 13:17:42,070 - INFO - [train_rl.py:561] - 验证结果 Epoch 116:
2025-05-05 13:17:42,070 - INFO - [train_rl.py:562] -   BLEU: 88.2983
2025-05-05 13:17:42,070 - INFO - [train_rl.py:562] -   EditDistance: 4.6724
2025-05-05 13:17:42,070 - INFO - [train_rl.py:562] -   ExactMatch: 35.1374
2025-05-05 13:21:20,964 - INFO - [train_rl.py:511] - Epoch 117 训练结束. Avg Loss: 0.1172, Avg CE Loss: 0.1172, Time: 218.83s
2025-05-05 13:21:20,965 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 117 ---
2025-05-05 13:24:36,629 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 13:24:36,629 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 13:24:36,629 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 13:24:37,008 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 13:24:37,394 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 13:24:37,779 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 13:24:38,165 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 13:24:38,520 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 13:24:38,894 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 13:24:39,275 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 13:24:39,662 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 13:24:39,798 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 13:24:39,798 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.35053185559373, 'EditDistance': 4.61636798088411, 'ExactMatch': 35.24492234169653}
2025-05-05 13:24:39,798 - INFO - [train_rl.py:561] - 验证结果 Epoch 117:
2025-05-05 13:24:39,798 - INFO - [train_rl.py:562] -   BLEU: 88.3505
2025-05-05 13:24:39,798 - INFO - [train_rl.py:562] -   EditDistance: 4.6164
2025-05-05 13:24:39,798 - INFO - [train_rl.py:562] -   ExactMatch: 35.2449
2025-05-05 13:28:19,719 - INFO - [train_rl.py:511] - Epoch 118 训练结束. Avg Loss: 0.1174, Avg CE Loss: 0.1174, Time: 219.87s
2025-05-05 13:28:19,719 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 118 ---
2025-05-05 13:31:33,485 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 13:31:33,485 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 13:31:33,485 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 13:31:33,836 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 13:31:34,188 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 13:31:34,554 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 13:31:34,908 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 13:31:35,266 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 13:31:35,637 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 13:31:35,999 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 13:31:36,369 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 13:31:36,514 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 13:31:36,514 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.28449653556211, 'EditDistance': 4.641457586618877, 'ExactMatch': 34.97013142174433}
2025-05-05 13:31:36,514 - INFO - [train_rl.py:561] - 验证结果 Epoch 118:
2025-05-05 13:31:36,514 - INFO - [train_rl.py:562] -   BLEU: 88.2845
2025-05-05 13:31:36,514 - INFO - [train_rl.py:562] -   EditDistance: 4.6415
2025-05-05 13:31:36,514 - INFO - [train_rl.py:562] -   ExactMatch: 34.9701
2025-05-05 13:35:16,293 - INFO - [train_rl.py:511] - Epoch 119 训练结束. Avg Loss: 0.1175, Avg CE Loss: 0.1175, Time: 219.74s
2025-05-05 13:35:16,294 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 119 ---
2025-05-05 13:38:34,663 - INFO - [utils.py:286] - >>> 进入 compute_metrics
2025-05-05 13:38:34,663 - INFO - [utils.py:304] - compute_metrics: 将计算 8370 个样本的指标
2025-05-05 13:38:34,664 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 0/8370
2025-05-05 13:38:35,070 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 1000/8370
2025-05-05 13:38:35,437 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 2000/8370
2025-05-05 13:38:35,793 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 3000/8370
2025-05-05 13:38:36,160 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 4000/8370
2025-05-05 13:38:36,519 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 5000/8370
2025-05-05 13:38:36,874 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 6000/8370
2025-05-05 13:38:37,233 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 7000/8370
2025-05-05 13:38:37,586 - INFO - [utils.py:309] - compute_metrics: 正在处理样本 8000/8370
2025-05-05 13:38:37,729 - INFO - [utils.py:347] - compute_metrics: 所有样本处理完毕，准备计算平均值
2025-05-05 13:38:37,730 - INFO - [utils.py:358] - <<< 退出 compute_metrics, 返回: {'BLEU': 88.32780220145828, 'EditDistance': 4.645280764635603, 'ExactMatch': 35.292712066905615}
2025-05-05 13:38:37,730 - INFO - [train_rl.py:561] - 验证结果 Epoch 119:
2025-05-05 13:38:37,730 - INFO - [train_rl.py:562] -   BLEU: 88.3278
2025-05-05 13:38:37,730 - INFO - [train_rl.py:562] -   EditDistance: 4.6453
2025-05-05 13:38:37,730 - INFO - [train_rl.py:562] -   ExactMatch: 35.2927
2025-05-05 13:42:16,773 - INFO - [train_rl.py:511] - Epoch 120 训练结束. Avg Loss: 0.1170, Avg CE Loss: 0.1170, Time: 219.00s
2025-05-05 13:42:16,773 - INFO - [train_rl.py:515] - --- 开始验证 Epoch 120 ---
